<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Curso R: Programação em R (Nível Intermediário)</title>

  <meta property="description" itemprop="description" content="Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando **manipulações de objetos**, **cópias de objetos**, bem como **ambientes**. Falaremos sobre a criação de gráficos e **documentações em R**. Complementaremos também, sobre assuntos mais aprofundados como **programação funcional**, **programação orientada a objetos**, **metaprogramação** e uma introdução sobre **desenvolvimento de pacotes**. Por fim, ainda apresenderemos a desenvolver **gráficos**, e **banco de dados**."/>

  <link rel="icon" type="image/png" href="images/favicon.png"/>


  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Curso R: Programação em R (Nível Intermediário)"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando **manipulações de objetos**, **cópias de objetos**, bem como **ambientes**. Falaremos sobre a criação de gráficos e **documentações em R**. Complementaremos também, sobre assuntos mais aprofundados como **programação funcional**, **programação orientada a objetos**, **metaprogramação** e uma introdução sobre **desenvolvimento de pacotes**. Por fim, ainda apresenderemos a desenvolver **gráficos**, e **banco de dados**."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Curso R"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Curso R: Programação em R (Nível Intermediário)"/>
  <meta property="twitter:description" content="Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando **manipulações de objetos**, **cópias de objetos**, bem como **ambientes**. Falaremos sobre a criação de gráficos e **documentações em R**. Complementaremos também, sobre assuntos mais aprofundados como **programação funcional**, **programação orientada a objetos**, **metaprogramação** e uma introdução sobre **desenvolvimento de pacotes**. Por fim, ainda apresenderemos a desenvolver **gráficos**, e **banco de dados**."/>
  <meta property="twitter:site" content="@bendeivide"/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=Statistical models in S;citation_publication_date=1993;citation_publisher=Chapman &amp; Hall;citation_author=John M. Chambers;citation_author=Trevor J. Hastie"/>
  <meta name="citation_reference" content="citation_title=Advanced R;citation_publication_date=2019;citation_publisher=Chapman; Hall/CRC;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Extending R;citation_publication_date=2016;citation_publisher=Chapman; Hall/CRC;citation_author=John M. Chambers"/>
  <meta name="citation_reference" content="citation_title=Software for data analysis: Programming with R;citation_publication_date=2008;citation_publisher=Springer;citation_author=John M. Chambers"/>
  <meta name="citation_reference" content="citation_title=Statistical methods in S;citation_publication_date=1991;citation_publisher=Chapman &amp; Hall;citation_author=John M. Chambers;citation_author=Trevor J. Hastie"/>
  <meta name="citation_reference" content="citation_title=Advanced R;citation_publication_date=2019;citation_publisher=Chapman; Hall/CRC;citation_author=Hadley Wickham"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","bibliography","link-citations","site"]}},"value":[{"type":"character","attributes":{},"value":["Programação em R (Nível Intermediário)"]},{"type":"character","attributes":{},"value":["Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando **manipulações de objetos**, **cópias de objetos**, bem como **ambientes**. Falaremos sobre a criação de gráficos e **documentações em R**. Complementaremos também, sobre assuntos mais aprofundados como **programação funcional**, **programação orientada a objetos**, **metaprogramação** e uma introdução sobre **desenvolvimento de pacotes**. Por fim, ainda apresenderemos a desenvolver **gráficos**, e **banco de dados**.\n"]},{"type":"character","attributes":{},"value":["biblio.bib"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["distill::distill_website"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
  <link href="site_libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
  <script src="site_libs/panelset-0.2.6/panelset.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-183980834-3"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-183980834-3');
  </script>
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Programação em R (Nível Intermediário)","description":"Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando **manipulações de objetos**, **cópias de objetos**, bem como **ambientes**. Falaremos sobre a criação de gráficos e **documentações em R**. Complementaremos também, sobre assuntos mais aprofundados como **programação funcional**, **programação orientada a objetos**, **metaprogramação** e uma introdução sobre **desenvolvimento de pacotes**. Por fim, ainda apresenderemos a desenvolver **gráficos**, e **banco de dados**.","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://www.r-project.org/">
<img src="images/logo2.png" alt="Logo"/>
</a>
<a href="index.html" class="title">Curso R</a>
<a href="index.html" aria-label="Home">
<i class="fas fa-home" aria-hidden="true"></i>
</a>
<a href="about.html">Autor</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Material
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="nbasico.html">Basico</a>
<a href="nintermediario.html">Intermediario</a>
<span class="nav-dropdown-header">Avancado</span>
</div>
</div>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="https://www.facebook.com/bendeivide/">
<i class="fab fa-facebook" aria-hidden="true"></i>
</a>
<a href="https://www.instagram.com/bendeivide/">
<i class="fab fa-instagram" aria-hidden="true"></i>
</a>
<a href="https://benalana.blogspot.com/">
<i class="fab fa-blogger" aria-hidden="true"></i>
</a>
<a href="http://youtube.com/bendeivide/">
<i class="fab fa-youtube-square" aria-hidden="true"></i>
</a>
<a href="http://twitter.com/bendeivide/">
<i class="fab fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/bendeivide/">
<i class="fab fa-linkedin" aria-hidden="true"></i>
</a>
<a href="https://github.com/bendeivide/cursor/">
<i class="fa fa-github fa-lg" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Programação em R (Nível Intermediário)</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Esse módulo terá o objetivo de detalhar o ambiente R, caracterizando melhor a sua linguagem, aprofundando <strong>manipulações de objetos</strong>, <strong>cópias de objetos</strong>, bem como <strong>ambientes</strong>. Falaremos sobre a criação de gráficos e <strong>documentações em R</strong>. Complementaremos também, sobre assuntos mais aprofundados como <strong>programação funcional</strong>, <strong>programação orientada a objetos</strong>, <strong>metaprogramação</strong> e uma introdução sobre <strong>desenvolvimento de pacotes</strong>. Por fim, ainda apresenderemos a desenvolver <strong>gráficos</strong>, e <strong>banco de dados</strong>.</p></p>
</div>


<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="panelset">
<section id="sumário" class="panel">
<h2>Sumário</h2>
<ul>
<li><a href="#caracteristasR"><i class="fab fa-r-project"></i> Caracterizando melhor o ambiente R</a></li>
<li><a href="#poo"><i class="fas fa-puzzle-piece"></i> Programação orientada a objetos</a>
<ul>
<li><a href="#objetos-oo-base">Nem tudo é orientado a objetos no R</a></li>
<li><a href="#objetos-base">Objetos base</a></li>
<li><a href="#sistemas-poo">Sistemas de POO no <code>R</code></a></li>
<li><a href="#sistemaS3">Sistema S3</a>
<ul>
<li><a href="#fgenericas">Funções genéricas</a></li>
<li><a href="#UseMethod">Entendendo melhor a chamada <code>UseMethod</code></a></li>
<li><a href="#criando_fgenericas">Criando funções genéricas</a></li>
<li><a href="#classeS3">Classe e classe implícita</a></li>
<li><a href="#metodoS3">Método S3</a></li>
<li><a href="#envio-herança">Envio de método e mecanismo de herança</a> <!-- - [Estratégias para o sistema S3](#estrategiaS3) --> <!-- - [Estilos de objetos POO S3](#est_obj_poo_s3) --></li>
</ul></li>
</ul></li>
<li><a href="#aprof-objetos"><i class="fas fa-arrow-circle-left"></i> Entendendo um pouco mais sobre objetos no <code>R</code></a>
<ul>
<li><a href="#atomic-recursive">Estruturas atômicas e recursivas</a></li>
<li><a href="#vectors">Usando <code>vector()</code>, <code>is.vector()</code> e <code>as.vector()</code></a></li>
<li><a href="#outros_obj">Conhecendo outros objetos</a>
<ul>
<li><a href="#datas_horas">Objeto para datas, horas, tempo, durações e fusos horários</a> <!-- - [Mais manipulações com objetos e subconjuntos](#manip_obj_adicionais) --></li>
</ul></li>
<li><a href="#copia_modif_tam_objetos">Cópia ao modificar, modificação no local e tamanho de objetos</a></li>
<li><a href="#coletor_lixo_desvinc">Coletor de lixo e desvinculação</a></li>
</ul></li>
<li><a href="#aprof-ambientes"><i class="fas fa-align-justify"></i> Aprofundamento sobre ambientes</a></li>
<li><a href="#prog_funcional"><i class="fab fa-connectdevelop"></i> Programação Funcional</a>
<ul>
<li><a href="#comp_funcoes">Composição de funções</a></li>
<li><a href="#op_un-binarios">Operadores binários</a></li>
<li><a href="#promessas">Avaliação preguiçosa dos argumentos de uma função</a></li>
<li><a href="#saida_funcoes">Saídas implícitas, explícitas, invisíveis de funções</a></li>
<li><a href="#funcoes_substituicao">Funções de substituição</a> <!-- - Sintaxe da família de Pacotes *Tidyverse* --> <!-- - Evitando *loops* --> <!-- - Funções recursivas --> <!-- Capítulo 8 - Conditions (Advanced R) --></li>
<li>Programação defensiva</li>
<li>Controle de fluxos usando paralelização</li>
</ul></li>
<li><a href=""><i class="fas fa-database"></i> Banco de dados</a></li>
<li><a href=""><i class="fas fa-chart-bar"></i> Gráficos</a></li>
<li><a href=""><i class="fas fa-folder"></i> Projetos no RStudio</a><br />
</li>
<li><a href=""><i class="fab fa-github-square"></i> Projetos R no GitHub</a></li>
<li><a href=""><i class="fas fa-box-open"></i> Introdução a desenvolvimento de pacotes</a></li>
<li><a href=""><i class="fas fa-file-alt"></i> Criação de documentações no R</a>
<ul>
<li>Documentos <em>Web</em>
<ul>
<li>Páginas estatísticas</li>
<li>Páginas dinâmicas</li>
</ul></li>
<li>Documentações de pacotes
<ul>
<li>Documentações de ajuda <em>.Rd</em></li>
<li>Página <em>Web</em> de pacotes</li>
</ul></li>
<li>Livros</li>
<li><em>Blogs</em> e <em>websites</em></li>
<li>Relatórios
<ul>
<li>Relatórios animados</li>
<li>Relatórios dinâmicos</li>
</ul></li>
<li>Demais documentos (PDF, WORD, EPUB)</li>
</ul></li>
</ul>
</section>
<section id="slidesaulas" class="panel">
<h2>Slides de Aulas</h2>
<ul>
<li>Aula 26: <a href="aulas/aula26.html" target="_blank">Apresentação do Curso</a></li>
<li>Aula 27: <a href="aulas/aula27.html" target="_blank">Caracterizando melhor o ambiente R</a></li>
<li>Aula 28: <a href="aulas/aula28.html" target="_blank">Introdução a POO no ambiente R</a></li>
<li>Aula 29: <a href="aulas/aula29.html" target="_blank">Tipos de objetos base</a></li>
<li>Aula 30: <a href="aulas/aula30.html" target="_blank">Sistemas de POO no R</a></li>
<li>Aula 31: <a href="aulas/aula31.html" target="_blank">Sistema S3</a></li>
<li>Aula 32: <a href="aulas/aula32.html" target="_blank">Sistema S3: Funções genéricas (POO no R)</a></li>
<li>Aula 33: <a href="aulas/aula33.html" target="_blank">Sistema S3: Chamada <em>UseMethod</em> (POO no R)</a></li>
<li>Aula 34: <a href="aulas/aula34.html" target="_blank">Sistema S3: Criando funções genéricas (POO no R)</a></li>
<li>Aula 35: <a href="aulas/aula35.html" target="_blank">Sistema S3: Classes e classes implícitas (POO no R)</a></li>
<li>Aula 36: <a href="aulas/aula36.html" target="_blank">Sistema S3: Métodos (POO no R)</a></li>
<li>Aula 37: Revisão sobre as aulas 27 a 36 <a href="aulas/aula37.html" target="_blank">Slide</a> <a href="https://youtu.be/jEDoCWQZkdY" target="_blank">Vídeo-aula</a> <a href="https://bendeivide.github.io/cursor/scripts/aula19/script19.R" target="_blank">Script R</a></li>
<li>Aula 38: <a href="aulas/aula38.html" target="_blank">Sistema S3: Envio (despacho) de métodos</a></li>
<li>Aula 39: <a href="aulas/aula39.html" target="_blank">Sistema S3: Mecanismo de herança</a> <!-- - Aula 39: [Sistema S3:  Estratégias para o sistema S3](aulas/aula38.html){target="_blank"} --> <!-- - Aula 40: [Sistema S3:  Estilos de objetos](aulas/aula39.html){target="_blank"} --></li>
<li>Aula 40: <a href="aulas/aula40.html" target="_blank">Entendendo um pouco mais sobre objetos: estruturas atômicas ou recursivos</a></li>
<li>Aula 41: <a href="aulas/aula41.html" target="_blank">Conhecendo outros objetos: Datas</a></li>
<li>Aula 42: <a href="aulas/aula42.html" target="_blank">Conhecendo outros objetos: Datas, horas e fusos horários</a></li>
<li>Aula 43: <a href="aulas/aula43.html" target="_blank">Cópia ao modificar, modificação no local de vetores</a></li>
<li>Aula 44: <a href="aulas/aula44.html" target="_blank">Cópia ao modificar, modificação no local em funções</a></li>
<li>Aula 45: <a href="aulas/aula45.html" target="_blank">Cópia ao modificar, modificação no local em listas</a></li>
<li>Aula 46: <a href="aulas/aula46.html" target="_blank">Cópia ao modificar, modificação no local em quadro de dados (<em>Data frames</em>)</a></li>
<li>Aula 47: <a href="aulas/aula47.html" target="_blank">Cópia ao modificar, modificação no local de vetores caracteres (<em>strings</em>)</a></li>
<li>Aula 48: <a href="aulas/aula48.html" target="_blank">Tamanho de objetos</a> <!-- - Aula 49: [Coletor de lixo e desvinculação](aulas/aula49.html){target="_blank"} --></li>
<li>Aula 49: <a href="aulas/aula49.html" target="_blank">Ambientes: Introdução aprofundada</a></li>
<li>Aula 50: <a href="aulas/aula50.html" target="_blank">Ambientes funcionais</a></li>
<li>Aula 51: <a href="aulas/aula51.html" target="_blank">Ambientes em pacotes</a></li>
<li>Aula 52: <a href="aulas/aula52.html" target="_blank">Programação funcional: Introdução</a></li>
<li>Aula 53: <a href="aulas/aula53.html" target="_blank">Programação funcional: Composição de funções</a></li>
<li>Aula 54: <a href="aulas/aula54.html" target="_blank">Programação funcional: Operadores unários e binários</a></li>
<li>Aula 55: <a href="aulas/aula55.html" target="_blank">Programação funcional: Avaliação preguiçosa dos argumentos de uma função</a></li>
<li>Aula 56: <a href="aulas/aula56.html" target="_blank">Programação funcional: Saídas implícitas, explícitas, invisíveis de funções</a></li>
<li>Aula 57: <a href="aulas/aula57.html" target="_blank">Programação funcional: funções de substituição</a></li>
<li>Aula 58: <a href="aulas/aula58.html" target="_blank">Programação funcional: Vetorização de funções</a></li>
<li>Aula 59: <a href="aulas/aula59.html" target="_blank">Programação funcional: funções da família <em>apply</em></a></li>
<li>Aula 60: <a href="aulas/aula60.html" target="_blank">Programação funcional: funções recursivas</a></li>
<li>Aula 61: <a href="aulas/aula61.html" target="_blank">Programação defensiva em funções</a></li>
<li>Aula 62: <a href="aulas/aula62.html" target="_blank">Projetos no RStudio</a></li>
<li>Aula 63: <a href="aulas/aula63.html" target="_blank">Projetos no Github</a></li>
<li>Aula 64: <a href="aulas/aula64.html" target="_blank">Introdução a desenvolvimento de pacotes</a></li>
<li>Aula 65: <a href="aulas/aula65.html" target="_blank">Introdução a criação de documentos no R</a></li>
<li>Aula 66: <a href="aulas/aula66.html" target="_blank">Criações de livros</a></li>
<li>Aula 67: <a href="aulas/aula67.html" target="_blank">Página <em>web</em> via pacote <em>distill</em></a></li>
<li>Aula 68: <a href="aulas/aula68.html" target="_blank">Página <em>web</em> via pacote <em>blogdown</em></a></li>
<li>Aula 69: <a href="aulas/aula69.html" target="_blank">Página <em>web</em> via pacote <em>pkgdown</em></a></li>
<li>Aula 70: <a href="aulas/aula70.html" target="_blank">Preparação para o módulo avançado</a></li>
</ul>
</section>
<section id="scripts" class="panel">
<h2>Scripts</h2>
<ul>
<li>Script 00:</li>
</ul>
</section>
<section id="shiny" class="panel">
<h2>Exercícios e Scripts via <a href="https://shiny.rstudio.com/">Shiny</a></h2>
<p><a href="https://bendeivide.shinyapps.io/Curso-R/">Curso R via Shiny</a></p>
</section>
</div>
<hr />
<h1 id="apresentacao"><i class="fas fa-book"></i> Apresentação do curso</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/tegLquZ1jsw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>O Curso <code>R</code> será todo aprensentado no formato online, sendo que as aulas terão vídeos como suporte, postados no canal <a href="http://youtube.com/bendeivide" target="_blank">Youtube/Ben Dêivide</a> divulgados ao longo do material. Os vídeos serão bem objetivos de curta duração para que usem como suporte com o material escrito. Como complemento desse material, disponibilizaremos os <a href="#scripts"><em>scripts</em></a> com os comandos utilizados em cada aula e sua versão em <a href="#shiny"><em>Shiny</em></a> para os que não quiserem realizar inicialmente a instalação do R e do RStudio, poderão utilizar uma versão <em>online</em> do material juntamente com a linguagem <code>R</code>.</p>
<h1 id="caracteristasR"><i class="fab fa-r-project"></i> Caracterizando melhor o ambiente R</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mrJqW8yJLx0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Ao estudarmos o <a href="nbasico.html">módulo básico</a> do Curso R, conseguimos obter uma visão geral sobre o ambiente <code>R</code>, de modo que o aprofundamento sobre a linguagem se faz necessário, para quem deseja não apenas executar rotinas prontas, mas de fato, um contribuidor para a linguagem, como também um desenvolvedor de suas próprias funções.</p>
<p>Na Figura <a href="#fig:rworks">1</a>, apresentamos um resumo do que buscamos repassar no primeiro módulo. Agora, iremos no módulo intermediário, de fato, entender os dois princípios: Objeto e Função, para que fique claro que nem tudo no <code>R</code> é orientado a objetos, e que a rigor o <code>R</code> não é uma linguagem de programação funcional. Com essas informações, dentre outras, o programador poderá ter um maior controle sobre o desenvolvimento de suas próprias rotinas e funções.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:rworks"></span>
<img src="images/rworks2.png" alt="Relembrando como o `R` funciona." width="100%" />
<p class="caption">
Figure 1: Relembrando como o <code>R</code> funciona.
</p>
</div>
</div>
<p>Vamos inicialmente caracterizar melhor o R. Por que usamos os termos <strong>linguagem</strong>, <strong>software</strong> ou <strong>ambiente</strong> para o <code>R</code>? Na página do <code>R</code>, na seção <a href="https://www.r-project.org/about.html"><em>about</em></a> se inicia com a primeira pergunta: O que é o R? Em resposta da própria página e utilizando também como resposta a nossa indagação inicial, o “R é uma linguagem e ambiente para computação estatística e gráficos,” que ainda complementa que essa linguagem é uma implementação diferente da linguagem <code>S</code>, linguagem essa do qual inclui as principais implementações para análise estatística. Contudo, ocorrem algumas diferenças dentre as quais já apresentamos no <a href="nbasico.html#rhistory">módulo básico</a>, a presença do <strong>escopo léxico</strong> no <code>R</code>, que não ocorre na linguagem <code>S</code>. Desse modo, percebemos que o <code>R</code> é uma <strong>linguagem interpretada</strong>, pois além da linguagem <code>S</code> (o que fácil para os usuários a implementação do código), a sua base foi programada em <code>C</code> e <code>FORTRAN</code> (para computação mais intensiva). Mas também, adjetivamos o <code>R</code> como <strong>ambiente de software</strong> ao invés de apenas <strong>software</strong>, e aqui predominaremos esse termo, pois segundo ainda na própia página do <code>R</code> se “pretende caracterizá-lo como um sistema totalmente planejado e coerente, ao invés de um acréscimo incremental de ferramentas muito específicas e inflexíveis, como é frequentemente o caso com <em>outros softwares de análise de dados</em>.” Assim, esse ambiente inclui:</p>
<ul>
<li>manipulação de dados;</li>
<li>operações com matrizes;</li>
<li>coleção de ferramentas para análise de dados;</li>
<li>criação e apresentações gráficas, para apresentação dos dados;</li>
<li>linguagem que inclui condicionais, fluxos de controle, funções recursivas definidas pelo usuário e recursos de entrada e saída;</li>
<li>Documentação e relatórios de análises.</li>
</ul>
<p>Existem linguagens como <code>C</code> e <code>FORTRAN</code>, por exemplo, que a execução do código nessas linguagem precisam de uma compilação, para depois serem executadas, isto é, as linhas de códigos programadas pelo usuário precisam ser convertidas na linguagem de máquina, para que depois seja executa. Porém, no <code>R</code>, quando escrevemos uma linha de comando no console, do tipo:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 10</code></pre>
</div>
<p>Percebemos no <code>R</code> o código é automaticamente interpretado conforme o usuário executa. Desse modo, caracterizamos a linguagem de <strong>programação dinâmica</strong>. A ideia se estende a avaliação de funções, a extensão da linguagem sem o uso de macros, e a manipulação com ambiente. Ainda mais, podemos afirmar também que essa dinamicidade está relacionada ao fato do <code>R</code> também ser uma <strong>linguagem fortemente e dinamicamente tipada</strong>. Nesse caso, os valores contidos nos objetos é que são tipados. Por exemplo, vetores atômicos apresentam sempre elementos com mesmo tipo. Porém, à medida que adicionamos elementos ao vetor, pode haver a coersão da tipagem dos elementos, quando esses elementos apresentam tipos diferentes, como foi abordado no módulo básico, na seção <a href="nbasico.html#coersao">coersão</a>. Vejamos um exemplo, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vetor</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>; <span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>vetor</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;logical&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vetor</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>vetor</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;double&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vetor</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"1"</span>; <span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>vetor</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;character&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>vetor</span>
</code></pre>
</div>
<pre><code>[1] &quot;1&quot; &quot;1&quot; &quot;1&quot;</code></pre>
</div>
<p>Observemos que o objeto associado ao nome <code>vetor</code> vai alterando a tipagem por coersão, é o comportamento dinâmico da linguagem. Observe que o nome <code>vetor</code> é um objeto de tipo <em>symbol</em> e o vetor <code>c("1", "1" "1")</code> é outro objeto, cujos os elementos foram coagidos a tipagem <code>character</code>. Claro, que o acesso ao vetor só é possível recuperar da memória ativa, se este estiver associado a algum nome, no caso <code>vetor</code>. Porém, não é o nome que altera o seu tipo, mas os elementos do objeto associado a este nome, em que, por ser um verto atômico, seus elementos devem apresentar o mesmo tipo.</p>
<p>A ideia do <code>R</code> como uma linguagem de programação com <strong>estilo funcional</strong>, se deve pelo fato da linguagem ter funções de primeira classe, <code>function()</code>, isto é, funções que se comportam como qualquer outro objeto no ambiente <code>R</code>. Por exemplo, podemos atribuir nomes as nossas funções, armazená-las em listas, serem criadas dentro de outras funções, serem argumentos de outras funções, ou até ser um resultado de uma função. Inclusive na versão do <code>R</code> 4.1, a função <code>function()</code> ganhou um novo formato, que também pode ser usado. Vejamos o exemplo:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Forma original</span>
<span class='va'>soma1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fl'>1</span>; <span class='fu'>soma1</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Forma alternativa (&gt;= R 4.1)</span>
<span class='va'>soma1</span> <span class='op'>&lt;-</span> \<span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fl'>1</span>; <span class='fu'>soma1</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
</div>
<p>Para complementar atualizações dessa versão, uma outra importante foi implemento da função <em>pipe</em> (<code>%&gt;%</code>). Originalmente, a função <em>pipe</em> (lê-se paipe) é do pacote <a href="https://magrittr.tidyverse.org/">magrittr</a> da família de pacotes <a href="https://www.tidyverse.org/">tidyverse</a>, do qual é um operador binário em que o primeiro operando é um objeto para a entrada de dados, e o segundo é uma função. Nesse caso, o objeto no primeiro operando entrará no primeiro argumento da função no segundo operando. Vejamos um exemplo, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># install.packages(magrittr) # Instalando o pacote</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://magrittr.tidyverse.org'>magrittr</a></span><span class='op'>)</span> <span class='co'># anexando o pacote</span>
<span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span> <span class='op'>%&gt;%</span> <span class='va'>mean</span>
</code></pre>
</div>
<pre><code>[1] 5.5</code></pre>
</div>
<p>Observe que calculamos a média do vetor <code>1:10</code>. Agora, a versão do <em>pipe</em> nativa no <code>R</code> (&gt;= 4.1), sua sintaxe é <code>|&gt;</code>. Vejamos o mesmo exemplo usado anteriormente, agora com a função nativa, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span> |&gt; <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 5.5</code></pre>
</div>
<p>A diferença no caso do <em>pipe</em> nativo é que no segundo argumento, além do nome da função, acrescemos o parênteses sem seus argumentos. <strong>Lembrando que o primeiro operando entrará no primeiro argumento da função (segundo operando)</strong>.</p>
<p>Retornando a programação funcional, sabemos que o <code>R</code> não é estritamente funcional. A definição de programação funcional apresenta algumas características, dentre elas, que a linguagem apresente:</p>
<ul>
<li>Composição de funções;</li>
<li>Funções puras;</li>
<li>Imutabilidade;</li>
<li>Efeito colateral;</li>
</ul>
<p>A ideia da <strong>composição de funções</strong> representa a criação de funções por meio de outras funções, e isso está dentro da linguagem <code>R</code>. Por exemplo, vamos criar uma função que calcula a média de um conjunto de dados, usando a função, <code>mean()</code>, já existente no pacote <code>base</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='va'>media</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='fu'>media</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 5.5</code></pre>
</div>
<p>A caracterização de <strong>funções puras</strong>, significa que as funções sempre retornam o mesmo resultado, dados os mesmos parâmetros de entrada, isto significa que não existe <strong>efeito colateral</strong>. Um exemplo de função pura, pode ser como:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fpura</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"x deve ser numérico"</span><span class='op'>)</span>
  <span class='va'>x</span> <span class='op'>+</span> <span class='fl'>1</span>
<span class='op'>}</span>
<span class='fu'>fpura</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 3</code></pre>
</div>
<p>Observe que <code>fpura()</code> toda vez que a entrada for <code>x = 2</code>, o resultado sempre será o resultado <code>3</code>. Porém, o <code>R</code> se exclui dessa característica estritamente funcional, quando aprensentamos funções: <code>runif()</code>, <code>rnorm()</code>, <code>read.csv()</code>, dentre outras. Por exemplo, a função <code>rnorm()</code> representa um gerador de números aleatórios de uma distribuição normal, do qual se executarmos essa função, mais de uma vez, usando a mesma entrada para o argumento <code>n = 3</code>, o resultado não será sempre o mesmo, observe:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1]  1.0337700  0.3647557 -0.2428575</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -1.5657441  0.6763031 -1.4781201</code></pre>
</div>
<p>A <strong>imutabilidade</strong> na programação funcional apresenta em uma linguagem na situação em que uma variável ou objeto é criado, e este não pode ser modificado. Esta é outra característica que ocorre no <code>R</code>, mas não para todos os objetos em que exitem nomes associados, é o caso da <strong>modificação no local</strong>. Por exemplo, vamos apresentar um contra-exemplo de que nem todos os objetos no <code>R</code> são imutáveis. Vejamos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criamos um vetor e associamos ao nome 'x'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>
<span class='co'># Vejamos o identificador de memória</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='co'># &gt; "0xcf09be4708"</span>
<span class='co'># Modificando no local</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>; <span class='va'>x</span>
<span class='co'># [1] 1 4 3</span>
<span class='co'># Mesmo modificando o objeto, o identificador eh o mesmo</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='co'># &gt; "0xcf09be4708"</span>
</code></pre>
</div>
</div>
<p>Para a execução dessas linhas de comando, sugerimos que não utilizem diretamente o RStudio, porque a IDE sempre faz uma referência a cada objeto. Sugerimos que utilize a própria interface do <code>R</code>. Esse tema será aprodundado mais a frente, na seção <a href="#aprof-objetos">entendendo um pouco mais sobre objetos</a>.</p>
<p>Por fim, duas outras características importantes do estilo funcional da linguagem, é o <strong>escopo léxico</strong> das funções, assunto abordado no <a href="nbasico.html">módulo básico</a>, e a <strong>execução preguiçosa</strong>, do qual o argumentos das funções são avaliados apenas quando utilizados. Vejamos, o exemplo a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>preguicoso</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>a</span>, <span class='va'>b</span> <span class='op'>=</span> <span class='fu'>faux</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  <span class='va'>a</span> <span class='op'>*</span> <span class='fl'>100</span>
<span class='fu'>preguicoso</span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 400</code></pre>
</div>
<p>Observemos nesse caso, que o argumento <code>b</code> recebe uma função <code>aux()</code> que não existe. Contudo, ao executar a linha de comando seguindo, a função <code>preguicoso</code> retorna o resultado <code>400</code> sem erro. Isso porque como não foi necessário utilizar o argumento <code>b</code> no corpo da função, este não foi avaliado, e portanto, sem retorno de erro da função <code>preguicoso</code>. Iremos mais a frente, detalhar essa característica de modo mais aprofundado.</p>
<p>O <code>R</code> não é uma linguagem totalmente orientada a objetos, como afirmado por alguns. Apesar, de um dos princípios do <code>R</code> que tudo é um objeto, não significa dizer que tudo é orientado a objetos. Isso se deve ao fato de que os primeiro objetos criados no <code>R</code>, que chamaremos de <strong>objetos base</strong>, foram desenvolvidos baseados na linguagem <code>S</code>. E nesse tempo não havia qualquer cogitação de que fosse necessário um sistema de programação orientada a objetos (POO). Veremos mais a frente, que a distinção básica entre objetos base e objetos baseados em sistemas orientados a objetos, chamaremos de <strong>objetos POO</strong>, é que estes últimos terão o atributo <code>class</code>, do qual podemos consultá-lo pela função <code>attr()</code>. Vejamos, alguns exemplos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objetos POO</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='fu'>ggplot2</span><span class='fu'>::</span><span class='va'><a href='https://ggplot2.tidyverse.org/reference/diamonds.html'>diamonds</a></span>, <span class='st'>"class"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objetos base</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='st'>"class"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>NULL</code></pre>
</div>
<p>Quando não há o atributo <code>class</code>, isto é, <code>NULL</code>, é objeto base. Contudo, iremos na seção <a href="#poo">Programação orientada a objetos</a> saber em que sistemas esses objetos estão orientados, porque no <code>R</code>, diferentemente de outras linguagens, existem vários sistemas POO, como: S3, S4 R5 (classes de referências), R6, dentre outros.</p>
<p>Por fim, como última caracterização do <code>R</code> abordada é como uma linguagem de programação metaparadigma ocorre porque pela própria linguagem, poderemos inspecioná-la, modificá-la, por ela mesma, como se fosse um objeto, o que acaba tornando uma ferramenta muito poderosa. E isso será tema abordado mais a frente.</p>
<p>Portanto, esclarecido isso, e ainda com as demais características apresentadas no <a href="nbasico.html">módulo básico</a>, dizemos que o <code>R</code> é:</p>
<ul>
<li>um ambiente de software livre e código aberto, com licença GNU;</li>
<li>umalinguagem de programação interpretada;</li>
<li>uma linguagem de programação dinâmica;</li>
<li>uma linguagem de programação funcional;
<ul>
<li>de escopo lêxico;</li>
<li>avaliação preguiçosa;</li>
</ul></li>
<li>uma linguagem de programação orientada a objetos;</li>
<li>uma linguagem de tipagem forte e dinâmica; e</li>
<li>uma linguagem de programação metaparadigma.</li>
</ul>
<!-- # Evolução do R -->
<!-- https://en.wikipedia.org/wiki/R_(programming_language) -->
<h1 id="poo"><i class="fas fa-puzzle-piece"></i> Programação orientada a objetos</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/x4gpW5Ip-uE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Assim como no nosso dia a dia podemos realizar uma mesma tarefa de modos diferentes, isso ocorre também na programação. Nesse caso, dizemos que esses modos são os paradigmas da programação. E a programação orientada a objetos (POO) é um desses paradigmas que veio para contornar alguns problemas da programação estrutural, um outro paradigma.</p>
<p>Antes de apresentarmos outras diferenças entre os objetos base e objetos OO, se faz necessário entendermos alguns conceitos da POO, do qual tudo se desencadeará pelos termos <strong>classe</strong>, <strong>objeto</strong> e <strong>método</strong>. Para isso, vamos ilustrar alguns termos baseados no nosso cotidiano. Uma das grandes cobiças nessa era digital é ter um bom <em>smartphone</em> para que possamos estar conectados nessa era digital, bem não sei se foi bem esse objetivo do <em>smartphone</em>, mas consideremos que tenha sido. Essa escolha se deve a algumas <em>características</em> tamanho, cor, desempenho, câmera, dentre outras. Outro fator que pode ter sido o motido da sua escolha é o <em>comportamento</em> desse celular, como o seu desempenho do processador, a velocidade com o qual se desenvolve as atividades, a forma como os aplicativos reagem as suas ações, o sistema como o algoritmo baseado em inteligência artificial interage com todo o sistema operacional do aparelho, dentre outros. Nesse momento, fazendo uma relação com o ambiente <code>R</code>, dizemos que o celular que desejamos é o objeto, suas características são os atributos do objeto, e o comportamento será o método aplicado a este objeto na programação orientada a objetos.</p>
<p>Mesmo que seu aparelho apresente um IMEI (Código de identificação do aparelho) único, nós sabemos que existem diversos aparelhos com essa mesma configuração, modelo e marca, alguns outros com pequenas características que o diferenciam, mas conseguimos identificar ainda assim, esse objeto como um celular. Portanto, podemos dizer que o celular é uma <em>classe</em> para o ambiente <code>R</code>, em que apesar de termos diversos objetos, estes são identificados dentro de um conjunto de características que o definem como celular. Nesse caso, dizemos ainda que o celular que escolhemos é uma <em>instância</em> dessa classe, que apesar de ter atributos próprios, ainda assim, é identificado como um celular. Desse modo, ao ser definidos as classes de determinados objetos, a linguagem saberá utilizar o método correto para tal objeto, isso significa que mesmo que não saibamos como ocorre, devemos confiar que ocorrerá. Isso é programação orientada a objetos.</p>
<p>Teríamos mais analogias para abordar, como <strong>encapsulamento</strong>, <strong>hierarquias</strong> , <strong>envio (ou despacho) de método</strong>, <strong>polimorfismo</strong>, <strong>subclasses</strong>, <strong>superclasses</strong>, dentre outras. Mas, vamos deixar para discutir ao longo das aplicações.</p>
<p>Assim, esse paradigma da programação permite associarmos o desenvolvimento do nosso código pra dentro de nossa realidade humana. Porém a ideia de POO dentro do <code>R</code> sai do escopo de implementações densenvolvidas em outras linguagens. Antes de entrarmos no tema propriamente dito, queremos ressaltar que não estamos interessados em repassar uma POO eficiente, devido a todo o cunho teórico exigido para o assunto. Mas, queremos repassar como os principais sistemas de POO foram desenvolvidos dentro do <code>R</code>.</p>
<h2 id="objetos-oo-base">Nem tudo é orientado a objetos no R</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/npVwzYBIpZ0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Uma primeira ideia que temos que saber é que apenas de um dos princípios que tudo no <code>R</code> é um objeto, mas nem tudo é orientado a objetos. Isso ocorre, porque discutimos anteriormente, que o <code>R</code> é um dialeto da linguagem <code>S</code>. No início do desenvolvimento da linguagem <code>S</code>, John Chambers e seus colaboradores nem cogitavam para a implementação do código a programação orientada a objetos, desse modo, o <code>R</code> quando começou a ser densevolvido, os primeiros objetos desenvolvidos foram vêm dessas primeiras versões da linguagem <code>S</code>, sem ainda a implementação de POO.</p>
<p>Dessa forma, vamos distinguir o <code>R</code> com dois tipos de objetos:</p>
<ul>
<li><strong>Objetos POO</strong> (Objetos para POO)</li>
<li><strong>Objetos base</strong> (Objetos não voltados a POO)</li>
</ul>
<p>A principal diferença técnica é que um <strong>objeto POO</strong> terá o atributo <code>class</code>, e o <strong>objeto base</strong>, não. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto "data.frame"</span>
<span class='va'>objPOO</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='fl'>1</span>, b <span class='op'>=</span> <span class='st'>"1"</span>, c <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># Objeto "data.frame" eh um objeto POO?</span>
<span class='fu'><a href='https://rdrr.io/r/base/is.object.html'>is.object</a></span><span class='op'>(</span><span class='va'>objPOO</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor de comprimento 10</span>
<span class='va'>objBASE</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='co'># O vetor eh um objeto POO?</span>
<span class='fu'><a href='https://rdrr.io/r/base/is.object.html'>is.object</a></span><span class='op'>(</span><span class='va'>objBASE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
</div>
<p>Pela função <code>is.object()</code>, sabemos se um objeto é de POO ou não. Entretanto, no <code>R</code> temos diversos sistemas POO, alguns da base de instalação do programa, e outros disponíveis no CRAN. Detalharemos os tipos, a seguir.</p>
<h2 id="objetos-base">Objetos base</h2>
<p>Existem 24 tipos de objetos diferentes no <code>R</code> (antes eram 26, porém o objetos referentes a fatores e fatores ordenados foram retirados). A base de criação desses objetos foram a linguagem <code>C</code>, e que na realidade são ponteiros para uma estrutura com <code>typedef</code> <code>SEXPREC</code>. Os seus tipos estão representados por <code>SEXPTYPE</code>, que determina como as características da estrutura são usadas. Para mais detalhes, ler <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html">R Language Definition</a> e <a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.html">R Internals</a>. Alguns tipos são importantes para o usuário <code>R</code>, outros apenas com importância interna ao ambiente <code>R</code>, dos quais esses tipos podem ser identificados pela função <code>typeof()</code>, que segue:</p>
<table>
<colgroup>
<col style="width: 39%" />
<col style="width: 41%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Representação em <code>R</code></th>
<th style="text-align: left;">Representação em <code>C</code> (<code>SEXPTYPE</code>)</th>
<th style="text-align: left;">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>NULL</code></td>
<td style="text-align: left;"><code>NILSXP</code></td>
<td style="text-align: left;">Único vetor que tem comprimento zero e não pode ter atributo</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>logical</code></td>
<td style="text-align: left;"><code>LGLSXP</code></td>
<td style="text-align: left;">Vetores lógicos</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>integer</code></td>
<td style="text-align: left;"><code>INTSXP</code></td>
<td style="text-align: left;">Vetores inteiros</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><code>REALSXP</code></td>
<td style="text-align: left;">Vetores reais</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>complex</code></td>
<td style="text-align: left;"><code>CPLXSXP</code></td>
<td style="text-align: left;">Vetores complexos</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>character</code></td>
<td style="text-align: left;"><code>STRSXP</code></td>
<td style="text-align: left;">Vetores caracteres (<em>strings</em>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>list</code></td>
<td style="text-align: left;"><code>VECSXP</code></td>
<td style="text-align: left;">Listas</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>raw</code></td>
<td style="text-align: left;"><code>RAWSXP</code></td>
<td style="text-align: left;">Vetores brutos</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>closure</code></td>
<td style="text-align: left;"><code>CLOSXP</code></td>
<td style="text-align: left;">Funções criadas por meio de <code>function()</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>special</code></td>
<td style="text-align: left;"><code>SPECIALSXP</code></td>
<td style="text-align: left;">Funções primitivas (funções básicas e operadores) que são escritas principalmente na linguagem <code>C</code>. Desse modo, essas funções não apresentam as três estruturas básicas de uma função do tipo <code>closure</code>, como <code>formals()</code>, <code>body()</code>, <code>environment()</code>, que são todas <code>NULL</code>. Aprofundaremos esse objeto no <a href="navancado.html">módulo avançado</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bultin</code></td>
<td style="text-align: left;"><code>BUILTINSXP</code></td>
<td style="text-align: left;">Funções primitivas (funções básicas e operadores) que são escritas principalmente na linguagem <code>C</code>. Desse modo, essas funções não apresentam as três estruturas básicas de uma função do tipo <code>closure</code>, como <code>formals()</code>, <code>body()</code>, <code>environment()</code>, que são todas <code>NULL</code>. Aprofundaremos esse objeto no <a href="navancado.html">módulo avançado</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>environment</code></td>
<td style="text-align: left;"><code>ENVSXP</code></td>
<td style="text-align: left;">Ambientes</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>S4</code></td>
<td style="text-align: left;"><code>S4SXP</code></td>
<td style="text-align: left;">Objetos com sistema POO <strong>S4</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>symbol</code></td>
<td style="text-align: left;"><code>SYMSXP</code></td>
<td style="text-align: left;">Nomes associados aos objetos</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>language</code></td>
<td style="text-align: left;"><code>LANGSXP</code></td>
<td style="text-align: left;">Objetos de linguagem, que abordaremos na seção sobre metaprogramação</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pairlist</code></td>
<td style="text-align: left;"><code>LISTSXP</code></td>
<td style="text-align: left;">Argumento das funções</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>expression</code></td>
<td style="text-align: left;"><code>EXPRESXP</code></td>
<td style="text-align: left;">Vetores de expressão</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>externalptr</code></td>
<td style="text-align: left;"><code>EXTPTRSXP</code></td>
<td style="text-align: left;">Ponteiro externo, são vetores exóticos que tem importância para a linguagem <code>C</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>weakref</code></td>
<td style="text-align: left;"><code>WEAKREFSXP</code></td>
<td style="text-align: left;">Referência fraca, são vetores exóticos que tem importância para a linguagem <code>C</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>bytecode</code></td>
<td style="text-align: left;"><code>BCODESXP</code></td>
<td style="text-align: left;">Código de byte, são vetores exóticos que tem importância para a linguagem <code>C</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>promise</code></td>
<td style="text-align: left;"><code>PROMSXP</code></td>
<td style="text-align: left;">Promessas, são objetos responsáveis pelo pelo carregamento preguiçoso dos argumentos de uma função</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>...</code></td>
<td style="text-align: left;"><code>DOTSXP</code></td>
<td style="text-align: left;">Objeto utilizado como um argumento da função, após a criação de uma função, ainda assim, podem ser inseridos mais argumentos</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>any</code></td>
<td style="text-align: left;"><code>ANYSXP</code></td>
<td style="text-align: left;">Objeto que representa qualquer tipo. Raramente utilizado em <code>R</code>, mas aparece por exemplo em <code>as.vector(x, mode = "any")</code>, considerando que <code>x</code> é um objeto <code>R</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">-</td>
<td style="text-align: left;"><code>CHARSXP</code></td>
<td style="text-align: left;">Cadeia de caracteres internas, isto é, um tipo de escalar <em>string</em>, usado somente internamente</td>
</tr>
</tbody>
</table>
<p>Todas as funcões que usam esses <strong>objetos base</strong> e apresentam comportamento diferentes, não usam o sitema POO, porque foram implementadas em sua maioria na linguagem <code>C</code>, usando a instrução <code>switch</code>, em que também aprofundaremos no <a href="navancado.html">módulo avançado</a>.</p>
<h2 id="sistemas-poo">Sistemas de POO no <code>R</code></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/nvSuHOK5ZPE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Usando as ideias de <span class="citation" data-cites="chambers2016"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>, complementadas por <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, dizemos que o paradigma da programação orientada a objetos pode ser dividida em dois ramos:</p>
<ul>
<li><strong>POO encapsulada</strong>: os métodos são encapsulado em suas classes, isto é, os objetos nesse estilo de programação contém os seus comportamentos;</li>
<li><strong>POO funcional</strong>: os métodos pertencem as funções, das quais serão aplicadas aos objetos de determinada classe.</li>
</ul>
<p>O <code>R</code> em sua base, apresenta três sistemas de POO: <strong>S3</strong>, <strong>S4</strong> e <strong>CR</strong> (classes de referência). No <em>CRAN</em>, existem diversas implementações de POO, das quais podemos citar: <strong>R6</strong> (pacote <a href="https://r6.r-lib.org/">R6</a>), <a href="https://github.com/HenrikBengtsson/R.oo">R.oo</a>, <a href="https://github.com/hadley/proto">proto</a>, dentre outros.</p>
<p>Exploraremos para esse momento, apenas o sistema <strong>S3</strong> (POO funcional), em que o sitema <strong>S4</strong> também apresenta o paradigma POO funcional. Esses dois sistemas foram a evolução da implementação de POO na linguagem <code>S</code> implementadas no <code>R</code>. Contudo, os seus nomes geram a impressão de que também haviam os sistemas S1 e S2, mas não, os nomes <strong>S3</strong> e <strong>S4</strong> se devem as versões da linguagem <code>S</code>, como evolução da linguagem em si. Nesses momentos, foram o marco para a incorporação da programação orientada a objetos na linguagem, em que antes não existia, por isso, não haver sistemas S1 e S2.</p>
<p>Para complementar a carcterização dos sistemas citados, os sistemas <strong>RC</strong> e <strong>R6</strong> apresentam o paradigma POO encapsulado. Os demais sistemas implementados nos pacotes disponíveis no CRAN, como <a href="https://github.com/HenrikBengtsson/R.oo">R.oo</a> fornece algum formalismo em cima de S3 e torna possível ter objetos S3 mutáveis (<span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>), e <a href="https://github.com/hadley/proto">proto</a> que implementa outro estilo de OOP baseado na ideia de protótipos , que confundem as distinções entre classes e instâncias de classes (objetos) (<span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>), do qual foi o sistema implementado para o pacote <a href="https://ggplot2.tidyverse.org/">ggplot2</a>.</p>
<h2 id="sistemaS3">Sistema S3</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/aMTHWwYKiNQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<!-- Depois modificar esse parágrafo inicial, após descrever os demais métodos -->
<p>Poderíamos descrever todos os sistemas, porém restringiremos ao sistema <strong>S3</strong>, por uma única razão, é o sistema amplamente empregado aos objetos dos pacotes <strong>base</strong> e <strong>stats</strong>, bem como na maioria dos pacotes disponíveis no <em>CRAN</em>. Mais detalhes sobre o sistema, sugerimos leituras em <span class="citation" data-cites="chambers2016"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>, <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, <span class="citation" data-cites="chambers2008"><a href="#ref-chambers2008" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2008" role="doc-biblioref">2008</a>)</span>, <span class="citation" data-cites="chambers1991"><a href="#ref-chambers1991" role="doc-biblioref">Chambers and Hastie</a> (<a href="#ref-chambers1991" role="doc-biblioref">1991</a>)</span>, dentre outros materiais.</p>
<p>Como falado anteriormente, um objeto POO terá sempre um atributo <code>class</code>, em que podemos utilizar a função <code>atributes</code> para verificar isso. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>quadro_dados</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='fl'>1</span>, b <span class='op'>=</span> <span class='cn'>TRUE</span>, c <span class='op'>=</span> <span class='st'>"A"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>quadro_dados</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$names
[1] &quot;a&quot; &quot;b&quot; &quot;c&quot;

$class
[1] &quot;data.frame&quot;

$row.names
[1] 1</code></pre>
</div>
<p>O fato do objeto <code>quadro_dados</code> ter o atributo <code>class=data.frame</code>, lhe dá um comportamento especial a determinadas funções genéricas. Vejamos como imprimos essa função pela funcão <code>print()</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>quadro_dados</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  a    b c
1 1 TRUE A</code></pre>
</div>
<p>Removendo esse atributo do objeto, por meio da função <code>unclass()</code>, voltamos ao tipo de objeto base subjascente. Dessa forma, a função <code>print</code> perde esse comportamento especial, apresentada a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>quadro_dados</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$a
[1] 1

$b
[1] TRUE

$c
[1] &quot;A&quot;

attr(,&quot;row.names&quot;)
[1] 1</code></pre>
</div>
<p>Isso significa, que o objeto <code>data.frame</code> perde seu comportamento especial e retorna ao mesmo comportamento de uma lista. Afinal, falamos no módulo básico que um objeto <code>data.frame</code> é uma lista.</p>
<h3 id="fgenericas">Funções genéricas</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/wQiwTa-s9Bw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>A base do sistema <strong>S3</strong> está nas <strong>funções genéricas</strong> ou também podemos chamar de <strong>genéricos</strong>, que buscam o método específico para determinada classe de um objeto. Esta função representa um intermediário do sistema <strong>S3</strong>, do qual define os argumentos de entrada, e na sequência, encontra o método certo, baseado na classe do objeto associado ao primeiro argumento da função genérica. Para sabermos se uma função é genérica, temos algumas funções: <code>utils::isS3stdGeneric()</code> e <code>sloop::ftype()</code>. Verificando esta última função, além de informar se é uma função genérica, informa também o sistema POO, além do que a função <code>utils::isS3stdGeneric()</code> apenas retorna <code>TRUE</code>, as funções genéricas <strong>S3</strong> que apresentam no corpo de sua função, a chamada <code>UseMethod</code>. Vale lembrar, que funções primitivas/internas não apresentam essa chamada de função. Dessa forma, usaremos, principalmente, a função <code>sloop::ftype()</code> como pesquisa por funções genéricas. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcoes do tipo "closure" que nao pertencem ao sistema S3</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;function&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao generica S3 em funcoes do tipo "closure"</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>mean 
TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;S3&quot;      &quot;generic&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># funcoes primitivas e internas que nao pertencem ao sistema S3</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>inherits</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>inherits</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;internal&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#-----</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>unclass</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>unclass</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;primitive&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># funcoes genericas do sistema S3 que sao primitivas e internas</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>length</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>length</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;primitive&quot; &quot;generic&quot;  </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#--</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/isS3stdGen.html'>isS3stdGeneric</a></span><span class='op'>(</span><span class='va'>unlist</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>unlist</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;internal&quot; &quot;generic&quot; </code></pre>
</div>
<p>A função <code>sloop::ftype()</code> retorna um vetor de caracteres de comprimento 1 ou 2. Quando retorna apenas um valor, do qual não obtemos o resultado <code>generic</code>, significa que esta função não é genérica, como é o caso da função <code>data</code>. Quando há um retorno de dois valores, e um deles é <code>generic</code>, significa dizer que a função é genérica, em que o primeiro valor, representa o sistema POO, como é o caso da função <code>mean</code>. No caso, das funções primitivas/internas que estão no pacote <code>base</code>, o primeiro resultado da função <code>sloop::ftype()</code> para a referida função será <code>primitive</code> ou <code>internal</code>, e se houver o segundo valor de nome <code>generic</code>, se confirma que também é um função primitiva genérica do método <strong>S3</strong>.</p>
<p>As funções genéricas do tipo <code>closure</code> terão no corpo de sua função a chamada <code>UseMethod</code>, uma função primitiva . Essa é a identificação básica de uma função genérica. Podemos observar, como exemplo, a função <code>mean</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mean</span>
</code></pre>
</div>
<pre><code>function (x, ...) 
UseMethod(&quot;mean&quot;)
&lt;bytecode: 0x0000000008634560&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<p>Entretanto, funções primitivas e internas são escritas em linguagem <code>C</code>, mas também podem ser funções genéricas. Não há função no <a href="http://r-project.org/" target="_blank">R</a> para acesso direto do código interno interno dessas funções, bem como de seus argumentos. O que na realidade deve ser feito é acessar código fonte. Para isso, podemos pesquisar sobre alguma função primitiva, por exemplo <code>'[['</code>, por <code>pryr::show_c_source(.Primitive("[["))</code>.</p>
<p>O que ocorre nesse caso, é que estas funções não usam a chamada <code>UseMethod</code>. Desse modo, as funções primitivas e internas podem ser identificadas, pelo objeto <code>.S3PrimitiveGenerics</code>, um vetor de caracteres, que seguem:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>.S3PrimitiveGenerics</span>
</code></pre>
</div>
<pre><code> [1] &quot;anyNA&quot;          &quot;as.character&quot;   &quot;as.complex&quot;    
 [4] &quot;as.double&quot;      &quot;as.environment&quot; &quot;as.integer&quot;    
 [7] &quot;as.logical&quot;     &quot;as.call&quot;        &quot;as.numeric&quot;    
[10] &quot;as.raw&quot;         &quot;c&quot;              &quot;dim&quot;           
[13] &quot;dim&lt;-&quot;          &quot;dimnames&quot;       &quot;dimnames&lt;-&quot;    
[16] &quot;is.array&quot;       &quot;is.finite&quot;      &quot;is.infinite&quot;   
[19] &quot;is.matrix&quot;      &quot;is.na&quot;          &quot;is.nan&quot;        
[22] &quot;is.numeric&quot;     &quot;length&quot;         &quot;length&lt;-&quot;      
[25] &quot;levels&lt;-&quot;       &quot;names&quot;          &quot;names&lt;-&quot;       
[28] &quot;rep&quot;            &quot;seq.int&quot;        &quot;xtfrm&quot;         </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Outras funcoes primitivas</span>
<span class='op'>(</span><span class='va'>outros_obj_S3_primitivos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"["</span>, <span class='st'>"[["</span>, <span class='st'>"$"</span>, <span class='st'>"[&lt;-"</span>, <span class='st'>"[[&lt;-"</span>, <span class='st'>"$&lt;-"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;[&quot;    &quot;[[&quot;   &quot;$&quot;    &quot;[&lt;-&quot;  &quot;[[&lt;-&quot; &quot;$&lt;-&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Outras funcoes internas nao primitivas</span>
<span class='op'>(</span><span class='va'>outros_obj_S3_primitivos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"unlist"</span>, <span class='st'>"cbind"</span>, <span class='st'>"rbind"</span>, <span class='st'>"as.vector"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;unlist&quot;    &quot;cbind&quot;     &quot;rbind&quot;     &quot;as.vector&quot;</code></pre>
</div>
<p>Algumas outras funções como <code>is.name</code> que é sinônimo da função <code>is.symbol</code>, assim como a função <code>as.numeric</code> é sinônimo da função <code>as.double</code>. Existem outras funções genéricas que também são primitivas/internas, são as funções genéricas do grupo <strong>S3</strong> que não estão descritos no objeto <code>.S3PrimitiveGenerics</code>. Há quatro desses grupos para que os métodos <strong>S3</strong> podem ser escritos, denominados: grupo <code>Math</code>, grupo <code>Ops</code>, grupo <code>Summary</code> e grupo <code>Complex</code>. Detalhamos as funções:</p>
<ul>
<li>Grupo <code>Math</code>:
<ul>
<li><code>abs</code>, <code>sign</code>, <code>sqrt</code>, <code>floor</code>, <code>ceiling</code>, <code>trunc</code>, <code>round</code>, <code>signif</code></li>
<li><code>exp</code>, <code>log</code>, <code>expm1</code>, <code>log1p</code>, <code>cos</code>, <code>sin</code>, <code>tan</code>, <code>cospi</code>, <code>sinpi</code>, <code>tanpi</code>, <code>acos</code>, <code>asin</code>, <code>atan</code>, <code>cosh</code>, <code>sinh</code>, <code>tanh</code>, <code>acosh</code>, <code>asinh</code>, <code>atanh</code></li>
<li><code>lgamma</code>, <code>gamma</code>, <code>digamma</code>, <code>trigamma</code></li>
<li><code>cumsum</code>, <code>cumprod</code>, <code>cummax</code>, <code>cummin</code></li>
</ul></li>
<li>Grupo <code>Ops</code>:
<ul>
<li><code>"+"</code>, <code>"-"</code>, <code>"*"</code>, <code>"/"</code>, <code>"^"</code>, <code>"%%"</code>, <code>"%/%"</code></li>
<li><code>"&amp;"</code>, <code>"|"</code>, <code>"!"</code></li>
<li><code>"=="</code>, <code>"!="</code>, <code>"&lt;"</code>, <code>"&lt;="</code>, <code>"&gt;="</code>, <code>"&gt;"</code></li>
</ul></li>
<li>Grupo <code>Summary</code>:
<ul>
<li><code>all</code>, <code>any</code>, <code>sum</code>, <code>prod</code>, <code>min</code>, <code>max</code>, <code>range</code></li>
</ul></li>
<li>Grupo <code>Complex</code>:
<ul>
<li>Arg, <code>Conj</code>, <code>Im</code>, <code>Mod</code>, <code>Re</code></li>
</ul></li>
</ul>
<p>Apesar não termos funções com nomes <code>Math</code>, <code>Ops</code>, <code>Summary</code> e <code>Complex</code> no pacote <code>base</code>, e portanto, também não serem objetos <code>R</code>, podemos fornecer métodos para estes, como por exemplo, no pacote <code>base</code>, temos métodos como:</p>
<ul>
<li>Métodos de <code>Math</code>:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/methods.html'>methods</a></span><span class='op'>(</span><span class='st'>"Math"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] Math,CsparseMatrix-method  Math,ddenseMatrix-method  
 [3] Math,denseMatrix-method    Math,dgeMatrix-method     
 [5] Math,diagonalMatrix-method Math,nonStructure-method  
 [7] Math,sparseMatrix-method   Math,sparseVector-method  
 [9] Math,structure-method      Math.data.frame           
[11] Math.Date                  Math.difftime             
[13] Math.factor                Math.POSIXt               
[15] Math.quosure*              Math.vctrs_sclr*          
[17] Math.vctrs_vctr*          
see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<ul>
<li>Métodos de <code>Summary</code>:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/methods.html'>methods</a></span><span class='op'>(</span><span class='st'>"Summary"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] Summary,abIndex-method       Summary,ddenseMatrix-method 
 [3] Summary,ddiMatrix-method     Summary,dsparseMatrix-method
 [5] Summary,indMatrix-method     Summary,ldenseMatrix-method 
 [7] Summary,ldiMatrix-method     Summary,lMatrix-method      
 [9] Summary,Matrix-method        Summary,ndenseMatrix-method 
[11] Summary,nMatrix-method       Summary,nsparseVector-method
[13] Summary,sparseVector-method  Summary.data.frame          
[15] Summary.Date                 Summary.difftime            
[17] Summary.factor               Summary.numeric_version     
[19] Summary.ordered              Summary.POSIXct             
[21] Summary.POSIXlt              Summary.quosure*            
[23] Summary.roman*               Summary.unit*               
[25] Summary.vctrs_sclr*          Summary.vctrs_vctr*         
see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<ul>
<li>Métodos de <code>Complex</code>:</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/methods.html'>methods</a></span><span class='op'>(</span><span class='st'>"Complex"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] Complex.vctrs_sclr*
see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<p>Os métodos que estão com asterisco é porque não são exportados do namespace dos pacotes em que essas funções foram criadas. Para isso, use <code>:::</code>, <code>getS3method</code> ou <code>getAnywhere</code>. Por exemplo, se tentarmos procurar pelo método <code>str.data.frame</code> no console, não iremos encontrar porque ela não foi exportada pelo <em>namespace</em> do pacote <code>utils</code>. Para acessar o referido método, segue:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Primeira forma:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/getAnywhere.html'>getAnywhere</a></span><span class='op'>(</span><span class='st'>"str.data.frame"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>A single object matching &#39;str.data.frame&#39; was found
It was found in the following places
  registered S3 method for str from namespace utils
  namespace:utils
with value

function (object, ...) 
{
    if (!is.data.frame(object)) {
        warning(&quot;str.data.frame() called with non-data.frame -- coercing to one.&quot;)
        object &lt;- data.frame(object)
    }
    cl &lt;- oldClass(object)
    cl &lt;- cl[cl != &quot;data.frame&quot;]
    if (0 &lt; length(cl)) 
        cat(&quot;Classes&quot;, paste(sQuote(cl), collapse = &quot;, &quot;), &quot;and &quot;)
    cat(&quot;&#39;data.frame&#39;:\t&quot;, nrow(object), &quot; obs. of  &quot;, (p &lt;- length(object)), 
        &quot; variable&quot;, if (p != 1) 
            &quot;s&quot;, if (p &gt; 0) 
            &quot;:&quot;, &quot;\n&quot;, sep = &quot;&quot;)
    if (length(l &lt;- list(...)) &amp;&amp; any(&quot;give.length&quot; == names(l))) 
        invisible(NextMethod(&quot;str&quot;, ...))
    else invisible(NextMethod(&quot;str&quot;, give.length = structure(FALSE, 
        from = &quot;data.frame&quot;), ...))
}
&lt;bytecode: 0x00000000272095f8&gt;
&lt;environment: namespace:utils&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Segunda forma (Sistema S3 apenas):</span>
<span class='fu'><a href='https://rdrr.io/r/utils/getS3method.html'>getS3method</a></span><span class='op'>(</span><span class='st'>"str"</span>, <span class='st'>"data.frame"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>function (object, ...) 
{
    if (!is.data.frame(object)) {
        warning(&quot;str.data.frame() called with non-data.frame -- coercing to one.&quot;)
        object &lt;- data.frame(object)
    }
    cl &lt;- oldClass(object)
    cl &lt;- cl[cl != &quot;data.frame&quot;]
    if (0 &lt; length(cl)) 
        cat(&quot;Classes&quot;, paste(sQuote(cl), collapse = &quot;, &quot;), &quot;and &quot;)
    cat(&quot;&#39;data.frame&#39;:\t&quot;, nrow(object), &quot; obs. of  &quot;, (p &lt;- length(object)), 
        &quot; variable&quot;, if (p != 1) 
            &quot;s&quot;, if (p &gt; 0) 
            &quot;:&quot;, &quot;\n&quot;, sep = &quot;&quot;)
    if (length(l &lt;- list(...)) &amp;&amp; any(&quot;give.length&quot; == names(l))) 
        invisible(NextMethod(&quot;str&quot;, ...))
    else invisible(NextMethod(&quot;str&quot;, give.length = structure(FALSE, 
        from = &quot;data.frame&quot;), ...))
}
&lt;bytecode: 0x00000000272095f8&gt;
&lt;environment: namespace:utils&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Terceira forma</span>
<span class='fu'>utils</span><span class='fu'>:::</span><span class='va'><a href='https://rdrr.io/r/utils/str.html'>str.data.frame</a></span>
</code></pre>
</div>
<pre><code>function (object, ...) 
{
    if (!is.data.frame(object)) {
        warning(&quot;str.data.frame() called with non-data.frame -- coercing to one.&quot;)
        object &lt;- data.frame(object)
    }
    cl &lt;- oldClass(object)
    cl &lt;- cl[cl != &quot;data.frame&quot;]
    if (0 &lt; length(cl)) 
        cat(&quot;Classes&quot;, paste(sQuote(cl), collapse = &quot;, &quot;), &quot;and &quot;)
    cat(&quot;&#39;data.frame&#39;:\t&quot;, nrow(object), &quot; obs. of  &quot;, (p &lt;- length(object)), 
        &quot; variable&quot;, if (p != 1) 
            &quot;s&quot;, if (p &gt; 0) 
            &quot;:&quot;, &quot;\n&quot;, sep = &quot;&quot;)
    if (length(l &lt;- list(...)) &amp;&amp; any(&quot;give.length&quot; == names(l))) 
        invisible(NextMethod(&quot;str&quot;, ...))
    else invisible(NextMethod(&quot;str&quot;, give.length = structure(FALSE, 
        from = &quot;data.frame&quot;), ...))
}
&lt;bytecode: 0x00000000272095f8&gt;
&lt;environment: namespace:utils&gt;</code></pre>
</div>
<p>Os métodos desenvolvidos no pacote <code>base</code> com asterisco dos métodos genéricos de grupo não são acessados pelas funções anteriores. Por fim, vamos criar uma pequena rotina, adaptado de <span class="citation" data-cites="chambers2016"><a href="#ref-chambers2016" role="doc-biblioref">Chambers</a> (<a href="#ref-chambers2016" role="doc-biblioref">2016</a>)</span>, para vermos quais e quantas funções genéricas primitivas existem no pacote <code>base</code>, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Todos os objetos do pacote 'base'</span>
<span class='va'>todosobj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>objects</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/environment.html'>baseenv</a></span><span class='op'>(</span><span class='op'>)</span>, all.names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>; 
<span class='co'># Mostre apenas os primeiros (ver todos remova 'head')</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>todosobj</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;-&quot;         &quot;-.Date&quot;    &quot;-.POSIXt&quot;  &quot;!&quot;         &quot;!.hexmode&quot;
[6] &quot;!.octmode&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quantos objetos no pacote 'base'?</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>todosobj</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1373</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quais sao funcoes primitivas?</span>
<span class='va'>objprimitivos</span> <span class='op'>&lt;-</span> <span class='va'>todosobj</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>todosobj</span>,  <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/is.function.html'>is.primitive</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/get.html'>get</a></span><span class='op'>(</span><span class='va'>x</span>, envir <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>baseenv</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
<span class='co'># Mostre os primeiros (ver todos remova 'head')</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>objprimitivos</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;-&quot;   &quot;!&quot;   &quot;!=&quot;  &quot;$&quot;   &quot;$&lt;-&quot; &quot;%%&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quantos primitivos ('buitin' ou 'special')?</span>
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>objprimitivos</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 204</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quais sao primitivos genéricos (Sistema S3)?</span>
<span class='va'>ehPrimitivaGenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>primitiva</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>fprimitiva</span> <span class='op'>&lt;-</span> <span class='fu'>getFunction</span><span class='op'>(</span><span class='va'>primitiva</span>, mustFind <span class='op'>=</span> <span class='cn'>FALSE</span>, where <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ns-internal.html'>asNamespace</a></span><span class='op'>(</span><span class='st'>"base"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>ehgenerica</span> <span class='op'>&lt;-</span> <span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/ftype.html'>ftype</a></span><span class='op'>(</span><span class='va'>fprimitiva</span><span class='op'>)</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>ehgenerica</span> <span class='op'>==</span> <span class='st'>"generic"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='cn'>TRUE</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='cn'>FALSE</span>
<span class='op'>}</span>
<span class='co'># Mostre os primeiros (ver todos remova 'head')</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>objprimitivos</span>, <span class='va'>ehPrimitivaGenerica</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>    -     !    !=     $   $&lt;-    %% 
 TRUE FALSE  TRUE  TRUE  TRUE  TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quantas sao primitivas genericas?</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>objprimitivos</span>, <span class='va'>ehPrimitivaGenerica</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 100</code></pre>
</div>
<h3 id="UseMethod">Entendendo melhor a chamada <code>UseMethod</code></h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/R0Ty5xjYDG4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Na seção anterior, falamos que as funções genéricas do tipo <code>closure</code>, usam no corpo da função a chamada <code>UseMethod</code>. Esta é uma função primitiva, desenvolvida em <code>C</code>, porém usa a correspondência padrão de argumentos, com sintaxe dada por:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='va'>generic</span>, <span class='va'>object</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>em que o argumento <code>generic</code> representa o nome da função genérica (obrigatório para utilizar na chamada de <code>UseMethod</code>), e o segundo argumento <code>object</code> é o objeto cuja classe determina o método a ser enviado para execução pela função genérica. O argumento <code>objeto</code> representa o primeiro argumento da função genérica, e portanto, na prática usamos apenas o argumento <code>generic</code>, uma vez que a função <code>UseMethod</code> se encarrega do resto.</p>
<p>Uma outra coisa importante é que a chamada da função <code>UseMethod</code> deve ser usada apenas no corpo de uma função, isto é, <code>function(x) UseMethod("fgenerica")</code>. Caso contrário, ocorre o retorno de erro, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fgenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Error in eval(expr, envir, enclos): &#39;função&#39; genérica não é uma função</code></pre>
</div>
<p>Desse modo, a forma correta de declarar a chamada de função <code>Usemethod</code>, baseado no exemplo anterior, deve ser apresentado como segue,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Primeira sintaxe</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='co'># Segunda sintaxe</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Terceira sintaxe</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> \<span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='co'># Quarta sintaxe</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> \<span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='op'>}</span> 
</code></pre>
</div>
</div>
<p>Portanto, o objeto associado ao nome <code>fgenerica</code> é o que chamamos de função genérica. Nesse caso, o código interno de <code>UseMethod</code> examina o atributo <code>class</code> no objeto do primeiro argumento da função genérica, que no caso da função genérica <code>fgenerica</code> anterior, é o argumento <code>x</code>.</p>
<p>A chamada <code>UseMethod</code> insere objetos especiais no ambiente de avaliação da função genérica, que são <code>.Class</code>, <code>.Generic</code> e <code>.Method</code>. Eles são responsáveis pelo despacho de método e os mecanismos de herança. O objeto <code>.Class</code> representa a classe do objeto (primeiro argumento da função genérica), <code>.Generic</code> é o nome da função genérica, e <code>.Method</code> é o nome do método usado. Poderá surgir também um outro objeto chamado <code>.Group</code>, quando funções genéricas são primitivas que se enquandram dentro das funções genéricas de grupo, visto mais a frente. De todo modo, isso é serviço para o <a href="http://r-project.org/" target="_blank">R</a> internamente e o usuário não precisará se preocupar. Vejamos o código a seguir, para observamos como podemos obter informações desses objetos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>generico</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"generico"</span><span class='op'>)</span>

<span class='va'>generico.metodo</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Imprima o valor dos objetos .Generic, .Class e .Method, respectivamente:\n"</span>, <span class='va'>.Generic</span>, <span class='st'>"\n"</span>, <span class='va'>.Class</span>, <span class='st'>"\n"</span>, <span class='va'>.Method</span><span class='op'>)</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>; <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"metodo"</span>
<span class='fu'>generico</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Imprima o valor dos objetos .Generic, .Class e .Method, respectivamente:
 generico 
 metodo 
 generico.metodo</code></pre>
</div>
<p>Uma coisa interessante, é que a função <code>UseMethod</code> por ser primitiva, não cria seu próprio ambiente, mas a sua chamada ocorre no ambiente de chamada, isto é, no ambiente de execução da função genérica. Além do mais, como o ambiente de chamada da função <code>UseMethod</code> é o ambiente de execução da função genérica, um código interno em <code>UseMethod</code> faz com que o ambiente de chamada seja finalizado após o método ter sido avaliado. Em outras palavras, o que for escrito no corpo da função genérica após a chamada <code>UseMethod</code>, não será executado nem avaliado. Vejamos um exemplo, para clarear o que estamos falando, que segue,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao generica</span>
<span class='va'>quem</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Isso pode ser impresso!"</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"quem"</span><span class='op'>)</span>
  <span class='co'>## Apos a Chamada UseMethod o ambiente eh encerrado!</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Isso nao sera impresso!"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'>## Metodo</span>
<span class='va'>quem.eh</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Sou eu! (arg x)"</span><span class='op'>)</span>
<span class='co'># Aplicacao:</span>
<span class='va'>pessoa</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span> <span class='co'># objeto sem atributo 'class'</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"eh"</span>
<span class='fu'>quem</span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Isso pode ser impresso!&quot;
[1] &quot;Sou eu! (arg x)&quot;</code></pre>
</div>
<p>Observemos nesse caso, que a linha de comando no corpo da função genérica <code>quem</code>, antes da chamada <code>UseMethod</code> é avaliada e executada, porém, o que ocorre após não é executado, uma vez, que não é impresso no console o resultado <code>"Isso nao sera impresso!"</code>. Logo, após a chamada de <code>UseMethod</code> e o envio de método para <code>quem.eh</code> e a ocorrência de sua execução, o ambiente de execução de <code>quem</code> é finalizado, do qual, <code>print("Isso nao sera impresso!")</code> não é executado.</p>
<h3 id="criando_fgenericas">Criando funções genéricas</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FSZhTSo7U-U" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Como já mostrado em alguns exemplos na seção anterior, a forma de criar uma função genérica é por meio da inserção no corpo da criação de uma função, a chamada <code>UseMethod</code>. A ideia da função genérica, é encontrar o método específico para uma determinada instância de classe (objeto). Desse modo, criamos uma função genérica da seguinte forma:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao generica</span>
<span class='va'>quem</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"quem"</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Assim, <code>quem</code> é uma função genérica. Esta função tem o objetivo, por meio de <code>UseMethod</code>, identificar a classe do objeto definido em <code>x</code>, e depois o envio de método, isto é, encontrar o método (objeto função) específico para a classe do objeto em <code>x</code>.</p>
<h3 id="classeS3">Classe e classe implícita</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/du32MYwxbsg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Usuário de outras linguagens que estudaram POO , por exemplo em <em>Java</em>, <em>C++</em>, <em>Python</em>, devem estar muito confusos, até esse momento, como o sistema <strong>S3</strong> não tem uma forma usual de definir uma classe. Para isso, basta usar o atributo <code>class</code> em um objeto. Desse modo, este se torna uma instância da classe.</p>
<p>Já vimos no módulo básico como verificar os atributos em um objeto, por meio da função <code>attributes()</code>. Vamos expandir um pouco mais, antes de passarmos para o atributo <code>class</code>. Vejamos a seguir, como inserir um ou mais de um atributo aos objetos, bem como eliminá-los.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto</span>
<span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Inserindo atributos em um objeto (1ª Forma)</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='st'>"dim"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span> <span class='co'># 1º Atributo 'dim'</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='st'>"class"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span> <span class='co'># 2º Atributo 'ben'</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='st'>"nada"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"1"</span>  <span class='co'># 3º Atributo 'nada'</span>

<span class='co'># Visualizar os atributos em x</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$dim
[1] 2 5

$class
[1] &quot;ben&quot;

$nada
[1] &quot;1&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eliminando um determinado atributo ('nada')</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='st'>"nada"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span> <span class='co'># Remove atribuindo 'NULL'</span>

<span class='co'># Visualizar os atributos em x, sem o atributo 'nada'</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$dim
[1] 2 5

$class
[1] &quot;ben&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eliminar todos os atributos</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>

<span class='co'># Visualizando x sem atributos</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>NULL</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Inserindo os atributos todos de uma vez</span>
<span class='fu'>mostattributes</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"ben"</span>, nada <span class='op'>=</span> <span class='st'>"1"</span><span class='op'>)</span>

<span class='co'># Verificando se um objeto apresenta determinado atributo, por exemplo, class='nada'</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"nada"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Outra forma de inserir mais de um atributo</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, dim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>5</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"ben"</span>, nada <span class='op'>=</span> <span class='st'>"1"</span><span class='op'>)</span>

<span class='co'># Casos especificos, podem ter funcoes proprias</span>
<span class='co'># para inserir atributos, por exemplo, 'class'</span>
<span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='st'>"class"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>; <span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='co'># removendo o atributo 'class'</span>
</code></pre>
</div>
<pre><code>$dim
[1] 2 5

$nada
[1] &quot;1&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>; <span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$dim
[1] 2 5

$nada
[1] &quot;1&quot;

$class
[1] &quot;ben&quot;</code></pre>
</div>
<p>Percebemos que alguns atributos têm funções próprias, além do atributo <code>class</code>, temos <code>dim</code>, <code>levels</code>, <code>names</code>, <code>dimnames</code>, dentre outros.</p>
<p>Para esse caso, iremos nos concentrar apenas no atributo <code>class</code>. Seguindo as próprias recomendações de <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, e com razão, podemos utilizar qualquer conjunto de caracteres para nominar a classe de interesse. Porém, evitemos utilizar o ponto (“.”) como parte dos caracteres para nominar a classe, porque na próxima seção, veremos que o ponto é parte sintática da criação de um método, em que nominamos o método pela junção do nome da função genérica mais o nome da classe, separados por um ponto. E para evitar confusão, seguiremos essa sugestão.</p>
<p>Desse modo, poderemos retirar um objeto como instância de uma classe, removendo o atributo <code>class</code>. Essa flexibilidade na prática, não apresenta grandes problemas, um vez que como afirmado por <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, o R não impede do programador atirar no próprio pé, desde que ele não aponte a arma para o pé e puxe o gatilho. Mais a frente, apresentaremos algumas sugestões propostas por <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, do qual adotaremos.</p>
<p>Uma outra característica do atributo <code>class</code> é que este pode ser um vetor de caracteres. Por exemplo, um vetor atômico do tipo fator é largamente utilizado na estatística, quando queremos representar os níveis de um tratamento, em que para usar a função <code>aov()</code>, função para a realização da análise de variância, um dos argumentos da função faz-se necessário ser um fator. Em algumas situações, além de ser um fator, é importante que os níveis sejam ordenados, na estatística descritiva, chamamos também de variáveis qualitativas ordinais.</p>
<p>Para criarmos um vetor do tipo fator, usamos a função <code>factor</code>, e a sua ordenação, ou usamos em <code>factor</code>, o argumento <code>ordered=TRUE</code>, ou criamos um fator ordenado pela função <code>ordered()</code>. Usando este último, e associando a um nome, vamos perceber que o atributo <code>class</code> desse objeto é um vetor de comprimento 2, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto e sua classe</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>ordered</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;ordered&quot; &quot;factor&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Observando os atributos do objeto</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$levels
[1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot;

$class
[1] &quot;ordered&quot; &quot;factor&quot; </code></pre>
</div>
<p>Essa sequência será responsável pelo <strong>mecanismo de herança</strong> de métodos, que discutiremos mais a frente. No entanto, quando o objeto em <a href="http://r-project.org/" target="_blank">R</a> não é objeto POO, a função <code>class</code> pode retornar resultados equivocados quanto ao despacho do método. Por exemplo, vamos criar um vetor multidimensional, do tipo <code>array</code>, e verificarmos o que a função <code>class</code> retorna,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto e sua classe</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;matrix&quot; &quot;array&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Observando os atributos do objeto</span>
<span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$dim
[1] 2 4</code></pre>
</div>
<p>Porém, usando a função <code>sloop::s3_class()</code> ou <code>.class2</code>, perceberemos uma maior detalhamento, observemos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_class.html'>s3_class</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;matrix&quot;  &quot;integer&quot; &quot;numeric&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>.class2</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;matrix&quot;  &quot;array&quot;   &quot;integer&quot; &quot;numeric&quot;</code></pre>
</div>
<p>Isso é o que chamamos de <strong>classes implícitas</strong> aos objetos base, que não tem o atributo <code>class</code> definido. Segundo <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, a <strong>classe implícita</strong>, obtida de objetos base, apresenta um vetor de três conjuntos de caracteres (<em>strings</em>):</p>
<ul>
<li><code>array</code> ou <code>matrix</code>, se o objeto tiver dimensão;</li>
<li>resultado de <code>typeof</code>, com algumas variações;</li>
<li><code>numeric</code>, se os valores forem <code>integer</code> (inteiro) ou <code>double</code> (real).</li>
</ul>
<p>Para mostrarmos que a função <code>class</code> não retorna corretamente o <strong>despacho de método</strong> utilizado, isto é, para qual método a chamada da função genérica (<code>UseMethod</code>) foi executado, vamos utilizar a função <code>sloop::s3_dispatch()</code>. O despacho ocorrerá no método que contém (<code>=&gt;</code>). Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Imprimindo o despacho do objeto associado a 'y'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   print.matrix
   print.integer
   print.numeric
=&gt; print.default</code></pre>
</div>
<p>Observe que o despacho ocorreu em <code>print.default</code>. O que fica mais claro, nesse segundo exemplo, o que queremos afirmar,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto com classe implícita (sem atributo 'class')</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># Imprimindo class</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;numeric&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verificando o despacho em 'print'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   print.double
   print.numeric
=&gt; print.default</code></pre>
</div>
<p>Observemos nesse caso que <code>class</code> retorna <code>numeric</code>, e o despacho ocorre em <code>print.default</code>, e não em <code>print.numeric</code> como verificado por <code>class</code>, ficando mais evidente o que falamos anteriormente. Na seção <a href="#envio-herança">envio de método e mecanismos de herança</a>, detalharemos um pouco mais sobre o assunto.</p>
<p>Por fim, um último ponto que queríamos abordar são os termos técnicos como <strong>subclasse</strong> e <strong>superclasse</strong>. Anteriormente, vimos o objeto <code>x &lt;- ordered(1:5)</code> que era um fator ordenado, e que o seu atributo <code>class</code> era um vetor de comprimento 2, isto é, <code>"ordered" "factor"</code>. Dizemos que <code>"ordered"</code> é uma subclasse de <code>"factor"</code> porque o antecede no vetor, assim como <code>"factor"</code> é considerada uma superclasse para <code>"ordered"</code> porque o precede. A rigor, o sistema <strong>S3</strong> não faz imposição nenhuma a estas classes, mas veremos na seção <a href="#envio-herança">envio de método e mecanismos de herança</a>, algumas estratégias para isso.</p>
<h3 id="metodoS3">Método S3</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/LLhaVWuYIoE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>O método no sistema S3 tem a seguinte estrutura no nome da função <code>'nome_funcao_generica'.'nome_classe'</code>. Vamos supor que criamos uma classe para o objeto <code>pessoa</code>, com atributo <code>class</code> sendo <code>eh</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto</span>
<span class='va'>pessoa</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>
<span class='co'># Atribuindo classe ao objeto 'pessoa'</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"eh"</span>
</code></pre>
</div>
</div>
<p>Como falado no <a href="nbasico.html">módulo básico</a>, os atributos não modificam os valores dos objetos. Então até aqui, nada de novo. Para criarmos o método, baseado na função genérica <code>quem</code>, criada anteriormente, e na classe <code>eh</code>, criamos um método (objeto de modo <code>function</code> no <code>R</code>, ou tipo <code>closure</code>) <code>quem.eh</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Metodo</span>
<span class='va'>quem.eh</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Sou eu!"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Algo muito importante no método é que a função deve ter os mesmos argumentos da função genérica, a menos que seja utilizado o objeto <code>...</code> na função genérica. De um modo geral, apresentamos alguns aspectos e sugestões para a criação de um método, que destacamos:</p>
<ul>
<li>Um método deve ser criado considerando a existência de uma função genérica ou uma classe;</li>
<li>O método deve apresentar os mesmos argumentos que a função genérica, e estes não se alteram no código interno da função genérica. Caso a função genérica apresente o objeto <code>'...'</code>, o número de argumentos entre a função genérica e o método podem ser diferentes;</li>
<li>Reforçando, evitem nos nomes das funções genéricas ou classes o uso de pontos, porque o ponto é uma forma sintática de criarmos o nome do método, isso evitará problemas para o despacho correto. Um exemplo é a função <code>t.test</code>, que poderíamos imaginar que fosse um método, em que <code>t</code> é a função genérica e <code>test</code> a classe. Na realidade, <code>t.test</code> é uma função genérica, pois usa a chamada <code>UseMethod</code>. A criação desse objeto o <a href="http://r-project.org/" target="_blank">R</a> deve ter ocorrido, muito provavelmente, antes da implementação do sistema S3 a base do <a href="http://r-project.org/" target="_blank">R</a>;</li>
<li>A chamada de função deve ser realizada, preferencialmente pela função genérica, porém nada impede de ser realizada pelo próprio método. Nesse caso, ocorrem alguns aspectos internos ao código, que chamaremos atenção mais a frente;</li>
<li>Na criação de funções genéricas em pacotes, deem preferências ao nome das classes exatamente igual ao nome do pacote em desenvolvimento. Isso evitará possíveis conflitos de nomes de classes;</li>
</ul>
<p>Finalizado a criação do método, o que ocorrerá agora é que não precisaremos chamar o método pelo próprio método, mas pela função genérica, é o que chamamos de <strong>envio de método</strong> (ou <strong>despacho de método</strong>). Essa é a caixa preta da POO, devemos acreditar que isso ocorrerá, claro, se todo o processo de criação estiver correto.</p>
<p>Um outro método que se sugere criar é o padrão (<code>default</code>), para que se a função genérica não encontrar o método específico, ela procurará pelo método padrão. Se não existir o método padrão, caso não encontre o método específico, a função genérica pode retornar uma mensagem de erro. Vejamos a implementação, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto</span>
<span class='va'>pessoa</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>
<span class='co'># Atribuindo classe ao objeto 'pessoa'</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"eh"</span>
<span class='co'>## Metodo 'eh'</span>
<span class='va'>quem.eh</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Sou eu!"</span><span class='op'>)</span>
<span class='co'>## Metodo 'padrao'</span>
<span class='va'>quem.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"??"</span><span class='op'>)</span>
<span class='co'>#-----------------------------------------</span>
<span class='co'># Aplicacao:</span>
<span class='va'>pessoa</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span> <span class='co'># objeto sem atributo 'class'</span>
<span class='co'># Usando a funcao generica</span>
<span class='fu'>quem</span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='co'># Aplicando o metodo padrao</span>
</code></pre>
</div>
<pre><code>[1] &quot;??&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#--------</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"eh"</span>
<span class='fu'>quem</span><span class='op'>(</span><span class='va'>pessoa</span><span class='op'>)</span> <span class='co'># Aplicando o metodo eh</span>
</code></pre>
</div>
<pre><code>[1] &quot;Sou eu!&quot;</code></pre>
</div>
<p>Retornando sobre a função <code>UseMethod</code>, quando inserimos os dois argumentos <code>generic</code> e <code>object</code> no corpo da função genérica, e definimos em <code>object</code> qual o objeto que a função observará o atributo <code>class</code>, a chamada de função <code>UseMethod</code> desconsiderará o primeiro argumento da função genérica, independente de ter um atributo <code>class</code> ou não. Vejamos um exemplo,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao generica</span>
<span class='va'>quem</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"quem"</span>, <span class='va'>x</span><span class='op'>)</span>
<span class='co'># Metodos</span>
<span class='va'>quem.eh</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Sou eu!"</span><span class='op'>)</span>
<span class='va'>quem.outro</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Outro!"</span><span class='op'>)</span>
<span class='va'>quem.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Qualquer um!"</span><span class='op'>)</span>
<span class='co'># Objeto em UseMethod sem o atributo 'class'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>
<span class='co'># Objeto no primeiro argument de fgenerica</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='st'>"ninguem"</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"outro"</span>
<span class='co'># O despacho ocorre em quem.default</span>
<span class='fu'>quem</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Qualquer um!&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Removendo quem.defaul, a fgenerica retorna erro</span>
<span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span><span class='st'>"quem.default"</span><span class='op'>)</span>; <span class='fu'>quem</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Error in UseMethod(&quot;quem&quot;, x): método não aplicável para &#39;quem&#39; aplicado a um objeto de classe &quot;character&quot;</code></pre>
</div>
<p>Contudo, se o objeto definido em <code>object</code> não tiver o atributo <code>class</code>, e não houver um despacho para o método <code>fgenerica.default</code>, a função genérica (<code>fgenerica</code>) retorna um erro. Vejamos outro exemplo,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>quem</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"quem"</span>, <span class='va'>x</span><span class='op'>)</span>
<span class='va'>quem.eh</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Sou eu!"</span><span class='op'>)</span>
<span class='va'>quem.outro</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Outro!"</span><span class='op'>)</span>
<span class='va'>quem.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Qualquer um!"</span><span class='op'>)</span>

<span class='co'># Objeto em UseMethod</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"eh"</span>
<span class='co'># Objeto no primeiro argument de fgenerica</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='st'>"ninguem"</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"outro"</span>
<span class='co'># Executando a funcao generica</span>
<span class='fu'>quem</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Sou eu!&quot;</code></pre>
</div>
<p>Uma coisa interessante que ocorre com a chamada <code>UseMethod</code>, que foge a exceção do padrão de chamadas das funções. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao (Primeiro caso)</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>h</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> x  y 
10 10 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#----------------------------------------</span>
<span class='co'># Funcao generica e metodo (Segundo caso)</span>
<span class='va'>g</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"g"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># metodo padrao</span>
<span class='va'>g.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>
<span class='co'># Avaliacao</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>g</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>x y 
1 1 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#----------------------------------------</span>
<span class='co'># Funcao generica e metodo (Terceiro caso)</span>
<span class='va'>g</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"g"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># metodo padrao</span>
<span class='va'>g.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>
<span class='co'># Avaliacao</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>g</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> x  y 
 1 10 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#-----------------------------------------</span>
<span class='co'># Funcao generica e metodo (Quarto caso)</span>
<span class='va'>g.default</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>
<span class='co'># Avaliacao</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>g.default</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>x y 
1 1 </code></pre>
</div>
<p>Observemos no primeiro caso, em que definimos duas variáveis globais <code>x &lt;- 1</code> e <code>y &lt;- 1</code>, ao serem utilizadas como argumentos da função <code>h()</code>, percebemos que após a chamada de <code>h()</code>, o ambiente de execução é criado temporariamente, e lá existe três instâncias <code>x &lt;- 10</code>, <code>y &lt;- 10</code> e a chamada <code>c(x = x, y = y)</code>, em que esta última busca por <code>x</code> e <code>y</code>, que é encontrado nas duas instâncias anteriores, e que portanto, sobrepõe a entrada dos argumentos. Logo, o resultado de <code>h(x, y)</code> será um vetor de comprimento 2, com valores 10 e 10, respectivamente.</p>
<p>No segundo caso, temos uma função genérica, e aqui surge algo meio inconsistente, aparentemente com a chamada <code>UseMethod</code> no corpo da função genérica. Mais vez, esta função nos surpreende, porque ela não permite a alteração dos argumentos definidos na função genérica com variáveis definidas no código interno dessa função, para posteriormente, seguir no despacho do método. Observemos na função genérica<code>g()</code>, que apesar de associado valores para os nomes <code>x</code> e <code>y</code>, todos iguais a <code>10</code>, ao chamarmos <code>g()</code>, definimos para os seus argumentos <code>x</code> e <code>y</code> valores iguais a <code>1</code>, e o que ocorre após a chamada dessa função é um vetor de <code>1s</code> (uns). Isto siginifica, que as instâncias internas da função genérica, não alteraram os argumentos da função, e o despacho de método segue para <code>g.default()</code>.</p>
<p>No terceiro caso, a função genérica apresenta apenas um argumento, <code>x</code>. Observemos nesse caso, que o código interno do método <code>g.default()</code> procura por um objeto associado a <code>y</code>, que é encontrado primeiro no ambiente de execução da função genérica, cujo resultado é <code>10</code>. Porém, mesmo havendo um nome <code>x</code> associado ao valor <code>10</code>, no ambiente de execução da função genérica, a chamada <code>UseMethod</code> preserva o argumento <code>x = 1</code> definido em <code>g()</code>, que despacha para o método. Ao final, o resultado da função genérica é um vetor com valores <code>1</code> e <code>10</code>, respectivamente.</p>
<p>Por fim, o quarto caso, cuja a chamada de função ocorre diretamente pelo método e não pela função genérica. Nesse caso, o resultado será igual ao que ocorre com a função <code>h()</code>, porque não há o despacho pela chamada <code>UseMethod</code>, e portanto, não se preserva os argumentos da função no código interno da função genérica.</p>
<p>Retornando a criação de métodos, uma forma de criar um método é por meio de <strong>funções primitivas genéricas</strong>. No fim da seção <a href="#funcoes_genericas">Funções genéricas</a>, mostramos um código como encontrar as funções primitivas genéricas. O procedimento será o mesmo, isto é, determinado a função genérica, por exemplo, <code>print</code>, e posteriormente, definir uma classe específica para um objeto. Vamos implementar um método para <code>print</code>, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto classe 'comp'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>; <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"comp"</span>
<span class='co'># Metodo 'comp'</span>
<span class='va'>print.comp</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"O comprimento de "</span>, <span class='va'>x</span>, <span class='st'>" eh "</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Aplicacao</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='co'># Metodo 'comp'</span>
</code></pre>
</div>
<pre><code>O comprimento de  1 2 3 4 5 6 7 8 9 10  eh  10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Metodo 'defaut'</span>
</code></pre>
</div>
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<p>Além de as funções internas/primitivas não terem a chamada <code>UseMethod</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, que podem dificultar a identificação de uma função genérica, alguns de seus métodos não estão exportadas pelo <em>namespace</em> do pacote base. Para verificarmos o código interno (instruções) desses métodos, podemos usar três funções: <code>:::</code>, <code>getS3method</code> ou <code>getAnywhere</code>, já comentados na seção <a href="#fgenericas">Funções genéricas</a>.</p>
<p>Podemos usar a função <code>utils::methods()</code>, <code>sloop::s3_methods_generic()</code> ou <code>sloop::s3_methods_class()</code>. Com essas, funções podemos saber por meio do nome ou da função genérica ou pelo nome da classe, quais os métodos disponíveis. Vejamos pelo código a seguir, por exemplo usando a função genérica <code>print</code>, quais os métodos disponíveis, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Usando o nome da funcao generica</span>
<span class='co'># utils::methods(print) </span>
<span class='co'>##  [1] print.acf*                        </span>
<span class='co'>##  [2] print.AES*                        </span>
<span class='co'>##  [3] print.all_vars*                   </span>
<span class='co'>##  [4] print.anova*                      </span>
<span class='co'>##  [5] print.ansi_string*                </span>
<span class='co'>##  [6] print.ansi_style* </span>
<span class='co'>##  ...</span>
<span class='co'># Usando agora a funcao s3_methods_generic</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_methods_class.html'>s3_methods_generic</a></span><span class='op'>(</span><span class='st'>"print"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 310 x 4
   generic class    visible source             
   &lt;chr&gt;   &lt;chr&gt;    &lt;lgl&gt;   &lt;chr&gt;              
 1 print   acf      FALSE   registered S3method
 2 print   AES      FALSE   registered S3method
 3 print   all_vars FALSE   registered S3method
 4 print   anova    FALSE   registered S3method
 5 print   any_vars FALSE   registered S3method
 6 print   aov      FALSE   registered S3method
 7 print   aovlist  FALSE   registered S3method
 8 print   ar       FALSE   registered S3method
 9 print   Arima    FALSE   registered S3method
10 print   arima0   FALSE   registered S3method
# ... with 300 more rows</code></pre>
</div>
<p>Observamos, pelos pacotes instalados no computador do qual escrevemos esse material, apresenta para a função genérica <code>print</code>, 284 métodos. Porém, observamos que a última função <code>sloop::s3_methods_generic()</code> apresenta um maior detalhamento dos métodos, como por exemplo, a visibilidade de suas instruções no <em>console</em>, e ainda de qual pacote o método foi desenvolvido. Nesse caso, quando na coluna <em>visible</em>, um determinado método retorna <code>FALSE</code>, que é equivalente a um asterisco no resultado, por meio da função <code>methods()</code>, que significa que o método não é exportado do <em>namespace</em> do pacote, em que esse método foi desenvolvido. Contudo, mostramos anteriormente, alternativas de como acessar esses métodos.</p>
<p>De outro modo, poderíamos está interessados em métodos baseados em uma determinada classe. Nesse caso, vejamos um exemplo para a classe <code>factor</code>, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Usando o nome da funcao generica</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/methods.html'>methods</a></span><span class='op'>(</span>class <span class='op'>=</span> <span class='va'>factor</span><span class='op'>)</span> <span class='co'># Imprimindo os primeiros metodos para a classe 'factor'</span>
</code></pre>
</div>
<pre><code> [1] [             [[            [[&lt;-          [&lt;-          
 [5] all.equal     Arith         as.character  as.data.frame
 [9] as.Date       as.list       as.logical    as.POSIXlt   
[13] as.vector     c             cbind2        coerce       
[17] Compare       droplevels    format        initialize   
[21] is.na&lt;-       length&lt;-      levels&lt;-      Logic        
[25] Math          Ops           plot          print        
[29] rbind2        relevel       relist        rep          
[33] show          slotsFromS3   summary       Summary      
[37] xtfrm        
see &#39;?methods&#39; for accessing help and source code</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Usando agora a funcao s3_methods_generic</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_methods_class.html'>s3_methods_class</a></span><span class='op'>(</span><span class='st'>"factor"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 28 x 4
   generic       class  visible source
   &lt;chr&gt;         &lt;chr&gt;  &lt;lgl&gt;   &lt;chr&gt; 
 1 [             factor TRUE    base  
 2 [[            factor TRUE    base  
 3 [[&lt;-          factor TRUE    base  
 4 [&lt;-           factor TRUE    base  
 5 all.equal     factor TRUE    base  
 6 as.character  factor TRUE    base  
 7 as.data.frame factor TRUE    base  
 8 as.Date       factor TRUE    base  
 9 as.list       factor TRUE    base  
10 as.logical    factor TRUE    base  
# ... with 18 more rows</code></pre>
</div>
<p>Para o caso dos <strong>genéricos de grupo</strong>, sabemos que os grupos <code>Math</code>, <code>Ops</code>, <code>Summary</code>, e <code>Complex</code> não são objetos <code>R</code>, porém esses nomes podem ser usados para a criação de métodos S3. Uma outra coisa interessante nessa situação é que os objetos <code>.Generic</code>, <code>.Class</code> e <code>.Methods</code>, sofrem uma pequena variação da forma convencional dos nomes da função genérica, da classe e do método, respectivamente. Vamos tomar como exemplo a função <code>sum()</code> que pertence ao grupo <code>Summary</code>, e vamos criar um método para o grupo <code>Summary</code>, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Metodo ben</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.Generic</span>, <span class='va'>.Class</span>, <span class='va'>.Method</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Vamos aplicar a funcao sum em um obj de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>1</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;sum&quot;         &quot;ben&quot;         &quot;Summary.ben&quot;</code></pre>
</div>
<p>Observamos nesse primeiro exemplo que o objeto <code>.Generic</code> acaba recebendo o nome da função genérica do grupo e não o nome do grupo, como poderíamos pensar. Porém, o nome do método acaba sendo relacionado com o nome do grupo e não da função genérica aplicada, nesse caso. No que isso interfere na semântica do sistema S3? Tudo! Vejamos um outro exemplo, com o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Metodo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='st'>"Eu sou do grupo 'Summary'"</span>
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Genericos do grupo 'Summary'</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/prod.html'>prod</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;&quot;</code></pre>
</div>
<p>Como criamos o método a partir do nome do grupo, todas as funções genéricas desse grupo despacharão nesse método, e o resultado para todas as funções será o mesmo. Um outro recurso, seria utilizar a função <code>switch()</code> para diferenciar o despache de método, apesar desse envio ser no próprio <code>Summary.ben()</code>. Vejamos o próximo código para esse elucidar o que acabamos de falar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Metodo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/switch.html'>switch</a></span><span class='op'>(</span><span class='va'>.Generic</span>,
         all <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         any <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         sum <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         prod <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         min <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>,
         range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span><span class='op'>)</span>
  
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Genericos do grupo 'Summary'</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/prod.html'>prod</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: all&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: any&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: sum&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: prod&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: min&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: max&quot;</code></pre>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: range&quot;</code></pre>
</div>
<p>Ou ainda, poderíamos ter criado um método apenas para uma função genérica específica do grupo. Desse modo, não criamos o método a partir do nome do grupo, mas da própria função. Vejamos o próximo código.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Metodo para o generico 'min'</span>
<span class='va'>min.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Eu sou do grupo 'Summary', mas generico: "</span>, <span class='va'>.Generic</span><span class='op'>)</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Generico do grupo 'Summary': min()</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Eu sou do grupo &#39;Summary&#39;, mas generico: min&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Ja com um outro generico de 'Summary', o resultado eh diferente</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
</div>
<p>Uma vez entendido a criação de método, vamos entender na sequência, os detalhes que a chamada <code>UseMethod()</code> realiza para o envio de método e os mecanismos de herança e como esse processo ocorre para as funções genéricas primitivas e os grupos genéricos, que não apresentam a chamada <code>UseMethod()</code> en seu código interno.</p>
<h3 id="envio-herança">Envio de método e mecanismo de herança</h3>
<p>Como falado anteriormente, o atributo <code>class</code> em um objeto, pode ser um vetor de <code>strings</code>, e ter diversos nomes. Já comentamos anteriormente sobre o <strong>envio de método</strong> ou também podemos chamar como <strong>despacho de método</strong>.</p>
<h4 id="envio-ou-despacho-de-método">Envio ou despacho de método</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FjXLC_hwSUA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>A ideia do envio de método e a criação de um vetor de potenciais nomes de métodos, como por exemplo esse:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"generic"</span>, <span class='st'>"."</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='st'>"default"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;generic.integer&quot; &quot;generic.default&quot;</code></pre>
</div>
<p>E desse modo a chamada <code>UseMethod</code> se encarregará de verificar quais os métodos que existem. Pode haver mais de uma existência de método, será chamado o primeiro método na sequência de métodos existentes. Para verificar isso, podemos usar a função <code>sloop::s3_dispatch()</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto de classe 'data.frame'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='op'>)</span> 
<span class='co'># Despacho (envio) do generico 'print'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>=&gt; print.data.frame
 * print.default</code></pre>
</div>
<p>O resultado da chamada <code>sloop::s3_dispatch()</code> pode apresentar três símbolos antes dos potenciais nomes de métodos:</p>
<ul>
<li><code>=&gt;</code>: este símbolo indica que a função genérica despachou no referido método;</li>
<li><code>*</code>: este símbolo indica que este método existe, mas a função genérica não despachou nele;</li>
<li><code>-&gt;</code>: indica o método chamado subjacente, após o método com o símbolo <code>=&gt;</code> ter sido chamado. Isso ocorre, por no método representado por <code>"=&gt;"</code> existe uma função nominada por <code>NextMethod</code> que faz o serviço de chamar o próximo método. Veremos esse ponto mais a frente.</li>
</ul>
<p>No código anterior, vimos os dois símbolos <code>=&gt;</code> e <code>*</code>. Interpretamos que a função genérica <code>print(x)</code> despachou em <code>print.data.frame()</code>, mas que o método <code>print.default</code> existia, porém não foi utilizado.</p>
<p>Vejamos o próximo código para entendermos o que significa o símbolo (<code>-&gt;</code>) na saída da função <code>sloop::s3_dispatch()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao generica</span>
<span class='va'>quem_sou_eu</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"quem_sou_eu"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Metodo numero natural</span>
<span class='va'>quem_sou_eu.numero_natural</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Eu sou um numero natural"</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='st'>"quem_sou_eu"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Metodo numerico</span>
<span class='va'>quem_sou_eu.numerico</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='st'>"Eu sou numerico"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>

<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"numero_complexo"</span>,<span class='st'>"numero_natural"</span>,<span class='st'>"numerico"</span><span class='op'>)</span>

<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'>quem_sou_eu</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   quem_sou_eu.numero_complexo
=&gt; quem_sou_eu.numero_natural
-&gt; quem_sou_eu.numerico
   quem_sou_eu.default</code></pre>
</div>
<p>Observemos que a função genérica <code>quem_sou_eu()</code> despachou no método <code>quem_sou_eu.numero_natural</code>, símbolo (<code>=&gt;</code>), mas internamente nesse método, nós temos a chamada <code>NextMethod()</code> que invoca o próximo método. Nesse caso foi <code>quem_sou_eu.numerico</code>, com o símbolo (<code>-&gt;</code>). Os demais métodos não existem, pois não apresentam o asterisco (<code>*</code>). Entenderemos um pouco mais sobre a chamada <code>NextMethod()</code> mais a frente.</p>
<h4 id="funções-primitivas-genéricas-e-genéricos-de-grupo">Funções primitivas genéricas e genéricos de grupo</h4>
<p>Anteriormente falamos sobre as funções primitivas genéricas. Dissemos que eram funções escritas em linguagem <code>C</code>, não apresentavam as três composições básicas de uma função: <code>formals()</code>, <code>body()</code>, <code>environment()</code>, e que não apresentavam internamente a chamada <code>UseMethod</code>. Então, se o objeto inserido no primeiro argumento dessas funções não tiverem o atributo <code>class</code> (objeto base), o despacho para métodos não ocorrerá, isto é, as funções primitivas genéricas não usarão as classes implícitas. Isso porque, as funções que se comportam de modo diferente para diferentes tipos de objetos base, apresentam essa característica não porque formam um sistema POO, mas porque estas funções primitivas usam instruções da linguagem <code>C</code> do tipo <code>switch</code>. Nós temos a versão da função <code>switch()</code> em <a href="http://r-project.org/" target="_blank">R</a>, e foi comentada no <a href="nbasico.html">módulo Básico</a>. Vejamos a função primitiva genérica <code>cbind()</code>, como exemplo a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eh primitiva generica?</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/is_s3_generic.html'>is_s3_generic</a></span><span class='op'>(</span><span class='st'>"cbind"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Onde ocorre o despacho?</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   cbind.integer
   cbind.numeric
   cbind.default
=&gt; cbind (internal)</code></pre>
</div>
<!-- Entretanto, quando uso um atributo no argumento em cbind, o processo não ocorre quando faço o mesmo com a funcao length. Estudar depois essa ideia! Mandei essa duvida para o pacote sloop: -->
<!-- cbind.default <- function(x, ...) "Test!" -->
<!-- x <- 1:10 -->
<!-- sloop::s3_dispatch(cbind(structure(x, class = "numeric"))) -->
<!-- cbind(structure(x, class = "numeric")) -->
<!-- ##### -->
<!-- x <- matrix(1:6, nrow = 2) -->
<!-- sloop::s3_dispatch(print(x)) -->
<!-- length.default <- function(x) 10 -->
<!-- sloop::s3_dispatch(length(x)) -->
<!-- sloop::s3_dispatch(length(structure(x, class = "numeric"))) -->
<p>Percebemos nesse caso, como o objeto <code>1:10</code> não apresenta o atributo <code>class</code>, a função interna foi a chamada, e nenhuma das classes implícitas são utilizadas. Nesse caso, apenas função primitiva/interna é utilizada.</p>
<p>No caso dos <strong>genéricos de grupo</strong>, sabemos que o nome dos grupos podem fazer parte da criação do método e o despacho de todos os genéricos serão realizados nesse método. Mas também, podemos criar métodos específicos para um determinado genérico de um grupo, sem influenciar no despacho dos demais genéricos. Nesses casos, os genéricos de grupo procurarão inicialmente pelos métodos relacionados as funções primitivas genéricas (<code>fpgenerica.classe</code>), e não achando, procurará pelos métodos relacioado aos nomes dos grupos (<code>grupo.classe</code>), não achando, despachará na função primitiva. Pode haver também o mecanismo de herança, por meio da chamada <code>NextMethod()</code>. Vejamos o código a seguir para o primeiro caso.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto de classe factor</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span>
<span class='co'># Verificando o despacho de sqrt() do grupo 'Math'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   sqrt.factor
   sqrt.default
=&gt; Math.factor
   Math.default
 * sqrt (internal)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verificando o metodo Math.factor()</span>
<span class='va'>Math.factor</span>
</code></pre>
</div>
<pre><code>function (x, ...) 
stop(gettextf(&quot;%s not meaningful for factors&quot;, sQuote(.Generic)))
&lt;bytecode: 0x0000000024c9a2d0&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<p>Observamos nessa situação que o objeto do tipo <em>factor</em>, apesar de ser um resultado numérico, não se comporta como numérico. Nesse caso, calcular a raiz quadrado de cada elemento não será possível, ou qualquer outra operação do grupo <code>'Math'</code>, e assim, uma proteção para esse caso é assegurado logo no método <code>Math.factor()</code> (<code>=&gt;</code>) com a chamada <code>stop()</code>. A ideia da função <code>gettextf()</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> no ambiente <a href="http://r-project.org/" target="_blank">R</a>é similar a <code>printf()</code> para a linguagem <code>C</code>. No despacho, percebemos que existe a função primitiva (*) <code>sqrt()</code>, porém nesse caso, não foi utilizada.</p>
<p>Para os demais casos, podemos observar o código na sequência, para entendermos o que falamos anteriormente.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Primeira situacao:</span>
<span class='co'># ------------------</span>
<span class='co'># Metodo de grupo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='st'>"Eu despacho em todo grupo 'Summary'"</span>
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Despacho para funcao 'all'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   all.ben
   all.default
=&gt; Summary.ben
   Summary.default
 * all (internal)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>####################</span>
<span class='co'># Segunda situacao:</span>
<span class='co'># ------------------</span>
<span class='co'># Metodo apenas para a funcao 'all'</span>
<span class='va'>all.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='st'>"Eu despacho apenas para 'all.ben'"</span>
<span class='op'>}</span>
<span class='co'># Metodo de grupo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Despacho para funcao 'all'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>=&gt; all.ben
   all.default
 * Summary.ben
   Summary.default
 * all (internal)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###################</span>
<span class='co'># Terceira situacao:</span>
<span class='co'># ------------------</span>
<span class='co'># Metodo apenas para a funcao 'all'</span>
<span class='va'>all.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Metodo de grupo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='st'>"Eu passei por 'all.ben', mas terminei em 'Summary.ben'"</span>
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Despacho para funcao 'all'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>=&gt; all.ben
   all.default
-&gt; Summary.ben
   Summary.default
 * all (internal)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>###################</span>
<span class='co'># Quarta situacao:</span>
<span class='co'># ------------------</span>
<span class='co'># Metodo apenas para a funcao 'all'</span>
<span class='va'>all.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Metodo de grupo</span>
<span class='va'>Summary.ben</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span>, <span class='va'>na.rm</span><span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Objeto de classe 'ben'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='cn'>TRUE</span>, class <span class='op'>=</span> <span class='st'>"ben"</span><span class='op'>)</span>
<span class='co'># Despacho para funcao 'all'</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>=&gt; all.ben
   all.default
-&gt; Summary.ben
   Summary.default
-&gt; all (internal)</code></pre>
</div>
<p>A primeira situação o envio de método ocorre para <code>Summary.ben()</code> (<code>=&gt;</code>), se verifica a função primita <code>all()</code> (<code>*</code>), porém não executada. Na segunda situação, observamos a existência do método <code>Summary.ben()</code> (<code>*</code>) e a função primitiva <code>all()</code> (<code>*</code>), porém o descpacho ocorre em <code>all.ben()</code> (<code>=&gt;</code>). Na terceira situação, o despacho ocorre em <code>all.ben()</code> (<code>=&gt;</code>), que intermanente chama <code>NextMethod()</code>, delegando para <code>Summary.ben()</code> (<code>-&gt;</code>). Por fim, na quarta situação o envio de método ocorre em <code>all.ben()</code> (<code>=&gt;</code>) que delega para <code>Summary.ben</code> (<code>-&gt;</code>), que delega para a função primitiva <code>all()</code> (<code>-&gt;</code>).</p>
<!-- #### Cuidado com as anomalias -->
<!-- Pela flexibilidade do sistema S3, devemos tomar alguns cuidados na cria.... -->
<!-- # Metodo para o generico 'min' (genericos de grupo) -->
<!-- max.ben <- function(x, ..., na.rm = FALSE) { -->
<!--   print(x) # O problema eh que print despacha em print.default -->
<!-- } -->
<!-- # Com isso resolve -->
<!-- # print.ben <- function(x) { -->
<!-- #   "Despachou em print.ben" -->
<!-- # } -->
<!-- # Objeto de classe 'ben' -->
<!-- x <- structure(2:5, class = "ben") -->
<!-- # Despacho -->
<!-- sloop::s3_dispatch(print(x)) -->
<!-- # Executando -->
<!-- max(x) # Problema -->
<!-- ### -->
<!-- # Generico -->
<!-- fgenerica <- function(x) UseMethod("fgenerica") -->
<!-- # Metodo -->
<!-- fgenerica.ben <- function(..., na.rm = FALSE) print("Test") -->
<!-- # Objeto de classe 'ben' -->
<!-- x <- structure(2:5, class = "ben") -->
<!-- # Despacho -->
<!-- sloop::s3_dispatch(fgenerica(x)) -->
<!-- # Executando -->
<!-- fgenerica(x) # Sem problemas -->
<h4 id="chamada-nextmethod">Chamada <code>NextMethod()</code></h4>
<p>Vimos anteriormente que a chamada <code>UseMethod()</code> é responsável pelo envio de método, isto é, dado um objeto com um atributo <code>class</code> inserido no primeiro argumento do genérico, a chamada <code>UseMethod()</code> procurará pelo método específico dessa classe. Contudo, falamos anteriormente, que o atributo <code>class</code> pode ser um vetor de caracteres. Dessa forma é que entra a chamada <code>NextMethod()</code>. A ideia é aplicar o genérico para o próximo método. Já mostramos anteriormente essa semântica, e vamos reforçar com o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Generico</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='co'># Metodo 1</span>
<span class='va'>fgenerica.clas1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Despache para o metodo 1"</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Metodo 2</span>
<span class='va'>fgenerica.clas2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='st'>"Despache para o metodo 2"</span><span class='op'>)</span>
<span class='co'>############</span>
<span class='co'># Avaliacao:</span>
<span class='co'># Objeto clas1 e clas2</span>
<span class='fu'>fgenerica</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"clas1"</span>, <span class='st'>"clas2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Despache para o metodo 1&quot;
[1] &quot;Despache para o metodo 2&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto clas2</span>
<span class='fu'>fgenerica</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"clas2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Despache para o metodo 2&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Despacho</span>
<span class='fu'>sloop</span><span class='fu'>::</span><span class='fu'><a href='https://sloop.r-lib.org/reference/s3_dispatch.html'>s3_dispatch</a></span><span class='op'>(</span><span class='fu'>fgenerica</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"clas1"</span>, <span class='st'>"clas2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>=&gt; fgenerica.clas1
-&gt; fgenerica.clas2
   fgenerica.default</code></pre>
</div>
<p>O que caracteriza a chamada <code>NextMethod()</code> é a ocorrência do símbolo (<code>-&gt;</code>) na saída em <code>sloop::s3_dispatch()</code>. O que essa chamada de função faz é executar o próximo método.</p>
<p>De modo formal, apresentamos a sintaxe como <code>NextMethod(generic, object, ...)</code>. Se nenhum argumento for adionado em <code>NextMethod()</code>, os argumentos serão os mesmos em quantidade, ordem e nome do método corrente, e por consequência também dos argumentos do genérico. Outra coisa interessante é que por meio de <code>'...'</code>, podemos inserir mais argumentos para essa chamada, do qual todos os argumentos são anexados em uma lista como promessas, isto é, os argumentos não são avaliados. Porém se foram avaliados no ambiente atual ou no ambiente anterior, permanecerão avaliados. Vejamos alguns outros aspectos, dos quais alguns foram citados por <span class="citation" data-cites="chambers1993"><a href="#ref-chambers1993" role="doc-biblioref">Chambers and Hastie</a> (<a href="#ref-chambers1993" role="doc-biblioref">1993</a>)</span>:</p>
<ol type="1">
<li>Os argumentos são transmitidos do método corrente para o método herdado com seus valores atuais no momento em que <code>NextMethod()</code> é chamado;</li>
<li>Um objeto com mesmo nome de um dos argumentos (até mesmo o primeiro argumento) do método corrente, definido no ambiente de chamada de <code>NextMethod()</code>, pode ser passado para o método herdado, sendo um valor diferente definido no argumento do método corrente. No caso da chamada <code>UseMethod()</code>, é preservado o valor definido nos argumentos do genérico;</li>
<li>Alterar o primeiro argumento do genérico em uma chamada <code>NextMethod()</code> afeta os argumentos recebidos no método herdado, mas não na escolha desse método.</li>
<li>A avaliação preguiçosa dos argumentos continuam. Se um argumento não foi avaliado, continua não avaliado;</li>
<li>Argumentos ausentes permanecem ausentes no método herdado;</li>
<li>Alguns objetos definidos no método atual, se informados em <code>NextMethod()</code>, passarão para o método herdado, desde esse objeto seja um argumento do método herdado;</li>
<li>O ambiente de chamada de <code>NextMethod()</code> não é encerrado após finalizado a chamado do método herdado, como ocorre com <code>UseMethod()</code>;</li>
<li>A chamada <code>NextMethod()</code> é importante em algumas situações para evitar um <em>loop</em> infinito.</li>
</ol>
<p>Apresentaremos a seguir, um código para exemplificar esses pontos. E um código seguinte será específico para o último ponto.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Generico</span>
<span class='va'>fgenerica</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>UseMethod</a></span><span class='op'>(</span><span class='st'>"fgenerica"</span><span class='op'>)</span>
<span class='co'># Metodo 1</span>
<span class='va'>fgenerica.clas1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>z</span> <span class='op'>=</span> <span class='fu'>faux</span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span>generic <span class='op'>=</span> <span class='va'>.Generic</span>, object <span class='op'>=</span> <span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>z</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Passei pelo metodo 1"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Metodo 2</span>
<span class='va'>fgenerica.clas2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Chegando no metodo 2, consigo imprimir x:"</span>, <span class='va'>x</span>, <span class='st'>"e y:"</span>, <span class='va'>y</span>, <span class='st'>"\n"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Existe classe em x? "</span>, <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"class"</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"\n"</span><span class='op'>)</span>
  
<span class='op'>}</span>
<span class='co'>############</span>
<span class='co'># Avaliacao:</span>
<span class='co'># Chamada do generico com objeto  de classe: clas1 e clas2</span>
<span class='fu'>fgenerica</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>2</span>, class <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"clas1"</span>, <span class='st'>"clas2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Chegando no metodo 2, consigo imprimir x: 3 e y: 5 
NULL
Existe classe em x?  
Passei pelo metodo 1</code></pre>
</div>
<p>Observemos no momento da chamada <code>NextMethod()</code> no método <code>fgenerica.clas1()</code> que o objeto do primeiro argumento <code>x</code> do genérico foi alterado [(1), (2) e (3)]. Inicialmente tinha o valor <code>2</code> com atributo <code>class</code>, porém no ambiente de execução do método <code>fgenerica.clas1()</code>, um objeto associado ao mesmo nome <code>x &lt;- 3</code> foi criado e passado para <code>NextMethod()</code>. Nesse caso, esse novo objeto não apresenta mais o atributo <code>class</code> (Observe a saída: <code>Existe classe em x?  NULL</code>), e desse modo é repassado para o método herdado, porém observemos que o fato de não ter o atributo <code>class</code> não prejudicou nas escolhas dos métodos (3).</p>
<p>Ainda no método <code>fgenerica.clas1()</code> surge um argumento <code>z</code> que apresenta uma função <code>faux()</code> não existente, isso é a característica de avaliação preguiçosa dos argumentos por parte das funções (4), isso significa, que enquanto esse argumento não for chamado internamente, ele não será avaliado. E isso pode ser verificado, pois o genérico retorna o resultado esperado, sem mensagem de erros.</p>
<p>Um outro ponto importante é o objeto <code>y</code> definido no corpo do método <code>fgenerica.clas1()</code>, que não definido como seu argumento, mas sim como argumento na chamada <code>NextMethod()</code>, do qual pode ser repassada para o método herdado (6). Isso foi possível também porque <code>y</code> também entrou como argumento para o método <code>fgenerica.clas2()</code>.</p>
<p>Diferentemente de <code>UseMethod()</code>, a chamada <code>NextMethod()</code> não encerra o ambiente de chamada (7). Isso pode ser verificado com o resultado do genérico imprimindo <code>Passei pelo metodo 1</code>, isto é, o genérico despacha em <code>fgenerica.clas1()</code> que herda o método <code>fgenerica.clas2()</code>, por meio de <code>NextMethod()</code>. Após o fechamento de <code>fgenerica.clas2()</code> e posteriormente da chamada <code>NextMethod()</code>, o ambiente de execução de <code>fgenerica.clas1()</code> continua a executar as suas instruções, do qual segue com a execução de <code>cat("Passei pelo metodo 1")</code>, e posteriormente ocorre o seu fechamento.</p>
<p>Por fim, a justificativa do último ponto, vamos apresentar uma aplicação muito importante que ocorre com a função primitiva genérica <code>[</code>. Por exemplo, se tivermos um vetor associado ao nome <code>x</code> com um atributo <code>class</code> e desejarmos o segundo elemento, isto é, <code>x[2]</code>. Este resultado não preserva a classe de <code>x</code>. Para isto, precisamos criar um método para esse genérico, apresentado a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando um objeto de classe 'cpf'</span>
<span class='va'>new_cpf</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='va'>x</span>, class <span class='op'>=</span> <span class='st'>"cpf"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Metodo print para 'cpf'</span>
<span class='va'>print.cpf</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/substr.html'>substr</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>3</span>, <span class='fl'>9</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"*******"</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Criando e imprimindo x</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>new_cpf</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>12345678912</span>,
               <span class='fl'>78945612323</span>,
               <span class='fl'>98765432112</span><span class='op'>)</span><span class='op'>)</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1] &quot;12*******12&quot; &quot;78*******23&quot; &quot;98*******12&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Selecionando o segundo cpf</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 78945612323</code></pre>
</div>
<p>Observamos nesse exemplo que a função primitiva <code>[</code> é um genérico mas que não tem o método para classe <em>cpf</em>, e por isso retorno o valor do <em>cpf</em> na íntegra, algo que não queríamos como resultado. Nesse caso, precisamos criar um método para tal, sendo apresentado três soluções a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Primeira solucao (menos eficiente pq cria copia de x)</span>
<span class='va'>`[.cpf`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='fu'>new_cpf</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;78*******23&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Segunda solucao</span>
<span class='va'>`[.cpf`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
  <span class='fu'>new_cpf</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;78*******23&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Terceira solucao</span>
<span class='va'>`[.cpf`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>new_cpf</span><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] &quot;78*******23&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quarta solucao: Loop infinito</span>
<span class='va'>`[.cpf`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>new_cpf</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>Error: avaliação aninhada demais; recursão infinita / options(expressions=)?</code></pre>
</div>
<p>Uma primeira tentativa, resolve o problema, porém perdemos eficiência por fazer uma cópia do objeto <code>x</code>. A segunda e terceira tentativas, são mais eficientes, sendo que a última usa a chamada <code>NextMethod()</code>. Essa chamada procura pelo próximo método que é a própria função primitiva, que ao ser executada retorna o resultado, e este entra como um argumento da função <code>new_cpf()</code>. Então, o ocorre a chamada <code>new_cpf()</code> que retorna novamente um objeto de classe <em>cpf</em>. Por fim, a quarta tentativa gera um <em>loop</em> infinito, porque ao criar o método <code>[.cpf()</code>, percebemos que internamente usamos a função primitiva genérica <code>[</code>, e como o objeto <code>x</code> tem o atributo <code>class</code> igual a <code>cpf</code>, este procurará novamente o método, e assim por diante.</p>
<p>Na sequência, veremos em detalhes o mecanismo de herança de modo como o <code>UseMethod()</code> despacha para um determinado método, como também a chamada <code>NextMethod()</code> é usada para a busca do método herdado.</p>
<h4 id="mecanismo-de-herança">Mecanismo de herança</h4>
<iframe width="560" height="315" src="https://www.youtube.com/embed/GF2VpDIblhY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>O mecanismo de herança ocorre de acordo com os elementos do vetor de atributo <code>class</code> pela função genérica. Esse vetor pode ter qualquer comprimento. Além desses elementos, temos ainda uma pseudoclasse chamada <code>default</code> que não aparece no atributo <code>class</code>. O genérico procurará inicialmente pelo método para o primeiro elemento do vetor do atributo <code>class</code>, se o método para essa classe não existir, procurará pelo método observando pelo segundo elemento, e assim por diante. Caso o genérico percorra por todo o vetor, e não encontre o método para a classe desejada, o despacho ocorre no método <code>default</code>. E por fim, se este método não existir, o genérico retornará uma mensagem de erro erro.</p>
<p>O mecanismo de herança, ocorre por meio da chamada <code>NextMethod()</code>. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Construtor</span>
<span class='va'>new_intparord</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span>, <span class='va'>inteiro</span> <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>ordenado</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>classe</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"par"</span>, <span class='st'>"ordenado"</span>, <span class='st'>"inteiro"</span><span class='op'>)</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>inteiro</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>classe</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"inteiro"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>ordenado</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>classe</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ordenado"</span>, <span class='st'>"inteiro"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='va'>x</span>, class <span class='op'>=</span> <span class='va'>classe</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Método inteiro para o generico print</span>
<span class='va'>print.par</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span>, x <span class='op'>=</span> <span class='va'>x</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/logical.html'>as.logical</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>trunc</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>%%</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Método ordenado para o generico print</span>
<span class='va'>print.ordenado</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/UseMethod.html'>NextMethod</a></span><span class='op'>(</span><span class='va'>.Generic</span>, x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Método inteiro para o generico print</span>
<span class='va'>print.inteiro</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>new_intparord</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>10</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1]  2  4  6  8 10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$class
[1] &quot;par&quot;      &quot;ordenado&quot; &quot;inteiro&quot; </code></pre>
</div>
<p>Criamos uma função chamada de <code>new_intparord</code>, que é um <em>construtor</em> de instâncias de uma classe. Essa estratégia é importante principalmente quando temos classes com características mais complexas. O objeto criado desse construtor tem um atributo <code>class</code> de comprimento até de três classes: <code>"par"</code>, <code>"ordenado"</code> e <code>"inteiro"</code>. Isto é, a classe mais geral é <code>"inteiro"</code> e a chamamos no contexto de POO de <em>superclasse</em>, uma vez que é uma classe que abrange características mais gerais. Essa classe representa os números inteiros. A próxima classe é <code>"ordenada"</code>, que é uma organização dos números inteiros. Essa classe herda de <code>"inteiro"</code> a característica de que além de ordenado, esses elementos devem ser número inteiros. Essa herança ocorre por meio de <code>NextMethod()</code>. Por fim, a classe <code>"par"</code> que representa apenas os números pares, mas também, herda a sua ordenação da classe <code>"ordenado"</code>, que por sua vez, herda a condição dos número serem inteiros da classe <code>"inteiro"</code>. Nessa situação, fica claro que <code>"par"</code> é uma <em>subclasse</em> de <code>"inteiro"</code>, uma vez que representa um grupo mais restrito da classe mais abrangente. De um modo geral, dizemos que uma <em>subclasse</em> são as classes mais à esqueda no atributo <code>class</code> e a <em>superclasse</em> mais à direita.</p>
<p>Esse exemplo nos mostra a importância da chamada <code>NextMethod()</code> para o mecanismo de herança. Mais ainda, a rigor o sistema S3 não impõe restrições nenhuma entre subclasses e superclasses. Porém, o desenvolver deve pensar nesse aspecto, uma vez que em termos práticos, a construção das ideias se tornam mais fáceis na criação de suas rotinas. Não estamos falando necessariamente que a implementação de subclasses e superclasses seja algo fácil. Para contextualizar, percebamos que o objeto <code>x</code> do código anterior, desejássemo a impressão do segundo elemento, usaríamos <code>x[2]</code>. Retornaríamos o valor correto, porém a sua classe não seria presevada. Por quê? Porque a função primitiva genérica <code>[</code> não tem esses métodos implementados, isto é, <code>[.par</code>, <code>[.ordenado</code> e <code>[.inteiro</code>. Assim, também vale a aplicação do objeto <code>x</code> para os demais genéricos. Vejamos em código o que acabamos de falar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>new_intparord</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>10</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>; <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;par&quot;      &quot;ordenado&quot; &quot;inteiro&quot; </code></pre>
<pre><code>[1] 9</code></pre>
<pre><code>[1] &quot;integer&quot;</code></pre>
</div>
<p>Cada subclasse que for inserida no objeto <code>x</code> irá exigir sempre mais trabalho para que o desenvolve, porque necessita garantir teoricamente a herança.</p>
<!-- Um outro contexto para a discussão é a ideia de classes públicas e privadas.  -->
<!-- - falar que geralmente se resolve adicionando mais atributos as subclasses -->
<!-- Voltando ao problema de `[.par`, `[.ordenado` e `[.inteiro` ... -->
<!-- Falar sobre o mecanismo de herança dos genéricos de grupo... -->
<!-- ### Estratégias para o sistema S3 {#estrategiaS3} -->
<!-- https://adv-r.hadley.nz/s3.html#s3-constructor -->
<!-- https://adv-r.hadley.nz/s3.html#validators -->
<!-- https://adv-r.hadley.nz/s3.html#helpers -->
<!-- http://adv-r.had.co.nz/S3.html#undefined -->
<!-- Constutor, validador e ajudante.... -->
<!-- ### Subclasses e superclasses -->
<!-- https://adv-r.hadley.nz/s3.html#s3-subclassing -->
<!-- ### Métodos públicos e privados -->
<!-- - Statistical Methodos in S, pag. 466-467 -->
<!-- ### Métodos para o genérico print -->
<!-- - Observar algumas peculiaridades: -->
<!--   - a execução do console quando imprime o valor associado a um nome, usa a funcao print; -->
<!--   - percebi que se deve ter cautela ao utilizar a função print internamente dos seus métodos; -->
<!--   - verifiquei um possível bug na função print quando se cria métodos em funções primitivas -->
<!-- ### Estilos de objetos POO S3 {#est_obj_poo_s3} -->
<!-- https://adv-r.hadley.nz/s3.html#object-styles -->
<h1 id="aprof-objetos">Entendendo um pouco mais sobre objetos</h1>
<p>Depois de termos abordado a ideia de objetos no sentido de programação orientada a objetos, retornamos a ideia inicial abordada no <a href="nbasico.html">módulo básico</a>, do tipo do objeto no sentido da forma de como seus valores são organizados. Afirmamos que tínhamos a estrutura mais de objeto é um vetor, conhecidos como estruturas atômicas pois os seus valores são de mesmo modo (<code>character</code>, <code>logical</code>, <code>numeric</code>, <code>complex</code> e <code>raw</code>). Falamos também dos objetos do tipo lista, que armazenam outros objetos que podem ter modos diferentes.</p>
<h2 id="atomic-recursive">Estruturas atômicas e recursivas</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/jvJhihv_JOI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>A ideia de <em>estrutura atômica</em> ficou bem claro. Temos agora uma outra ideia que é a <em>estrutura recursiva</em>, que representa a condição dos objetos conterem elementos de sua própria estrutura. Por exemplo, uma lista pode ter um objeto que é uma lista, uma função também é uma estrutura recursiva, porque seus argumentos podem ser uma função, e assim por diante.</p>
<p>Para sabermos se um objeto é atômico ou recursivo, usamos as funções respectivamente, <code>is.atomic()</code> e <code>is.recursive()</code>. Assim, vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao auxiliar</span>
<span class='va'>eh_atom_ou_recur</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>atomico <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/is.recursive.html'>is.atomic</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, recursivo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/is.recursive.html'>is.recursive</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># Testando alguns objetos</span>
<span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='fl'>1</span>, d <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># TRUE FALSE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
     TRUE     FALSE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>          <span class='co'># FALSE TRUE </span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE      TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>         <span class='co'># FALSE TRUE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE      TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='va'>mean</span><span class='op'>)</span>              <span class='co'># FALSE TRUE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE      TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x</span><span class='op'>)</span>           <span class='co'># FALSE TRUE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE      TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># FALSE TRUE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE      TRUE </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>eh_atom_ou_recur</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>sqrt</span><span class='op'>)</span><span class='op'>)</span>      <span class='co'># FALSE FALSE</span>
</code></pre>
</div>
<pre><code>  atomico recursivo 
    FALSE     FALSE </code></pre>
</div>
<p>Na última execução, percebemos que a função <code>quote</code>, apesar de função ela é primitiva. Nesse caso, esse objeto fugirá a regra de atomicidade e recursividade, porque em seu único argumento <code>expr</code>, tudo que for inserido nele será uma expressão, e não será avaliado. O resultado de <code>quote()</code>, apesar de <code>mode()</code> retornar <code>call</code> ou <code>name</code>, este último quando remos uma constante, o seu resultado pode ser qualquer tipo.</p>
<p>Por que uma lista é uma lista, por exemplo? Podemos escrever uma lista da seguinte forma:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>lista</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>z <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>; <span class='va'>lista</span>
</code></pre>
</div>
<pre><code>$x
[1] 2

$y
$y$z
[1] 3</code></pre>
</div>
<p>Um outro caso é o objeto função. Podemos escrever uma função dentro de outra função, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fun1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>fun2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>y</span>
  <span class='fu'>fun2</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>fun1</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4</code></pre>
</div>
<p>A maioria dos objetos <a href="http://r-project.org/" target="_blank">R</a> são recursivos, exceções para os atômicos, <code>NULL</code>, objetos tipo <code>"symbols"</code>, objetos <code>"S4"</code>, objetos <code>"externalptr"</code>, objetos <code>"bytecode"</code> e <code>"weakref"</code>. Esses últimos raramente vísiveis ao usuário.</p>
<h2 id="vectors">Usando <code>vector()</code>, <code>is.vector()</code> e <code>as.vector()</code></h2>
<p>Apesar de conhecermos vetores como vetores atômicos, observemos que um objeto pode ser atômico mas não um vetor. Observemos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto NULL</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='cn'>NULL</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/is.recursive.html'>is.atomic</a></span><span class='op'>(</span><span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<pre><code>[1] TRUE</code></pre>
</div>
<p>A criação de vetores pode ser denvolvida pela função <code>vector(mode, length)</code>, cujos argumentos são <code>mode</code> tipagem de acordo com a linguagem <code>S</code> (<code>"logical"</code>, <code>"numeric"</code>, <code>"complex"</code>, <code>"character"</code> e <code>"raw"</code>). O argumento <code>mode</code> permite também <code>"integer"</code> e <code>"double"</code> de acordo com a tipagem da linguagem <code>C</code>. O argumento <code>length</code> representa o comprimento do vetor. Desse modo, criando um vetor de modo <code>"logical"</code> e de comprimento 5, temos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>"logical"</span>, length <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
<p>A identificação de um vetor é realizada por <code>is.vector()</code>, resultando em <code>TRUE</code> para um objeto tipo vetor, e <code>FALSE</code>, caso contrário. A afirmação anterior de que um objeto pode ser atômico mas não um vetor, ocorre porque quando usamos atributos aos vetores, exceto <em>nomes</em>, o retorno de <code>is.vector()</code> é <code>FALSE</code>. Vejamos o próximo código para essa confirmação.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/structure.html'>structure</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, atrib1 <span class='op'>=</span> <span class='st'>"atributo 1"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/is.recursive.html'>is.atomic</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<pre><code>[1] FALSE</code></pre>
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<p>Como esperado, <code>is.vector(x)</code> retorna <code>FALSE</code> por causa do atributo <code>atrib1</code>. Porém, quando coagimos <code>x</code> a um vetor, usando <code>as.vector()</code>, esse novo objeto retorna os valores sem seus atributos. A exceção ocorre apenas para o atributo <code>name</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>arg1 <span class='op'>=</span> <span class='fl'>1</span>, arg2 <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>; <span class='va'>x</span>; <span class='fu'><a href='https://rdrr.io/r/base/attributes.html'>attributes</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>arg1 arg2 
   1    2 </code></pre>
<pre><code>$names
[1] &quot;arg1&quot; &quot;arg2&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/is.recursive.html'>is.atomic</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<pre><code>[1] TRUE</code></pre>
</div>
<p>Sempre nos confundimos quando desejamos verificar a tipagem do vetor usando <code>typeof()</code> ou <code>mode()</code>, que já mencionamos também que o primeiro se relaciona com a tipagem <code>C</code> e o segundo com a tipagem <code>S</code>. Desse modo, a condição de equivalência ocorre, apesar de nomes diferentes entre algumas tipagens das linguagens, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto tipo 'integer' e 'numeric'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1L</span>
<span class='co'># Vericando</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"numeric"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"integer"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;integer&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mode.html'>mode</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;numeric&quot;</code></pre>
</div>
<p>Vimos na seção <a href="#objetos-base">objetos base</a> os tipos de objeto baseados na tipagem <code>C</code>. Os objetos tipo <code>"integer"</code> e <code>"double"</code> são equivalentes a <code>"numeric"</code> para a linguagem <code>S</code>, assim como o objeto <code>"symbol"</code> tem seu equivalente <code>"name"</code>. Isso significa, que também poderemos usar <code>is.vector()</code> e <code>as.vector()</code> para saber se os objetos são desses tipos ou coagi-los, respectivamente, sendo monstrado exemplos a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando um objeto "symbol" ou "name"</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>1</span>, mode <span class='op'>=</span> <span class='st'>"symbol"</span><span class='op'>)</span>
<span class='co'># Verificando</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"symbol"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"name"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando um objeto "pairlist"</span>
<span class='va'>fxy</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span>
<span class='va'>argumentos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/formals.html'>formals</a></span><span class='op'>(</span><span class='va'>fxy</span><span class='op'>)</span> 
<span class='co'># Verificando</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>argumentos</span>, mode <span class='op'>=</span> <span class='st'>"pairlist"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
</div>
<p>Se <code>mode = any</code> representa um objeto do tipo <code>any</code>, isto é, pode ser qualquer um dos tipos <code>"character"</code>, <code>"integer"</code>, <code>"double"</code>, <code>"numeric"</code>, <code>"complex"</code>, <code>"raw"</code>, <code>"list"</code> ou <code>"expression"</code>. Desse modo, a função <code>is.vector()</code> retornará <code>TRUE</code> para todos esses tipos de objetos, porém quando usado a função <code>mode()</code> ou <code>typeof()</code>, esta retornará os seus tipos de origem e não <code>"any"</code>, vejamos o código seguinte.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando um objeto "any"</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>as.vector</a></span><span class='op'>(</span><span class='fl'>1</span>, mode <span class='op'>=</span> <span class='st'>"any"</span><span class='op'>)</span>
<span class='co'># Verificando o tipo</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"any"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>x</span>, mode <span class='op'>=</span> <span class='st'>"numeric"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mode.html'>mode</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;numeric&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;double&quot;</code></pre>
</div>
<p>Por fim, se o argumento <code>mode</code> em <code>is.vector</code> for um tipo desconhecido, então o retorno será <code>FALSE</code>, ao invés de mensagem de erro.</p>
<h2 id="outros_obj">Conhecendo outros objetos</h2>
<p>No <a href="nbasico.html">módulo básico</a>, discutimos sobre alguns objetos que não demos detalhes adicionais ou não foram comentados.</p>
<!-- ### Objetos tipo `"complex"` -->
<!-- ### Objeto tipo `"raw"` -->
<!-- - https://stat.ethz.ch/R-manual/R-devel/library/base/html/raw.html -->
<!-- - https://docs.tibco.com/pub/enterprise-runtime-for-R/4.0.2/doc/html/Language_Reference/base/raw.html -->
<!-- - https://stackoverflow.com/questions/36119753/convert-raw-vector-to-r-object -->
<!-- - pacote base64enc -->
<!-- - funcao serialize -->
<!-- ### Objeto tipo `"S4"` -->
<!-- ### Objeto tipo `"language"` -->
<!-- ### Objeto tipo `"pairlist"` -->
<!-- ### Objeto tipo `"promise"` -->
<!-- - Usar o pacote `promises` -->
<h3 id="datas_horas">Objeto para datas, horas, tempo, durações e fusos horários</h3>
<p>O tempo intrínseco ao nosso dia a dia, e muitas vezes passamos despercebido em muitos aspectos. Vejamos, devido ao ano bissexto, alguns anos não têm 365 dias, nem 24 horas para um dia, muito menos 60 segundo para um minuto. Devido aos fenômenos de rotação e translação da terra, essas variáveis passam por alguns ajustes. Dessa forma, podemos perceber a complexidade de trabalhar com esses tipos de dados. Vamos aqui apresentar o básico para objetos que armazenam essas informações.</p>
<h4 id="datas">Datas</h4>
<p>O objeto que armazena esses tipos de dados são vetores tipo <code>"double"</code>, com classe <code>Date</code>, e portanto, um objeto POO do sistema S3. Para sabermos a data de hoje, usamos a função <code>Sys.time()</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Qual a data de hoje?</span>
<span class='va'>hoje</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.Date</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Qual o tipo de objeto?</span>
<span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;double&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eh um vetor?</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eh 'double'?</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='va'>hoje</span>, mode <span class='op'>=</span> <span class='st'>"double"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Qual a sua classe?</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Date&quot;</code></pre>
</div>
<p>Calma que as execuções para <code>is.vector()</code> retornaram <code>FALSE</code>, devido o atributo <code>class</code>. Se excluirmos verificaremos a sua confirmação, apresentado a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eh um vetor?</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eh 'double'?</span>
<span class='fu'><a href='https://rdrr.io/r/base/vector.html'>is.vector</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>, mode <span class='op'>=</span> <span class='st'>"double"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Qual a sua classe?</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Date&quot;</code></pre>
</div>
<p>Quando retornamos a classe implícita desse objeto, recebemos o seguinte resultado:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>unclass</a></span><span class='op'>(</span><span class='va'>hoje</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 18915</code></pre>
</div>
<p>O resultado 18915 coagido a <code>double</code> se refere ao número de dias desde a data “1970-01-01.” Essa data é em homenagem ao marco zero do sistema de calendário utilizado pelo sistema UNIX.</p>
<p>Podemos criar um objeto data com o construtor (gerador de instâncias de classe) chamado <code>.Date()</code>. O argumento de entrada será o número de dias após o marco “1970-01-01,” isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># O marco zero</span>
<span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.Date</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1970-01-01&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Um dia apos o marco</span>
<span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.Date</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1970-01-02&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Dez dias apos o marco</span>
<span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.Date</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1970-01-11&quot;</code></pre>
</div>
<p>A função de coerção para um objeto data é uma função genérica para as classes implícitas <code>"character"</code> e <code>"numeric"</code>, e para as classes <code>"POSIXct"</code>, e para mais detalhes da função, use <code>?as.Data()</code>. Vejamos alguns exemplos a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto x tipo "character"</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"2017-08-02"</span>
<span class='op'>(</span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;2017-08-02&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Date&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto x tipo "numeric"</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='co'># Com o objeto numerico, precisamos informar</span>
<span class='co'># a data inicial no argumento 'origin'. Nesse</span>
<span class='co'># caso, o retorno sera a data x dias apos </span>
<span class='co'># 'origin'</span>
<span class='co'># </span>
<span class='op'>(</span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>x</span>, origin <span class='op'>=</span> <span class='st'>"2017-08-02"</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>[1] &quot;2017-08-12&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto de classe 'POSIXct'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='st'>"2018-08-02 5:30"</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;2018-08-02&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Date&quot;</code></pre>
</div>
<p>Explicaremos posteriormente os objetos da classe <code>"POSIXct"</code>. Podemos alterar o formato tanto da data como também da hora, que falaremos mais a frente, por meio da função <code>format()</code>, cuja sintaxe geral para essa função é dada por:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(x, format, ...),</span></code></pre></div>
</div>
<p>em que <code>x</code> é o argumento que recebe um valor de data, e o argumento <code>format</code> é o argumento para informarmos o formato de apresentar essa data. O <em>default</em> é o formato <code>"%Y-%m-%d</code>. Porém, já vamos adiantar algumas siglas importantes na Tabela <a href="#tab:siglas-datas">1</a>, para a formatação das datas.</p>
<table>
<caption><span id="tab:siglas-datas">Table 1: </span> Siglas importantes para o formato de datas e horas.</caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 35%" />
<col style="width: 18%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Sigla</th>
<th style="text-align: center;">Significado</th>
<th style="text-align: center;">Sigla</th>
<th style="text-align: center;">Significado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>%Y</code></td>
<td style="text-align: center;">Todos os dígitos do ano</td>
<td style="text-align: center;"><code>%y</code></td>
<td style="text-align: center;">Os dois últimos dígitos do ano</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%C</code></td>
<td style="text-align: center;">Século (00-99)</td>
<td style="text-align: center;"><code>%c</code></td>
<td style="text-align: center;">Data e hora específico do local, formado <code>"%a %b %e %H:%M:%S %Y"</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>%B</code></td>
<td style="text-align: center;">Mês completo (Texto)</td>
<td style="text-align: center;"><code>%b</code> ou <code>%h</code></td>
<td style="text-align: center;">Mês abreviado (Texto)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%m</code></td>
<td style="text-align: center;">Mês (Número)</td>
<td style="text-align: center;"><code>%j</code></td>
<td style="text-align: center;">Número de dias no ano</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>%A</code></td>
<td style="text-align: center;">Dia da semana completa</td>
<td style="text-align: center;"><code>%a</code></td>
<td style="text-align: center;">Dia da semana abreviada</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%D</code></td>
<td style="text-align: center;">Data completa no formato <code>%m/%d/%y</code>, padrão <em>C99</em></td>
<td style="text-align: center;"><code>%d</code></td>
<td style="text-align: center;">Dia do mês</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>%H</code></td>
<td style="text-align: center;">Horas (24 horas)</td>
<td style="text-align: center;"><code>%l</code></td>
<td style="text-align: center;">Horas (12 horas)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%M</code></td>
<td style="text-align: center;">Minutos</td>
<td style="text-align: center;"><code>%S</code></td>
<td style="text-align: center;">Segundos</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>%p</code></td>
<td style="text-align: center;">inserção para as horas AM/PM</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%w</code></td>
<td style="text-align: center;">Dia da semana (texto)</td>
<td style="text-align: center;"><code>%W</code></td>
<td style="text-align: center;">Número da semana no ano ()</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>%x</code></td>
<td style="text-align: center;">Data específica de acordo com <code>Sys.setlocale()</code></td>
<td style="text-align: center;"><code>%X</code></td>
<td style="text-align: center;">Horário especificado de acordo com <code>Sys.setlocale()</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%z</code></td>
<td style="text-align: center;">Compensação em relação ao horário de Greenwich (<code>GMT</code>)</td>
<td style="text-align: center;"><code>%Z</code></td>
<td style="text-align: center;">Fuso horário</td>
</tr>
</tbody>
</table>
<p>Mais detalhes dessas siglas, <code>?strptime()</code>. Vejamos alguns exemplos no código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Dia de hoje</span>
<span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.Date</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;2021-10-15&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Formatando</span>
<span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>"%d/%m/%Y"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;15/10/2021&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>"%d de %B de %Y"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;15 de outubro de 2021&quot;</code></pre>
</div>
<p>Para os objetos de classe <code>"Date"</code>, as siglas utilizadas para a função <code>format()</code> devem estar relacionadas a data, isto é, dia, mês e ano. Lembrando que o resultado desse genérico, bem como de <code>as.character()</code>, retornam vetores de tipo caractere, sem a classe <code>"Date"</code>.</p>
<p>Algumas funções genéricas estão prontas para serem utilizados nesses objetos, como <code>+</code>, <code>-</code>, <code>seq()</code>, <code>rep()</code>, etc. Para saber mais quais métodos para essa classe, use <code>methods(class = "Date")</code>.</p>
<h4 id="datas">Datas, horas e fusos horários</h4>
<p>Se observarmos os métodos disponíveis para o genérico <code>as.Date()</code>, usando <code>methods(as.Date)</code>, direto ou indiretamente, internamente ao código há uma chamada <code>as.POSIXlt()</code> ou <code>as.POSIXct()</code>. Nesse caso, nas base do R a forma de armazenar a data e hora segue uma família de padrões especificados pela <a href="https://en.wikipedia.org/wiki/IEEE_Computer_Society">IEEE Computer Society</a> chamado <em>POSIX</em> (do inglês, Portable Operating System Interface). O objetivo é manter um padrão para que haja uma compatibilidade entre os sistemas operacionais. Assim, os objetos contrutores para armazernar além das datas também as horas são respectivamente, <code>.POSIXct()</code> e <code>.POSIXlt()</code>. O primeiro se refere a data e hora do calendário (<em>ct</em> - calendar time), e o segundo a data e hora local (<em>lt</em> - <em>local time</em>).</p>
<p>O construtor <code>.POSIXct()</code> é um vetor tipo <code>double</code>, em que seu primeiro argumento de entrada representa o número de segundos desde “1970-01-01.” Assim, esse construtor gera uma instância para as classes <code>"POSIXct"</code> e <code>"POSIXt"</code>, que podemos observar a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Marco zero</span>
<span class='op'>(</span><span class='va'>mzero</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.POSIXct</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1969-12-31 21:00:00 -03&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Classe</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>mzero</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;POSIXct&quot; &quot;POSIXt&quot; </code></pre>
</div>
<p>Percebemos que o resultado <code>mzero</code> não representa a data “1970-01-01.” Quando investigamos a função <code>.POSIXct()</code>, percebemos que um dos argumentos é <code>tz</code> que representa o fuso horário. Por <em>default</em> <code>tz = NULL</code>, e nesse caso será buscado o fuso horário do calendário do sistema operacional. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Marco zero, baseado no calendario SO</span>
<span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.POSIXct</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1969-12-31 21:00:00 -03&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Marco zero, fuso Horario de Greenwich (GMT) ou Tempo Universal Coordenado (UTC)</span>
<span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.POSIXct</a></span><span class='op'>(</span><span class='fl'>0</span>, tz <span class='op'>=</span> <span class='st'>"GMT"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1970-01-01 GMT&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.POSIXct</a></span><span class='op'>(</span><span class='fl'>0</span>, tz <span class='op'>=</span> <span class='st'>"UTC"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;1970-01-01 UTC&quot;</code></pre>
</div>
<p>Nesse caso, o resultado da chamada <code>.POSIXct(0)</code>, foi executado de um sistema operacional (SO) com fuso horário no Brasil, horário de Brasília, com fuso <em>-3GMT</em> em relação ao fuso horário <em>UTC</em> ou <em>GMT</em> (do inglês, Greenwich Mean Time e Coordinated Universal Time, respectivamente), que representa o fuso horário de Greenwich e o Tempo Universal Coordenado, respectivamente. Para se alterar o fuso horário, o argumento <code>tz</code> deve ser usado. Para saber, acesse a lista de fusos horários chamando <code>OlsonNames()</code>.</p>
<p>A coersão para um objeto <em>POSIXct</em>, a função usada é <code>as.POSIXct()</code>, que pode coagir a partir de vetores caracteres e numéricos. Seguem as mesmas ideias que comentamos para <code>as.Date()</code>, porém agora acrescentamos as horas. O fuso horário pode ser captado pelo calendário do sistema operacional, ou pode ser inserido.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto caractere</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"2021-09-02 22:46:30"</span>
<span class='va'>data_hora1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>data_hora1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;POSIXct&quot; &quot;POSIXt&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto numerico</span>
<span class='va'>data_hora2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.POSIXlt.html'>as.POSIXct</a></span><span class='op'>(</span><span class='fl'>100</span>, origin <span class='op'>=</span> <span class='st'>"1955-09-13"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>data_hora2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;POSIXct&quot; &quot;POSIXt&quot; </code></pre>
</div>
<p>A saída padrão é <code>"%Y-%m-%d %H:%M:%S"</code>, seguido do fuso horário. Essa configuração é realizada pelo genérico <code>format</code> que despacha para o método apropriado.</p>
<p>O outro contrutor é algo mais complicado de se trabalhar, porque ao invés de um vetor <code>double</code>, é uma lista com no mínimo 9 componentes que segue:</p>
<table>
<caption><span id="tab:comp-POSIXlt">Table 2: </span> Componentes do objeto <em>POSIXlt</em>.</caption>
<colgroup>
<col style="width: 47%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Componente</th>
<th style="text-align: center;">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>sec</code></td>
<td style="text-align: center;">Segundos</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>min</code></td>
<td style="text-align: center;">Minutos</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>hour</code></td>
<td style="text-align: center;">Horas</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>mon</code></td>
<td style="text-align: center;">Mês</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>zone</code></td>
<td style="text-align: center;">Fuso horário</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>wday</code></td>
<td style="text-align: center;">Dias da semana</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>mday</code></td>
<td style="text-align: center;">Dias do mês</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>year</code></td>
<td style="text-align: center;">Anos desde “1899-12-31.”</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>isdst</code></td>
<td style="text-align: center;">O fuso horário é utilizado para configurar o <code>isdst</code>, que representa o horário de verão</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>gmtoff</code></td>
<td style="text-align: center;">Deslocamento em segundos do horário de Greenwich (GMT)</td>
</tr>
</tbody>
</table>
<p>Os dois últimos componenente basicamente é o fuso horário que configura. O construtor é <code>.POSIXlt()</code>, e de forma mais direta, podemos usar <code>stiptime()</code> para converter vetores caracteres nesse classe. A classe desse objeto é <code>"POSIXlt"</code> e <code>POSIXt</code></p>
<p>Vejamos alguns exemplos para criação desse objeto, com o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Marco zero</span>
<span class='va'>xx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>sec <span class='op'>=</span> <span class='fl'>0</span>, min <span class='op'>=</span> <span class='fl'>0</span>, hour <span class='op'>=</span> <span class='fl'>0</span>, mday <span class='op'>=</span> <span class='fl'>0</span>,
           mon <span class='op'>=</span> <span class='fl'>0</span>, year <span class='op'>=</span> <span class='fl'>0</span>, wday <span class='op'>=</span> <span class='fl'>0</span>, yday <span class='op'>=</span> <span class='fl'>0</span>,
           isdst <span class='op'>=</span> <span class='fl'>0</span>, zone <span class='op'>=</span> <span class='st'>"America/Sao_Paulo"</span>, gmtoff <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
<span class='va'>tempo1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/base-internal.html'>.POSIXlt</a></span><span class='op'>(</span><span class='va'>xx</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>tempo1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;POSIXlt&quot; &quot;POSIXt&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto caractere -&gt; POSIXlt</span>
<span class='va'>tempo2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/strptime.html'>strptime</a></span><span class='op'>(</span><span class='st'>"2021-09-02 03:21 am UTC"</span>, <span class='st'>"%Y-%m-%d"</span><span class='op'>)</span>; <span class='va'>tempo2</span>; <span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span><span class='op'>(</span><span class='va'>tempo2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;2021-09-02 -03&quot;</code></pre>
<pre><code>   sec    min   hour   mday    mon   year   wday   yday  isdst   zone 
   &quot;0&quot;    &quot;0&quot;    &quot;0&quot;    &quot;2&quot;    &quot;8&quot;  &quot;121&quot;    &quot;4&quot;  &quot;244&quot;    &quot;0&quot;  &quot;-03&quot; 
gmtoff 
    NA </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>tempo2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;POSIXlt&quot; &quot;POSIXt&quot; </code></pre>
</div>
<p>Muitas outras funções podem ser utilizadas para manipulação de datas, mas deixaremos para o leitor em realizar as suas consultas adicionais: <code>striftime()</code>, <code>Sys.setlocale()</code>, <code>Sys.getlocale()</code>, <code>.difftime()</code>, <code>as.difftime()</code>, <code>Sys.timezone()</code>, <code>Sys.time()</code>, etc.</p>
<!-- # Para aprofundamento sobre data e tempo -->
<!-- https://www.r-bloggers.com/2020/04/a-comprehensive-introduction-to-handling-date-time-in-r-2/ -->
<!-- ?strptime -->
<p><!-- ?locales --> <!-- https://lubridate.tidyverse.org/index.html --></p>
<!-- Observações interessantes, fazendo testes: -->
<!-- - `Sys.timezone()`: observa o fuso horário do calendário -->
<!-- - `Sys.setlocale()` e `Sys.getlocale()` observa para as configurações do seu sistema operacional -->
<p>Tanto para datas, horas e fusos horários existem pacotes alternativos que podem facilitar a utilização desses tipos de dados, como por exemplo o pacote <a href="https://lubridate.tidyverse.org/">lubridate</a>.</p>
<!-- ### Objetos de classe `ts` -->
<!-- ### Objeto *tibble* -->
<!-- ## Objetos modo `raw` -->
<!-- ## Objetos modo `complex` -->
<h2 id="copia_modif_tam_objetos">Cópia ao modificar, modificação no local e tamanho de objetos</h2>
<!-- https://developer.r-project.org/memory-profiling.html -->
<!-- - Posteriormente explorar o assunto: bit, byte, etc, similar a aula de aluno para aluno (Youtube), e pincelar sobre ponteiros ... -->
<!-- Pincelar sobre uso de memória no R: `gc()`, digitando `?mem` aparece uma quantidade de funções sobre memória; `?Memory`; `gc.time()` -->
<!-- https://msmith.de/2020/05/14/exploring-r-reference-counting.html -->
<!-- f <- function() { -->
<!--     x <- y <- integer(length = 10e7) -->
<!--     for(i in sample(length(x), size = 10)) {  -->
<!--         x[i] <- as.integer(i) -->
<!--         y[i] <- as.integer(length(x)-i) -->
<!--     } -->
<!-- } -->
<!-- bench::mark(f(), iterations = 10) -->
<p>Muitos dos problemas de perda de desempenho do código <a href="http://r-project.org/" target="_blank">R</a> pode estar envolvido a essa seção. Já abordamos no <a href="nbasico.html">módulo básico</a> de modo superficial, e agora iremos aprofundar um pouco mais. Outro assunto importante dentro do <strong>paradigma da programação funcional</strong>, que é a <strong>imutabilidade</strong>. Veremos que em algumas situações os objetos podem ser <strong>mutáveis</strong>, e com isso podemos afirmar a linguagem <a href="http://r-project.org/" target="_blank">R</a> <strong>não é estritamente funcional</strong>. Por fim, iremos perceber um grande equívoco que ocorre entre os programadores <a href="http://r-project.org/" target="_blank">R</a> quando cria um objeto associado ao nome <code>x</code>, afirma que criou um objeto <code>x</code> cujo valor está dentro dele. Perceberemos que na verdade, temos dois objetos envolvidos, e o que faz retornar o valor associado ao nome <code>x</code> é o ambiente onde esses objetos foram criados, de modo que, poderemos associar mais de um nome ao mesmo objeto.</p>
<p>Sugerimos que quando buscarmos pelo identificador de memória de onde os objetos foram alocados na memória ativa do seu sistema operacional, seja usado o interpretador do <a href="http://r-project.org/" target="_blank">R</a> ao invés do <a href="http://rstudio.org/" target="_blank">RStudio</a>, porque a IDE faz uma referência a cada objeto para exibir informações sobre ele.</p>
<p>Quando falamos dos tipos de <strong>objeto base</strong>, mencionamos os 24 tipos de objetos que existem no ambiente <a href="http://r-project.org/" target="_blank">R</a>. Vejamos o código a seguir.</p>
<pre data-recho="TRUE," data-include="TRUE"><code>x &lt;- 10</code></pre>
<p>Falamos também que o objeto nome é do tipo <code>symbol</code>, como no caso de <code>x</code>, e o objeto <code>10</code> é um vetor numérico tipo <code>integer</code> de comprimento <code>1</code>. Ao criar esse objeto, a forma de recuperá-lo é associar um nome a ele, uma vez que o ambiente <code>R</code> não tem uma forma de recuperar o valor do objeto pelo identificador de memória onde ele foi reservado, pelo menos ainda limitados a compreensão de existência. As ligações desses objetos ficam armazenados como uma lista em um outro objeto, o ambiente. Nesse caso, essa ligação foi armazenada no ambiente global, <code>.GlobalEnv</code>. Na Figura <a href="#fig:ligacoes-obj">2</a>, mostramos em detalhes essas ligações.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:ligacoes-obj"></span>
<img src="images/ligacoes_obj.png" alt="Ligações entre objetos tipo `'symbol'` e `'integer'`." width="70%" />
<p class="caption">
Figure 2: Ligações entre objetos tipo <code>'symbol'</code> e <code>'integer'</code>.
</p>
</div>
</div>
<p>Diante disso, o que vem a ser a cópia de um objeto, nada mais é do que alocar um outro espaço de memória para armazenar o(s) valor(es) do objeto copiado. Isso significa, mais espaço de memória ativa. Há de se observar que o consumo de memória pelo <code>R</code> é um dos gargalos do ambiente, mas ao longo do tempo vem evoluindo bastante. Porém, muitas vezes é o mau uso na escrita das rotians desenvolvida pelos usuários que gera essas intempéries. Então, vamos lá para uma série de exemplos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Exemplo 1</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='va'>b</span> <span class='op'>&lt;-</span> <span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fl'>6</span>
<span class='co'># identificador de memoria</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x2c8c9d80&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x2c8c9d80&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x2c8c9d80&quot;</code></pre>
</div>
<p>Lembrando no <a href="nbasico.html">módulo básico</a>, que os identificadores de memória sempre se alteram, à medida que reiniciamos. Porém, percebam que ao chamar o objeto associado a esses nomes, todos retornam o valor <code>6</code>. Ainda mais, o identificador de memória é o mesmo. Portanto, aqui fica claro que não está havendo cópia do objeto, e sim, mais nomes se associando ao mesmo objeto, observemos a Figura <a href="#fig:lig-obj">3</a>, é o que chamamos de <strong>vinculação compartilhada</strong>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:lig-obj"></span>
<img src="images/a=b=d=6.png" alt="Ligações de nomes associados ao objeto numérico." width="70%" />
<p class="caption">
Figure 3: Ligações de nomes associados ao objeto numérico.
</p>
</div>
</div>
<p>Vamos agora apresentar um próximo código, para entendermos a definição de <strong>cópia ao modificar</strong>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor caractere ligado a dois nomes</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span><span class='op'>)</span>; <span class='va'>y</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<pre><code>[1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Identificador de memoria do obj associado aos nomes</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>; <span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x247fafa8&quot;</code></pre>
<pre><code>[1] &quot;0x247fafa8&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Copia ao modificar</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"f"</span>
<span class='co'># Ident de mem do obj associado aos nomes apos a modificacao</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>; <span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x247fafa8&quot;</code></pre>
<pre><code>[1] &quot;0x1618af38&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Imprimindo novamente os objetos</span>
<span class='va'>y</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<pre><code>[1] &quot;f&quot; &quot;b&quot; &quot;c&quot;</code></pre>
</div>
<p>Percebam que criamos um vetor caractere de comprimento 3, e vinculamos a dois nomes, <code>x</code> e <code>y</code>. Posteriormente, alteramos o primeiro elemento do vetor <code>x</code>, mas isso não modificou o vetor <code>y</code>. O que aconteceu? O ambiente <code>R</code> preservou o objeto <code>y</code>, e fez uma cópia de 0x247fafa8 para 0x1618af38, com o valor alterado, e religou o nome <code>x</code> a esse objeto, Figura <a href="#fig:copia-obj">4</a>. Portanto, fazer uma cópia representa realocar um outro espaço de memória para armazenar os valores desse objeto, e assim, um outro identificador de memória será apresentado, diferente do objeto copiado.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:copia-obj"></span>
<img src="images/copia_obj.png" alt="Cópia de objetos." width="70%" />
<p class="caption">
Figure 4: Cópia de objetos.
</p>
</div>
</div>
<p>A função <code>tracemem()</code> do pocote <em>base</em>, pode auxiliar na verificação de cópias de objetos. Após a vinculação de um nome a um objeto, essa função pode ser acionada, e após as alterações de valores do objeto, se houver cópia, uma mensagem é impressa no console informando a referida cópia. Vejamos no código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor numerico de comprimento 3</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>; <span class='va'>w</span>
</code></pre>
</div>
<pre><code>[1]  0.8546449  1.1350022 -0.3083730</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Acionando a funcao 'tracemem()' e imprimindo o id de memoria</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tracemem.html'>tracemem</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>, <span class='st'>"\n"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;000000004395CC38&gt; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vinculacao de outro nome e copia</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='va'>w</span>; <span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
</code></pre>
</div>
<pre><code>tracemem[0x000000004395cc38 -&gt; 0x0000000043b374f8]: eval eval withVisible withCallingHandlers handle timing_fn evaluate_call &lt;Anonymous&gt; evaluate in_dir eng_r block_exec call_block process_group.block process_group withCallingHandlers process_file &lt;Anonymous&gt; &lt;Anonymous&gt; withCallingHandlers suppressMessages render_one FUN lapply sapply &lt;Anonymous&gt; &lt;Anonymous&gt; &lt;Anonymous&gt; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Desativando o rastreamento</span>
<span class='fu'><a href='https://rdrr.io/r/base/tracemem.html'>untracemem</a></span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span>
<span class='co'># Modificando novamente o obj z</span>
<span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>; <span class='va'>z</span>
</code></pre>
</div>
<pre><code>[1] 100.000000  10.000000  -0.308373</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Identificador de memoria</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_addr.html'>obj_addr</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;0x43b374f8&quot;</code></pre>
</div>
<p>Após vinculado o nome <code>w</code> ao vetor numerico de comprimento 3, que é um gerador de números aleatórios de uma distribuição normal padrão, acionamos a chamada <code>tracemem()</code>, e após a criação de cópias, a função mostrará a ocorrência dessas cópias. Se desejarmos que essa mensagem não seja mais acionada, devemos usar a chamada <code>untracemem()</code>, que desativará o rastreameto de cópia. Lembrando que o rastreamento só ocorrerá o objeto informado na função <code>tracemem()</code>. Por fim, fizemos mais uma alteração no objeto <code>z</code>, e nesse caso como o objeto se associa apenas a um nome, ocorre a <strong>modificação no local</strong>, um processo de otimização do <a href="http://r-project.org/" target="_blank">R</a>, em que usa a mesma alocação de memória, não havendo portanto, uma cópia de objeto.</p>
<p>Mas, fazendo alguns estudos e pesquisas, encontramos algumas funções primitivas, acessadas pela chamada <code>.Internals()</code>, denominada <code>inspect()</code>, <code>address()</code> e <code>refcnt()</code>, funções experimentais para imprimir informações de baixo nível dos objetos <a href="http://r-project.org/" target="_blank">R</a>. Essa função não é exposta ao nível superior da linguagem, e segundo a própria documentação, é um recurso para depuração/inpeção. A documentação ainda afirma que nem todas as informações foram implementadas. Para esse momento, o que está implementado é suficiente para identificarmos os procedimentos de cópia dos objetos. Uma segunda informação é que a partir da versão <a href="http://r-project.org/" target="_blank">R</a> 4.0.0, a decisão de cópia de objetos passaram a ser determinados pela contagem de referência, ao invés do mecanismo <code>NAMED</code>. Esse ponto realmente exige um entendimento de baixo nível na linguagem, isto é, a sua implementação em linguagem <code>C</code>. Vamos mostrar os resultados do código anterior, inspecionado por essas funções, a seguir.</p>
<!-- https://github.com/wch/r-source/blob/cd22e5a0554b7fb73bb508a8ee2053c48a377c8d/src/main/inspect.c -->
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor numerico de comprimento 3</span>
<span class='va'>w</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>; <span class='va'>w</span>
<span class='co'>## [1]  0.2733585 -0.6819105 -0.1788905</span>
<span class='co'># inspecionando em baixo nivel o objeto w</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>refcnt</span><span class='op'>(</span><span class='va'>w</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a046838 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0.273359,-0.68191,-0.17889</span>
<span class='co'>## &lt;pointer: 0x000000000a046838</span>
<span class='co'>## [1] 1</span>
<span class='co'># Vinculacao de outro nome e copia</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='va'>w</span>
<span class='co'># inspecionando em baixo nivel o objeto z</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>refcnt</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a046838 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 0.273359,-0.68191,-0.17889</span>
<span class='co'>## &lt;pointer: 0x000000000a046838&gt;</span>
<span class='co'>## [1] 2</span>
<span class='co'># Alterando z</span>
<span class='va'>z</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='co'># inspecionando em baixo nivel o objeto z</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>refcnt</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a046518 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0.273359,10,-0.17889</span>
<span class='co'>## &lt;pointer: 0x000000000a046518&gt;</span>
<span class='co'>## [1] 1</span>
<span class='co'># Modificando novamente o obj z</span>
<span class='va'>z</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>; <span class='va'>z</span>
<span class='co'>## [1] 100.0000000  10.0000000  -0.1788905</span>
<span class='co'># inspecionando em baixo nivel o objeto z</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>; <span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>refcnt</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a046518 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 100,10,-0.17889</span>
<span class='co'>## &lt;pointer: 0x000000000a046518&gt;</span>
<span class='co'>## [1] 1</span>
</code></pre>
</div>
</div>
<p>A função <code>inspect()</code> será melhor explorada no <a href="navancado.html">módulo avançado</a>. O que vamos precisar de sua saída é a estrutura <code>REF(#)</code>, que representa a contagem de referência, isto é, o símbolo <code>#</code> determina o número de nomes associados ao objeto inspecionado. Se <code># = 1</code>, não ocorrerá cópia de objeto, e sim, uma modificação no local. Se <code># &gt; 1</code>, certamente ocorrerá uma cópia de objeto. Observemos que inicialmente, o objeto associado a <code>z</code> é inspecionado com <code>REF(1)</code>, cujo número pode ser obtido também por <code>.Internal(refcnt(w))</code>. A chamada <code>.Internal(address(w))</code> informa o identificador de memória, o mesmo obtido por <code>lobstr::obj_addr(w)</code> ou <code>tracemem(w)</code>, este último com pequenas alterações. Na sequência, associamos um outro nome <code>z</code> ao objeto. Agora, observamos que a contagem de referência agora é <code>REF(2)</code>. Dessa forma, qualquer alteração nos valores de <code>w</code> ou <code>z</code>, haverá cópia de objeto. E isso acaba ocorrendo quando executamos <code>z[2] &lt;- 10</code>, verificando que o identificador de memória de <code>z</code> se alterou. Um outro fato muito importante surge nesse momento. A alteração do objeto foi realizada por uma função primitiva, e funções primitivas, geralmente, têm um melhor controle da contagem de referência, e nesse caso, percebemos que o novo objeto associado a <code>z</code> só existe esse nome, e portanto, a contagem de referência retorna a 1, isto é, <code>REF(1)</code>. Por fim, alteramos novamente o objeto associado a <code>z</code>, porém a modificação ocorre no local, porque <code>REF(1)</code>.</p>
<p>Uma outra consequência de cópia de objeto é a coersão. Vejamos o código na sequência para ilustrar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor inteiro de comprimento 10</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>integer</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='co'># Inspecionando x</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000066297e0 13 INTSXP g0c4 [REF(1)] (len=10, tl=0) 0,0,0,0,0,...</span>
<span class='co'># Alterando x com um escalar tipo 'double'</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span> <span class='co'># 10 eh 'double', 10L seria 'integer'</span>
<span class='co'># Inspecionando x</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000008dfcf88 14 REALSXP g0c5 [REF(1)] (len=10, tl=0) 10,0,0,0,0,...</span>
</code></pre>
</div>
</div>
<p>Falamos anteriormente que, geralmente, as funções primitivas têm um controle melhor da contagem de referência para decidir se um objeto será copiado ou não. Mas, nem todas. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># funcao primitiva c() - REF(1)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span><span class='op'>)</span>
<span class='co'># Inspecao de b</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>@0x0000000044844690 14 REALSXP g0c4 [REF(2)] (len=5, tl=0) 1,2,3,4,5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## @0x0000000006629620 14 REALSXP g0c4 [REF(1)] (len=5, tl=0) 1,2,3,4,5</span>
<span class='co'># Funcao primitiva `:` - REF(65535)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='co'># inspecao de b</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>@0x0000000025309740 13 INTSXP g0c0 [REF(65535)]  1 : 10 (compact)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## @0x000000000a060680 13 INTSXP g0c0 [REF(65535)]  1 : 10 (compact)</span>
<span class='co'># Funcao primitiva seq() - REF(65535)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1L</span>, <span class='fl'>10L</span><span class='op'>)</span>
<span class='co'># inspecao de b</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>@0x00000000264de810 13 INTSXP g0c0 [REF(65535)]  1 : 10 (compact)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## @0x000000000a05f3e8 13 INTSXP g0c0 [REF(65535)]  1 : 10 (compact)</span>
<span class='co'># Funcao primitiva rep() - REF(1)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>1</span><span class='op'>)</span> 
<span class='co'># Inspecao de b</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>@0x000000004484d708 13 INTSXP g0c4 [REF(2)] (len=10, tl=0) 1,2,3,4,5,...</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## @0x00000000066295b0 13 INTSXP g0c4 [REF(1)] (len=10, tl=0) 1,2,3,4,5,...</span>
</code></pre>
</div>
</div>
<p>Observemos que algumas funções são muito úteis para a implementação de nossas rotinas, porém estas geram cópias de objetos com a alteração de seus valores, ao invés de modificação no local. Por exemplo, as funções <code>:</code> e <code>seq()</code> são muito úteis para gerarmos uma sequência de valores espaçados igualmente, porém, observamos que suas contagens de referências são diferentes de 1. Isso significa que qualques alteração nos valores do objeto, criado por essas funções, geram cópias. Dependendo da implementação em um <em>loop</em>, por exemplo, o dispêndio de memória ativa pode ser muito alto, e por consequência, perda de desempenho.</p>
<p>No caso de funções tipo <code>closure</code>, isto é, criadas por <code>function()</code>, ocorre algo similar com a discussão anterior, porém, com algumas diferenças, vejamos o próximo código.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>x</span>
<span class='op'>}</span>
<span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>x</span>
<span class='op'>}</span> 
<span class='co'># Caso 1</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426578 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,2,3</span>
<span class='va'>k1</span> <span class='op'>&lt;-</span> <span class='fu'>f1</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426578 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 1,2,3</span>
<span class='co'>## [1] 1 2 3</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>k1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426578 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 1,2,3</span>
<span class='co'># Caso 2</span>
<span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426398 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,2,3</span>
<span class='va'>k2</span> <span class='op'>&lt;-</span> <span class='fu'>f2</span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426398 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 1,2,3</span>
<span class='co'>## [1] 1 2 3</span>
<span class='co'>## @0x000000000a426258 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 10,2,3</span>
<span class='co'>## [1] 10  2  3</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>k2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000a426258 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 10,2,3</span>
</code></pre>
</div>
</div>
<p>O objeto quando é vinculado em um argumento de um função, entra como promessa, isto significa que ele não é avaliado, apenas quando for chamado no corpo da função. Se nenhuma alteração for realizada a esse objeto, nenhuma cópia é realizada, porém a contagem de referência terá um nível superior. Observe o objeto <code>a</code>, o seu identificador de memória é o mesmo quando chamamos a primeira vez o argumento <code>x = a</code> na função <code>f1()</code>. Isso significa que como essa função é uma identidade, apenas imprime o próprio argumento, portanto, nada é alterado no argumento <code>x</code>. Porém, <code>REF(1)</code> passa para <code>REF(2)</code>, e o nome <code>k1</code> passa a se associar também com o objeto, ao invés de uma cópia de objeto, que pode ser representado pela Figura <a href="#fig:copy-mod-obj">5</a>. No segundo caso, criamos novamente o objeto <code>a</code>, ao ser chamado inicialmente agora na função <code>f2</code>, a contagem de referência passa para <code>REF(2)</code>, porém sem cópia inicialmente. Quando a chamada <code>[&lt;-</code> é executada ocorre uma cópia, por causa de <code>REF(2)</code>, Figura <a href="#fig:copy-mod-obj">5</a>. Ao ser copiado, essa função primitiva retorna a contagem de referência para 1, e a saída da função ocorre para <code>REF(1)</code>. Nesse sentido, os objetos associados aos nomes <code>k1</code> e <code>k2</code>, posteriormente, se alterados terão comportamentos diferentes. O objeto associado a <code>k1</code> se alterado, será realizado uma cópia, e no caso de <code>k2</code> ocorrerá uma modificação no local, tudo por causa da contagem de referência em cada um dos casos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:copy-mod-obj"></span>
<img src="images/copy-mod-obj.png" alt="Cópia e modificação no local de objetos." width="70%" />
<p class="caption">
Figure 5: Cópia e modificação no local de objetos.
</p>
</div>
</div>
<p>Os objetos tipo listas, que na realidade vetores mais complexos, apresentam comportamento semelhante na cópia na modificação, e na modificação no local. A ideia seguirá a mesma com a contagem de referência, <code>REF(1)</code> ocorre a modificação no local, e valores superiores a 1, cópia na modificação.</p>
<p>Como visto no <a href="nbasico.html">módulo básico</a>, os elementos de uma lista são vetores atômicos, e até mesmo listas. Desse modo, diferentemente dos vetores cuja estrutura armazena os próprios valores, as listas armazenam as identificações de memória em que os objetos foram alocados. Vejamos a estrutura de baixo nível desse tipo de objeto.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto lista</span>
<span class='va'>l1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>, <span class='fl'>10L</span>, <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># Inspecao do objeto</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>l1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000060b27f8 19 VECSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x00000000060b2848 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x00000000060af018 13 INTSXP g0c1 [REF(3)] (len=1, tl=0) 10</span>
<span class='co'>##  @0x00000000060aefa8 10 LGLSXP g0c1 [REF(3)] (len=1, tl=0) 1</span>
<span class='co'># Associacao de outro nome l2 ao obj lista</span>
<span class='va'>l2</span> <span class='op'>&lt;-</span> <span class='va'>l1</span>
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>l2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000060b27f8 19 VECSXP g0c3 [REF(2)] (len=3, tl=0)</span>
<span class='co'>##  @0x00000000060b2848 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x00000000060af018 13 INTSXP g0c1 [REF(3)] (len=1, tl=0) 10</span>
<span class='co'>##  @0x00000000060aefa8 10 LGLSXP g0c1 [REF(3)] (len=1, tl=0) 1</span>
<span class='co'># Alterando l2</span>
<span class='va'>l2</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>5</span>
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>l2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064fc860 19 VECSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x00000000060b2848 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x00000000060af018 13 INTSXP g0c1 [REF(4)] (len=1, tl=0) 10</span>
<span class='co'>##  @0x0000000007fc77e0 14 REALSXP g0c1 [REF(3)] (len=1, tl=0) 5</span>
</code></pre>
</div>
</div>
<p>Nesse caso, podemos representar uma lista pela Figura <a href="#fig:lista-vinculacao">6</a>. Observemos quando criamos mais de um nome associado ao objeto lista, e como os seus elementos apontam para os vetores.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:lista-vinculacao"></span>
<img src="images/lista-vinculacao.png" alt="Vinculação de nomes ao objeto lista." width="60%" />
<p class="caption">
Figure 6: Vinculação de nomes ao objeto lista.
</p>
</div>
</div>
<p>A alteração do terceiro elemento da lista <code>l2</code>, proporciona uma cópia de <code>l1</code>, porém os dois primeiros elementos de <code>l2</code> apontam para os mesmos dois primeiros objetos de <code>l1</code>, não havendo cópia sobre esses vetores, Figura <a href="#fig:lista-copia">7</a>. Para saber se determinado vetor de uma lista será copiado ou modificado no local, seguirá a mesma regra abordada em vetores com relação a contagem de referência dos vetores e não a contagem de referência da lista.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:lista-copia"></span>
<img src="images/lista-copia.png" alt="Cópias de listas." width="60%" />
<p class="caption">
Figure 7: Cópias de listas.
</p>
</div>
</div>
<p>Aparentemente, os quadro de dados (<em>Data frames</em>) deveriam ter os mesmos comportamentos de uma lista na cópia ou modificação no local. Porém, apresentamos uma diferença marcante no quadro de dados, alterar uma coluna nesse objeto, modifica apenas essa coluna, contudo, modificar por linha, todo o objeto é copiado. Vejamos em código essa explicação.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>qd1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>c1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>, c2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span><span class='op'>)</span><span class='op'>)</span> 
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000007ff9e78 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x0000000006382578 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x0000000006382528 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
<span class='co'># A primeira alteracao em copia</span>
<span class='va'>qd1</span><span class='op'>$</span><span class='va'>c1</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000007ffa178 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x000000000985c8f8 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,10,3</span>
<span class='co'>##  @0x0000000006382528 14 REALSXP g0c3 [REF(6)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
<span class='co'># Quando REF(1), a modificacao ocorre no local</span>
<span class='va'>qd1</span><span class='op'>$</span><span class='va'>c1</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>99</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000007ffa1b8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x000000000985c8f8 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 99,10,3</span>
<span class='co'>##  @0x0000000006382528 14 REALSXP g0c3 [REF(7)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
<span class='co'># Porem, quando a alteracao ocorre em linha,</span>
<span class='co'># sempre havera copia na modificacao</span>
<span class='va'>qd1</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>00</span>, <span class='fl'>00</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000007c2f3c8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000098c3550 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0,10,3</span>
<span class='co'>##  @0x00000000098c3500 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
<span class='co'># Porem, mesmo com REF(1) e alteracao em linha,</span>
<span class='co'># havera copia na modificacao</span>
<span class='va'>qd1</span><span class='op'>[</span><span class='fl'>2</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11</span>, <span class='fl'>11</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000007c0abe8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000098c3230 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0,11,3</span>
<span class='co'>##  @0x00000000098c31e0 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 0,11,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
</code></pre>
</div>
</div>
<p>No caso das modificações realizadas em coluna, podemos também verificar por meio da Figura <a href="#fig:dfcopia">8</a>. No caso das alterações realizadas em linha, sempre haverá cópia na modificação.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:dfcopia"></span>
<img src="images/dfcopia.png" alt="Cópia de quadro de dados (*data frames*)." width="80%" />
<p class="caption">
Figure 8: Cópia de quadro de dados (<em>data frames</em>).
</p>
</div>
</div>
<p>Quando o objeto quadro de dados tem dois nomes associados, segue as mesmas ideias apresentadas nas listas, com a adição das características verificadas anteriormente para esse tipo de objeto, em que abaixo, apresentamos mais um código para análise.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Quadro de dados 1</span>
<span class='va'>qd1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>c1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>, c2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span><span class='op'>)</span><span class='op'>)</span> 
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064d2db8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000099a0448 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x00000000099a03f8 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
<span class='co'># Quadro de dados 2</span>
<span class='va'>qd2</span> <span class='op'>&lt;-</span> <span class='va'>qd1</span>
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064d2db8 19 VECSXP g0c2 [OBJ,REF(2),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000099a0448 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 1,2,3</span>
<span class='co'>##  @0x00000000099a03f8 14 REALSXP g0c3 [REF(5)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>##  ...</span>
 
<span class='co'># A copia em coluna, o quadro de dado copia apenas a coluna</span>
<span class='va'>qd2</span><span class='op'>$</span><span class='va'>c1</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064d3238 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000099cf960 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,10,3</span>
<span class='co'>##  @0x00000000099a03f8 14 REALSXP g0c3 [REF(7)] (len=3, tl=0) 4,5,6</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>##  ...</span>
<span class='va'>qd2</span><span class='op'>$</span><span class='va'>c2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>100</span>, <span class='fl'>100</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064d32b8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000099cf960 14 REALSXP g0c3 [REF(2)] (len=3, tl=0) 1,10,3</span>
<span class='co'>##  @0x00000000099cf870 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 100,100,100</span>
<span class='va'>qd2</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>100</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>qd2</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x00000000064d34b8 19 VECSXP g0c2 [OBJ,REF(1),ATT] (len=2, tl=0)</span>
<span class='co'>##  @0x00000000099cf5a0 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 100,10,3</span>
<span class='co'>##  @0x00000000099cf550 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 100,100,100</span>
<span class='co'>## ATTRIB:</span>
<span class='co'>## ...</span>
</code></pre>
</div>
</div>
<p>Podemos perceber ao final algumas características para a modificação no local:</p>
<ul>
<li>contagem de referência;</li>
<li>objetos associados a apenas um nome;</li>
<li>objetos tipo <code>"Environment"</code>, ambientes. Será apresentado apenas nas seções seguintes, quando aprofundamentos as características desse tipo de objeto.</li>
</ul>
<p>Por fim, não poderíamos de reforçar o exemplo apresentado na Figura <a href="#fig:copia-obj">4</a>. Esses dois objetos são vetores tipo <code>character</code>, isto é <em>string</em>. Apesar de apresentarmos dessa forma: <code>x &lt;- c("a", "b", "d")</code>, e parecer um objeto alocado em um mesmo espaço de memória para armazenar seus valores, o que temos na realizadade é um ponteiro para cada elemento do vetor, apontando para uma <em>string</em> única dentro do conjunto de caracteres (<em>strings</em>) global, que nesse caso é um objeto tipo <code>CHARSXP</code>, apresentada na seção <a href="nintermediario.html#objetos-base">Objetos base</a>, acessível apenas internamente ao ambiente <a href="http://r-project.org/" target="_blank">R</a>. Vejamos alguns exemplos pelo código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criamos tres objetos tipo 'character'</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"d"</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"abc"</span>, <span class='st'>"e"</span><span class='op'>)</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"f"</span>, <span class='st'>"abc"</span>, <span class='st'>"b"</span><span class='op'>)</span>
<span class='co'># Inspecionando os objetos</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000006f84908 16 STRSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x0000000006589e38 09 CHARSXP g0c1 [MARK,REF(10),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##  @0x0000000006c3d580 09 CHARSXP g0c1 [MARK,REF(14),gp=0x60] [ASCII] [cached] "b"</span>
<span class='co'>##  @0x0000000006a5ec00 09 CHARSXP g0c1 [MARK,REF(5),gp=0x61] [ASCII] [cached] "d"</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000006f84868 16 STRSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x0000000006589e38 09 CHARSXP g0c1 [MARK,REF(10),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##  @0x0000000006984360 09 CHARSXP g0c1 [REF(7),gp=0x60] [ASCII] [cached] "abc"</span>
<span class='co'>##  @0x0000000000393188 09 CHARSXP g0c1 [MARK,REF(5),gp=0x61] [ASCII] [cached] "e"</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000006f847c8 16 STRSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x000000000641d518 09 CHARSXP g0c1 [MARK,REF(6),gp=0x61] [ASCII] [cached] "f"</span>
<span class='co'>##  @0x0000000006984360 09 CHARSXP g0c1 [REF(7),gp=0x60] [ASCII] [cached] "abc"</span>
<span class='co'>##  @0x0000000006c3d580 09 CHARSXP g0c1 [MARK,REF(14),gp=0x60] [ASCII] [cached] "b"</span>
<span class='co'># Se alterar apenas a 'string', ocorre apenas a mudanca do </span>
<span class='co'># apontamento com modificacao local</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"f"</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000006f84908 16 STRSXP g0c3 [REF(1)] (len=3, tl=0)</span>
<span class='co'>##  @0x0000000006589e38 09 CHARSXP g0c1 [MARK,REF(10),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##  @0x000000000641d518 09 CHARSXP g0c1 [MARK,REF(9),gp=0x61] [ASCII] [cached] "f"</span>
<span class='co'>##  @0x0000000006a5ec00 09 CHARSXP g0c1 [MARK,REF(5),gp=0x61] [ASCII] [cached] "d"</span>
<span class='co'># Alterando os elementos, bem como sua dimensao, ocorrera a copia </span>
<span class='co'># do objeto STRSXP, porem os elementos continuam apontando para as suas </span>
<span class='co'># respectivas 'strings' globais</span>
<span class='va'>x</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='st'>"f"</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>##@0x0000000006988190 16 STRSXP g0c3 [REF(1)] (len=4, tl=0)</span>
<span class='co'>##  @0x0000000006589e38 09 CHARSXP g0c1 [MARK,REF(11),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##  @0x000000000641d518 09 CHARSXP g0c1 [MARK,REF(13),gp=0x61] [ASCII] [cached] "f"</span>
<span class='co'>##  @0x0000000006a5ec00 09 CHARSXP g0c1 [MARK,REF(6),gp=0x61] [ASCII] [cached] "d"</span>
<span class='co'>##  @0x000000000641d518 09 CHARSXP g0c1 [MARK,REF(13),gp=0x61] [ASCII] [cached] "f"</span>
</code></pre>
</div>
</div>
<p>Pela Figura <a href="#fig:stringcopia">9</a>, podemos entender o que ocorrer nesses objetos. Para a situação de cópia, isso ocorrerá apenas se houver a alteração da dimensão do vetor. Caso, contrário a modificação ocorre no local.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:stringcopia"></span>
<img src="images/copiastrings.png" alt="Cópia de quadro de dados (*data frames*)." width="80%" />
<p class="caption">
Figure 9: Cópia de quadro de dados (<em>data frames</em>).
</p>
</div>
</div>
<h2 id="tamanho-de-objetos">Tamanho de objetos</h2>
<p>Quando falamos sobre tamanho de objetos, estamos pensando no quanto de memória é preciso para armazenar o objeto em seu computador. Porém, em algumas situações pode ser questionável esse tamanho, quando temos objetos cujos elementos são referências para objetos já existentes ou objetos existentes propriamente dito. Outra forma, ocorre quando há o compartilhamento de objetos em objeto listas ou <em>data frames</em>. A forma de verificarmos esse tamanho, pode ser por meio das funções, <code>object.size()</code> e <code>lobstr::obj_size()</code>. A primeira função quando temos comportilhamento de objetos em listas ou quadro dados por exemplo, pode superestimar o tamanho de memória para o referido objeto. Vamos observar alguns casos como esses, a seguir.</p>
<p>O tamanho dos objeto está relacionado com a cópia ou modificação no local. Além do mais, devemos notar também que listas e quadro de dados apontam para objetos que podem estar compartilhados, e algumas funções podem apresentar uma superestimativa do tamanho, que é o caso da função <code>object.size()</code>. Vamos comparar o resultado dessa função com <code>lobstr::obj_size()</code> na Figura <a href="#fig:tamlista">10</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:tamlista"></span>
<img src="images/tam_lista.png" alt="Tamanho de memória de listas." width="80%" />
<p class="caption">
Figure 10: Tamanho de memória de listas.
</p>
</div>
</div>
<p>Observamos que o objeto <code>z</code> é uma lista com cinco elementos, em que as referências apontam para o mesmo objeto. A estimativa de <code>object.size()</code> considera que os elementos apontam para objetos diferentes, quando na realidade está havendo um compartilhamento. Desse modo, o resultado de <code>lobstr::obj_size()</code> é bem menor e mais próximo do tamanho real, aproximadamente cinco vezes menor que o tamanho encontrado por <code>object.size()</code>.</p>
<p>No caso dos vetores tipo <code>character</code> como já falado anteriormente, iremos perceber que repetir uma <em>string</em> 1000 vezes, não significará multiplicar mil vezes o tamanho da memória reservada para essa <em>string</em> para armazenar esse objeto. O que ocorre é que o vetor armazena mil referências nos elementos para apontar para o mesmo objeto <code>CHARSXP</code>. Chamado uma vez uma determinada <em>string</em> em um objeto, poderemos observar que enquanto não fecharmos o nosso ambiente de trabalho, o espaço de memória alocada para essa <em>string</em> será sempre a mesma, seja usada nesse objeto ou em outros que possam ser de interesse. Nesse caso, percebamos que uma vez usada uma determinada <em>string</em> em um objeto, por ventura se for utilizada também em outros objetos, não estaremos ocupando mais memória específica para armazenar essa <em>string</em>, mas sim, se houver um acréscimo de memória para armazená-lo, será apenas para a referência que aponta para esse objeto (<code>CHARSXP</code>) no conjunto global de <em>strings</em>. Vejamos um exemplo para ilustrar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='st'>"ben"</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_size.html'>obj_size</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>112 B</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/object.size.html'>object.size</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>112 bytes</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>1000</span><span class='op'>)</span>; <span class='va'>y</span>
</code></pre>
</div>
<pre><code>   [1] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [11] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [21] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [31] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [41] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [51] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [61] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [71] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [81] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
  [91] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [101] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [111] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [121] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [131] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [141] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [151] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [161] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [171] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [181] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [191] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [201] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [211] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [221] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [231] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [241] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [251] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [261] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [271] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [281] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [291] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [301] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [311] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [321] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [331] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [341] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [351] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [361] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [371] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [381] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [391] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [401] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [411] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [421] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [431] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [441] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [451] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [461] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [471] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [481] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [491] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [501] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [511] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [521] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [531] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [541] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [551] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [561] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [571] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [581] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [591] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [601] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [611] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [621] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [631] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [641] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [651] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [661] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [671] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [681] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [691] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [701] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [711] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [721] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [731] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [741] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [751] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [761] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [771] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [781] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [791] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [801] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [811] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [821] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [831] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [841] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [851] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [861] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [871] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [881] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [891] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [901] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [911] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [921] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [931] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [941] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [951] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [961] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [971] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [981] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;
 [991] &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot; &quot;ben&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_size.html'>obj_size</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>112 B</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/object.size.html'>object.size</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>112 bytes</code></pre>
</div>
<p>Uma outra situação que vale a pena discutirmos é quando armazenamos objetos em listas, cujos os objetos são existentes com a inicialização do ambiente <a href="http://r-project.org/" target="_blank">R</a>, apresentado no código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto lista</span>
<span class='va'>l1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>median</span>, <span class='va'>range</span><span class='op'>)</span>
<span class='co'># Quanto de memoria?</span>
<span class='fu'>lobstr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/lobstr/man/obj_size.html'>obj_size</a></span><span class='op'>(</span><span class='va'>l1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>1,360 B</code></pre>
</div>
<p>A pergunta é, será que estamos utilizando, aproximadamente, toda essa memória para o objeto <code>l1</code>? Sabemos que as funções <code>median()</code> e <code>range</code> são do pacote <em>base</em> e com a inicialização do ambiente <a href="http://r-project.org/" target="_blank">R</a>, todos os objetos desse pacote são carregados, isto implica em um espaço de memória para alocar esses objetos. Podemos perceber também que o espaço de memória para armazenar esses objetos, são respectivamente, 1296 e 0, aproximadamente. O que os elementos de <code>l1</code> fizeram foi guardar a referência que aponta para esses objetos, e que muito provavelmente não precisaria de toda a memória para armazenar todo o objeto. De outro modo, percebemos que o tamanho real do objeto não é o que se apresenta, uma vez que os objetos apontados nas referências dos elementos das listas já existem, e desse modo, não foram necessários para armazenar todo o objeto, mas apenas o seu identificador de memória (referência). Vejamos o código a seguir, para confirmar o que acabamos de discutir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Inspecionando as funcoes 'median' e 'range'</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>median</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000006463210 03 CLOSXP g0c0 [MARK,REF(3)] </span>
<span class='co'>## ...</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>range</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x0000000000368688 08 BUILTINSXP g0c0 [MARK,REF(65535)] </span>
<span class='co'># Inspecionando o objeto 'l1'</span>
<span class='va'>l1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>median</span>, <span class='va'>range</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>l1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000038f300 19 VECSXP g0c2 [REF(1)] (len=2, tl=0)</span>
<span class='co'>##  @0x0000000006463210 03 CLOSXP g0c0 [MARK,REF(4)] </span>
<span class='co'>##   ...</span>
<span class='co'>##  @0x0000000000368688 08 BUILTINSXP g0c0 [MARK,REF(65535)] </span>
</code></pre>
</div>
</div>
<p>O identificadores de memória quando inspecionamos as funções <code>median</code> e <code>range</code>, são os mesmos identificadores para onde os elementos de <code>l1</code> apontam, confirmando assim, que esses espaços de memória já estavam reservados, e não foram alocados com a criação do objeto.</p>
<p>Por fim, como já mencionado no <a href="nbasico.html">módulo básico</a>, a <strong>representação alternativa</strong> (<code>ALTREP</code>) de uma sequência de elementos, por meio de “<code>:</code>” pode nos causar expanto, porque independente do comprimento, é armazenado apenas o primeiro e o último elemento da sequência. Isso significa que os vetores criados a partir de <code>:</code>, terão mesmo tamanho. Contudo, quando falos</p>
<!-- ## Coletor de lixo e desvinculação {#coletor_lixo_desvinc} -->
<!-- ## Mais manipulações com objetos e subconjuntos {#manip_obj_adicionais} -->
<!-- ### Vetores em geral -->
<!-- - Subconjuntos -->
<!-- - Falar da relação de `[` com os métodos, e a perda do atributo `class` -->
<!-- - arredondamentos -->
<!-- ### Vetores caracteres ou *Strings* -->
<!-- https://www.gastonsanchez.com/r4strings/ -->
<!-- https://gomesfellipe.github.io/post/2017-12-17-string/string/ -->
<!-- http://www.botanicaamazonica.wiki.br/labotam/doku.php?id=bot89:precurso:1textfun:inicio -->
<!-- https://bookdown.org/davi_moreira/txt4cs/stringR.html -->
<!-- ### pacote stringr -->
<!-- ### pacote tidytext -->
<!-- https://juliasilge.com/blog/learn-tidytext-learnr/ -->
<!-- https://juliasilge.shinyapps.io/learntidytext/ -->
<!-- ### Matrizes e *arrays* -->
<!-- ### Quadro de dados e *tible* -->
<!--
- Aprofundar e detalhar a parte de objetos de modo geral, não restringindo apenas aos vetores
- Nos vetores de modo caractere, trabalhar bem sua utilização; ver o material da ecologia da USP
-->
<!-- Usar o manual https://cran.r-project.org/doc/manuals/r-release/R-lang.html para seguir a todos os tipos de objetos -->
<h2 id="aprof-ambientes"><i class="fas fa-align-justify"></i> Aprofundamento sobre ambientes</h2>
<!-- Posteriormente pesquisar sobre o mecanismo hash table, que é um mescanismo otimizado para encontrar os objetos. -->
<p>Antes de iniciarmos um aprofundamento sobre ambientes, sugerimos a revisão introdutório desse assunto, no módulo básico, na seção <a href="https://bendeivide.github.io/cursor/nbasico.html#search_path">Ambientes e Caminho de busca</a>. O que falaremos nessa seção, pressupomos o entendimento que foi estudado no módulo anterior.</p>
<p>A primeira ideia ilustrada que iremos abordar é a hierarquização de ambientes pelo caminho de busca, usando <code>search()</code>. Sabemos que todo ambiente tem um pai ou ambiente superior, e que a única excessão é o ambiente vazio, <code>emptyenv()</code>. A representação dessa hierarquização pode ser observada na Figura <a href="#fig:caminho-busca">11</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:caminho-busca"></span>
<img src="images/caminho_busca.png" alt="Caminho por onde os objetos serão procurados." width="40%" />
<p class="caption">
Figure 11: Caminho por onde os objetos serão procurados.
</p>
</div>
</div>
<p>Para sabermos os parentais de um determinado ambiente, podemos recorrer ao pacote <a href="https://rlang.r-lib.org/">rlang</a>. Por exemplo, vamos criar um ambiente, e verificar seus parentais, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Ambiente</span>
<span class='va'>amb1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>new.env</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Verificando os seus parentais</span>
<span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/env_parent.html'>env_parents</a></span><span class='op'>(</span><span class='va'>amb1</span>, last <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>emptyenv</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [[1]] $ &lt;env: global&gt;
 [[2]] $ &lt;env: package:midrangeMCP&gt;
 [[3]] $ &lt;env: package:SMR&gt;
 [[4]] $ &lt;env: package:magrittr&gt;
 [[5]] $ &lt;env: package:leaflet&gt;
 [[6]] $ &lt;env: package:stats&gt;
 [[7]] $ &lt;env: package:graphics&gt;
 [[8]] $ &lt;env: package:grDevices&gt;
 [[9]] $ &lt;env: package:utils&gt;
[[10]] $ &lt;env: package:datasets&gt;
[[11]] $ &lt;env: package:methods&gt;
[[12]] $ &lt;env: Autoloads&gt;
[[13]] $ &lt;env: package:base&gt;
[[14]] $ &lt;env: empty&gt;</code></pre>
</div>
<p>Observemos que os parentais presentes, apresentou alguns ambientes como <code>tools:rstudio</code>, <code>Autoloads</code>. O primeiro sempre aparece quando usamos a IDE <a href="http://rstudio.org/" target="_blank">RStudio</a>. O ambiente <code>Autoloads</code>, que pode ser acessado por <code>.AutoloadEnv</code>, é um ambiente que armazena promessas de ligações. Por exemplo, podemos estar interessados em usar a função <code>makeCluster</code> do pacote <code>parallel</code>, porém, ao invés de carregar o pacote e alocar memória para armazenar todos o seus objetos, podemos deixar a função <code>makeCluster</code> como promessa no ambiente <code>Autoloads</code>, e caso seja utilizado em alguma linha de comando, uma outra função <code>autoloader()</code> é acionada, carregando o pacote <code>parallel</code> e a função de interesse e reavaliada no ambiente do pacote <code>parallel</code>. Qual a vantagem disso? Enquanto a função não é chamada, é como se o pacote estivesse carregado, porém sem ocupar nenhuma memória. Vejamos o exemplo a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Promessa makeCluster</span>
<span class='fu'><a href='https://rdrr.io/r/base/autoload.html'>autoload</a></span><span class='op'>(</span><span class='st'>"makeCluster"</span>, <span class='st'>"parallel"</span><span class='op'>)</span>
<span class='co'># Caminho de busca sem o pacote 'parallel'</span>
<span class='fu'><a href='https://rdrr.io/r/base/search.html'>search</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;.GlobalEnv&quot;          &quot;package:midrangeMCP&quot; &quot;package:SMR&quot;        
 [4] &quot;package:magrittr&quot;    &quot;package:leaflet&quot;     &quot;package:stats&quot;      
 [7] &quot;package:graphics&quot;    &quot;package:grDevices&quot;   &quot;package:utils&quot;      
[10] &quot;package:datasets&quot;    &quot;package:methods&quot;     &quot;Autoloads&quot;          
[13] &quot;package:base&quot;       </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verificamos que 'makeCluster' esta como promessa</span>
<span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='st'>"Autoloads"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;makeCluster&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Chamando a funcao</span>
<span class='va'>makeCluster</span>
</code></pre>
</div>
<pre><code>function (spec, type = getClusterOption(&quot;type&quot;), ...) 
{
    switch(type, PSOCK = makePSOCKcluster(names = spec, ...), 
        FORK = makeForkCluster(nnodes = spec, ...), SOCK = snow::makeSOCKcluster(names = spec, 
            ...), MPI = snow::makeMPIcluster(count = spec, ...), 
        NWS = snow::makeNWScluster(names = spec, ...), stop(&quot;unknown cluster type&quot;))
}
&lt;bytecode: 0x000000002798f5d8&gt;
&lt;environment: namespace:parallel&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verificando novamente o Caminho de busca,</span>
<span class='co'># agora com o pacote 'parallel'</span>
<span class='fu'><a href='https://rdrr.io/r/base/search.html'>search</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;.GlobalEnv&quot;          &quot;package:parallel&quot;    &quot;package:midrangeMCP&quot;
 [4] &quot;package:SMR&quot;         &quot;package:magrittr&quot;    &quot;package:leaflet&quot;    
 [7] &quot;package:stats&quot;       &quot;package:graphics&quot;    &quot;package:grDevices&quot;  
[10] &quot;package:utils&quot;       &quot;package:datasets&quot;    &quot;package:methods&quot;    
[13] &quot;Autoloads&quot;           &quot;package:base&quot;       </code></pre>
</div>
<p>Quando a função de interesse, que estava como promessa, é chamada, observamos que o pacote que contempla essa função é carregado e passa a ser anexado ao caminho de busca. Uma outra situação interessante é que ao anexar um pacote, o ambiente de pacote (<code>package:nome_pacote</code>), será o pai do ambiente global. Daremos mais detalhes sobre ambiente de pacote mais a frente.</p>
<p>Sabemos que o ambiente global é o ambiente corrente quando executamos a maioria de nossas linhas de comando, mas podemos também usar a chamada <code>environment()</code> para tal. Pelo <strong>caminho de busca</strong> ou <strong>caminho de pesquisa</strong>, o ambiente <a href="http://r-project.org/" target="_blank">R</a> procura pelos objetos. Assim, digitando alguma linha de comando no console, a primeira busca por um objeto, do qual um nome está associado a ele, se iniciará pelo ambiente global (<code>.GlobalEnv</code>), caso não encontre o nome específico no ambiente global, o ambiente <a href="http://r-project.org/" target="_blank">R</a> procurará pelo nome no ambiente pai, que no caso da Figura <a href="#fig:caminho-busca">11</a>, será o ambiente <code>package:stats</code>, e assim por diante. Não encontrando o nome específico em algum dos ambientes, a execução do comando retornará um erro informando que o objeto não foi encontrado. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2.333333</code></pre>
</div>
<p>Observemos que três chamadas de funções foram realizadas, <code>&lt;-</code>, <code>mean()</code> e <code>c()</code>. Essas funções não estão no ambiente global, que poderiam ser inspecionadas por <code>ls()</code>. Desse modo, o ambiente <a href="http://r-project.org/" target="_blank">R</a> procurará por todo o caminho de busca, e os encontrará no ambiente <code>package:base</code>. Uma vez encontrado, as funções são chamadas e a execução das linhas ocorrem com sucesso, Figura <a href="#fig:caminho-busca2">12</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:caminho-busca2"></span>
<img src="images/caminho_busca2.png" alt="Procurando por funções." width="60%" />
<p class="caption">
Figure 12: Procurando por funções.
</p>
</div>
</div>
<p>O que é interessantes em ambientes é que eles podem se conter, e ainda mais, as modificações ocorridas nos ambientes, modificam no local e não ocorrem cópias, como ocorre na maioria das situações com outros objetos, e algumas vezes isso é chamado de semâtica de referência, porque mesmo alterando o objeto as suas ligações continuam com as mesmas referências. Vejamos a Figura <a href="#fig:ambiente2">13</a>, como um exemplo, e seu respectivo código na sequência para inspeção do que acabamos de falar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:ambiente2"></span>
<img src="images/ambiente2.png" alt="Criando ambientes." width="60%" />
<p class="caption">
Figure 13: Criando ambientes.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Ambiente</span>
<span class='va'>amb1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>new.env</a></span><span class='op'>(</span>hash <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='co'># Inserindo objetos nesse ambiente</span>
<span class='va'>amb1</span><span class='op'>$</span><span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span>; <span class='va'>amb1</span><span class='op'>$</span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='st'>"a"</span>; <span class='va'>amb1</span><span class='op'>$</span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>
<span class='co'># Inspecao do objeto.</span>
<span class='fu'>Internal</span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>amb1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000db22758 04 ENVSXP g0c0 [REF(1)] &lt;0x000000000db22758&gt;</span>
<span class='co'>## FRAME:</span>
<span class='co'>##  @0x000000000db213a8 02 LISTSXP g0c0 [REF(1)] </span>
<span class='co'>##    TAG: @0x00000000078ebb28 01 SYMSXP g0c0 [MARK,REF(128)] "d"</span>
<span class='co'>##    @0x000000000db1fa38 10 LGLSXP g0c1 [REF(3)] (len=1, tl=0) 1</span>
<span class='co'>##    TAG: @0x000000000db1c4b8 01 SYMSXP g0c0 [REF(10)] "b"</span>
<span class='co'>##    @0x000000000db1fae0 16 STRSXP g0c1 [REF(3)] (len=1, tl=0)</span>
<span class='co'>##      @0x0000000006369e78 09 CHARSXP g0c1 [MARK,REF(14),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##    TAG: @0x0000000006483320 01 SYMSXP g0c0 [MARK,REF(60)] "a"</span>
<span class='co'>##    @0x000000000db186f8 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,2,4</span>
<span class='va'>ENCLOS</span><span class='op'>:</span>
<span class='co'>##  @0x0000000005fda628 04 ENVSXP g0c0 [MARK,REF(65535),GL,gp=0x8000] &lt;R_GlobalEnv&gt;</span>
<span class='va'>amb1</span><span class='op'>$</span><span class='va'>a</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>amb1</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000000db22758 04 ENVSXP g0c0 [REF(1)] &lt;0x000000000db22758&gt;</span>
<span class='co'>## FRAME:</span>
<span class='co'>##  @0x000000000db213a8 02 LISTSXP g0c0 [REF(1)] </span>
<span class='co'>##    TAG: @0x00000000078ebb28 01 SYMSXP g0c0 [MARK,REF(128)] "d"</span>
<span class='co'>##    @0x000000000db1fa38 10 LGLSXP g0c1 [REF(3)] (len=1, tl=0) 1</span>
<span class='co'>##    TAG: @0x000000000db1c4b8 01 SYMSXP g0c0 [REF(10)] "b"</span>
<span class='co'>##    @0x000000000db1fae0 16 STRSXP g0c1 [REF(3)] (len=1, tl=0)</span>
<span class='co'>##      @0x0000000006369e78 09 CHARSXP g0c1 [MARK,REF(16),gp=0x61] [ASCII] [cached] "a"</span>
<span class='co'>##    TAG: @0x0000000006483320 01 SYMSXP g0c0 [MARK,REF(62)] "a"</span>
<span class='co'>##    @0x000000000db186f8 14 REALSXP g0c3 [REF(1)] (len=3, tl=0) 1,10,4</span>
<span class='co'>## ENCLOS:</span>
<span class='co'>##  @0x0000000005fda628 04 ENVSXP g0c0 [MARK,REF(65535),GL,gp=0x8000] &lt;R_GlobalEnv&gt;</span>
<span class='fu'><a href='https://rdrr.io/r/base/environment.html'>parent.env</a></span><span class='op'>(</span><span class='va'>amb1</span><span class='op'>)</span>
<span class='co'>## &lt;environment: R_GlobalEnv&gt;</span>
</code></pre>
</div>
</div>
<p>De um modo geral, apresentamos a Tabela <a href="#tab:func-amb">3</a> para mostrar as principais funções para manipulações com ambientes</p>
<table>
<caption><span id="tab:func-amb">Table 3: </span> Funções para ambientes.</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Função</th>
<th style="text-align: center;">Objetivo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>globalenv()</code> ou <code>.GlobalEnv</code></td>
<td style="text-align: center;">Ambiente global</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>baseenv()</code></td>
<td style="text-align: center;">Ambiente do pacote <em>base</em></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>emptyenv()</code></td>
<td style="text-align: center;">Ambiente vazio</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>environment()</code></td>
<td style="text-align: center;">Ambiente corrente</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>search()</code></td>
<td style="text-align: center;">Lista o caminho de busca</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>new.env()</code></td>
<td style="text-align: center;">Criando um ambiente</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>parent.env()</code></td>
<td style="text-align: center;">Identificando o ambiente pai</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>parent.frame()</code></td>
<td style="text-align: center;">Ambiente funcional de chamada</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>ls()</code> ou <code>ls.str()</code></td>
<td style="text-align: center;">Descreve os objetos do ambiente</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>get()</code></td>
<td style="text-align: center;">Acessa o(s) valor(es) dos objetos de um ambiente</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>exists()</code></td>
<td style="text-align: center;">Verificando a existência de um objeto em um ambiente</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>identical()</code></td>
<td style="text-align: center;">Verificando a equivalência de ambientes</td>
</tr>
</tbody>
</table>
<h3 id="ambientes-especiais">Ambientes especiais</h3>
<p>Precisamos apresentar alguns ambientes especiais, importantes para o entendimento do ambiente <a href="http://r-project.org/" target="_blank">R</a>.</p>
<h4 id="ambientes-funcionais">Ambientes funcionais</h4>
<p>Distinguimos quatro tipos de ambientes funcionais, que são:</p>
<ul>
<li>Ambiente envolvente ou ambiente de função;</li>
<li>Ambiente de ligação;</li>
<li>Ambiente de execução;</li>
<li>ambiente de chamada;</li>
</ul>
<p>Esses ambientes são extremamente importantes, para o entendimento do escopo léxico do ambiente <a href="http://r-project.org/" target="_blank">R</a>, uma vez que tudo no <a href="http://r-project.org/" target="_blank">R</a> é uma chamada de função (Segundo princípio), de modo que, o ambiente envolvente, de execução e de chamada estarão relacionados a forma de como a função procurará pelos objetos, ao passo que o ambiente de ligação estará relacionado a forma de como os usuários procurarão pelas funções.</p>
<p>Na Figura <a href="#fig:amb-lig-env">14</a>, apresentamos o ambiente envolvente e o ambiente de ligação, para o seguinte código:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando o ambiente 'amb1'</span>
<span class='va'>amb1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>new.env</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Objeto x em 'amb1'</span>
<span class='va'>amb1</span><span class='op'>$</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='co'># Objeto x no ambiente global</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='co'># Criando a funcao 'h' em 'amb1'</span>
<span class='va'>amb1</span><span class='op'>$</span><span class='va'>h</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='va'>x</span>
<span class='co'># chamando a funcao h()</span>
<span class='va'>amb1</span><span class='op'>$</span><span class='fu'>h</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># vericando o id de memoria de amb1</span>
<span class='va'>amb1</span> <span class='co'># ou .Internal(address(amb1))</span>
</code></pre>
</div>
<pre><code>&lt;environment: 0x000000004212db70&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Ambiente envolvente de 'h'</span>
<span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='va'>amb1</span><span class='op'>$</span><span class='va'>h</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
</div>
<p>Nesse caso, observemos que para acessarmos a função <code>h</code>, precisamos saber qual o seu ambiente de ligação, por isso acessamos essa função por <code>amb1$h</code>. Ao chamarmos <code>amb1$h()</code>, foi retornado o valor <code>2</code>, Por quê? Esse resultado ocorre, porque ao ser criação o ambiente de execução para armazenar as ligações que ocorrerão no corpo da função, foi observado que não existia um nome <code>x</code> associado a algum objeto, nesse caso, a função passa a procurar no ambiente pai, que é o ambiente envolvente, e lá é encontrado o nome <code>x</code> associado ao valor <code>2</code>. Desse modo, conseguimos compreender que o ambiente de ligação serve apenas para nós usuários encontrarmos a função <code>h()</code>, mas em nada serve para que <code>h()</code> encontre os objetos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:amb-lig-env"></span>
<img src="images/amb-lig-env.png" alt="Ambiente envolvente e ambiente de ligação." width="60%" />
<p class="caption">
Figure 14: Ambiente envolvente e ambiente de ligação.
</p>
</div>
</div>
<p>A função vincula o ambiente corrente no momento de sua criação, e pode ser verificado por <code>environment()</code>. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando a funcao f1</span>
<span class='va'>f1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='fl'>1</span>
<span class='co'># Verificando o ambiente envolvente de f1</span>
<span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='va'>f1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando uma funcao f</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># ambiente de execucao</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Ambiente de execucao de f: \n"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  <span class='co'># Criando uma funcao f2</span>
  <span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='fl'>2</span>
  <span class='co'># Verificando o ambiente envolvente de f2</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"Ambiente envolvente de f2:\n"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='va'>f2</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>f</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Ambiente de execucao de f: 
&lt;environment: 0x00000000430e0420&gt;
Ambiente envolvente de f2:
&lt;environment: 0x00000000430e0420&gt;</code></pre>
</div>
<p>Observamos que a função <code>f1</code> foi criada no ambiente global, e que a função <code>f2</code> foi criada no ambiente de execução da função <code>f</code>, por isso a distinção dos ambientes envolventes dessas duas funções. Cada função terá apenas um ambiente envolvente.</p>
<p>No módulo básico, falamos sobre o ambiente de execução. Este ambiente é criado quando fazemos uma chamada de função. Após finalizado a chamada da referida função e retornado o valor desejado, este ambiente desaparece. O ambiente de execução tem como o pai o ambiente envolvente, e podemos representá-lo pela Figura <a href="#fig:amb-env-exec">15</a>, para o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:amb-env-exec"></span>
<img src="images/amb-env-exec.png" alt="Ambiente envolvente e ambiente de execução." width="60%" />
<p class="caption">
Figure 15: Ambiente envolvente e ambiente de execução.
</p>
</div>
</div>
<p>Esse ambiente, apresenta muitas características como a máscara de nome e o novo começo, apresentados na seção <a href="https://bendeivide.github.io/cursor/nbasico.html#esc_lexico">Escopo léxico</a>, no módulo básico.</p>
<p>Por fim, surge o último ambiente que é o ambiente de chamada, e está relacionado ao escopo dinâmico das funções em <a href="http://r-project.org/" target="_blank">R</a>, assunto também abordado na seção <a href="https://bendeivide.github.io/cursor/nbasico.html#esc_lexico">Escopo léxico</a>, no módulo básico. Na realidade, diremos que os pais do ambiente de execução são o ambiente envolvente e o ambiente de chamada. Daí surge o escopo dinâmico, do qual a busca por objetos não sendo encontrado no ambiente de execução, será procurado no ambiente de chamada ao invés do ambiente envolvente. Apesar, de termos apresentado um exemplo no módulo básico sobre essa característica, vamos reforçar com um outro exemplo, no código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Fabrica de funcoes</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
  <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>amb_envolvente</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/get.html'>get</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>amb_chamada</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/get.html'>get</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='fu'><a href='https://rdrr.io/r/base/sys.parent.html'>parent.frame</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>envolvente <span class='op'>=</span> <span class='va'>amb_envolvente</span>, chamada <span class='op'>=</span> <span class='va'>amb_chamada</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span>
<span class='co'># Funcao g</span>
<span class='va'>g</span> <span class='op'>&lt;-</span> <span class='fu'>h</span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Definindo 'x' no ambiente global</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>20</span>
<span class='co'># Chamada de g(), e verificando 'x' no ambiente de envolvente e de chamada</span>
<span class='fu'>g</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$envolvente
[1] 1

$chamada
[1] 20</code></pre>
</div>
<h3 id="ambientes-em-pacotes">Ambientes em pacotes</h3>
<p>Um detalhamento sobre ambientes em pacotes, bem como o desenvolvimento de pacotes, sugerimos acessar o projeto <a href="https://bendeivide.github.io/meupacoter/index.html">meupacoter</a>, como também o livro <a href="https://bendeivide.github.io/books/dpr/">Desenvolvimento de pacotes R</a>.</p>
<p>Existem dois ambientes em pacotes, quais sejam:</p>
<ul>
<li>Ambientes de pacotes,</li>
<li>Ambientes <em>namespace</em>.</li>
</ul>
<p>Dizemos que o ambiente de pacote é o local em que os usuários procuram pelos objetos. O ambiente de pacote estará disponível no ambiente de busca, e quando um pacote é anexado anexado, o ambiente de pacote do referido pacote, será o pai do ambiente global, e o pai do ambiente de pacote segue a hierarquia do caminho de busca. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Caminho de busca</span>
<span class='fu'><a href='https://rdrr.io/r/base/search.html'>search</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;.GlobalEnv&quot;          &quot;package:parallel&quot;    &quot;package:midrangeMCP&quot;
 [4] &quot;package:SMR&quot;         &quot;package:magrittr&quot;    &quot;package:leaflet&quot;    
 [7] &quot;package:stats&quot;       &quot;package:graphics&quot;    &quot;package:grDevices&quot;  
[10] &quot;package:utils&quot;       &quot;package:datasets&quot;    &quot;package:methods&quot;    
[13] &quot;Autoloads&quot;           &quot;package:base&quot;       </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Anexando o pacote 'parallel'</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>parallel</span><span class='op'>)</span>
<span class='co'># Verificando novamente o caminho de busca</span>
<span class='fu'><a href='https://rdrr.io/r/base/search.html'>search</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] &quot;.GlobalEnv&quot;          &quot;package:parallel&quot;    &quot;package:midrangeMCP&quot;
 [4] &quot;package:SMR&quot;         &quot;package:magrittr&quot;    &quot;package:leaflet&quot;    
 [7] &quot;package:stats&quot;       &quot;package:graphics&quot;    &quot;package:grDevices&quot;  
[10] &quot;package:utils&quot;       &quot;package:datasets&quot;    &quot;package:methods&quot;    
[13] &quot;Autoloads&quot;           &quot;package:base&quot;       </code></pre>
</div>
<p>Verifiquemos que o ambiente de pacote <code>parallel</code> passa a ser o pai do ambiente global, após a anexação ao caminho de busca. Uma outra forma de acessar uma função de um pacote sem anexá-lo, é por meio da chamada “<code>::</code>” Contudo, vale salientar que nessa última situação houve apenas o carregamento de uma determinada função, sem anexo ao caminho de busca, e isto significa a disponibilidade do pacote na memória ativa. No caso, da anexação de um pacote ao caminho de busca, além do carregamento ocorre a anexação do referido pacote. Após isso, podemos acessar as suas funções, digitando os nomes das referidas funções sem precisar mencionar o pacote em que estas estão disponíveis.</p>
<p>O outro ambiente é fundamental para a procura interna dos objetos, e esse é o ambiente <em>namespace</em>. O ambiente de pacote é como uma cópia do ambiente <em>namespace</em>, porque as mesmas ligações encontradas em um ambiente, também está no outro. Por exemplo, vejamos o próximo código.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Veja como uma funcao capta a informacao do ambiente global</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>aux</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>aux</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Testando a funcao sd(x)</span>
<span class='co'>#------------------------</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span> <span class='co'># o resultado de sd(x) de ser 1!</span>
<span class='co'># Criar uma variavel no ambiente global, 'var = "Nada"'. </span>
<span class='co'># Isso, implica que se 'sd' usar essa informacao, devera retornar um erro, pq sd se baseia em um vetor numerico</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='st'>"Nada"</span>

<span class='co'># Verificando a funcao 'sd()' internamente</span>
<span class='va'>sd</span>
</code></pre>
</div>
<pre><code>function (x, na.rm = FALSE) 
sqrt(var(if (is.vector(x) || is.factor(x)) x else as.double(x), 
    na.rm = na.rm))
&lt;bytecode: 0x000000002ad2b308&gt;
&lt;environment: namespace:stats&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Testando sd(x)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Agora veja uma outa situacao:</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>

<span class='co'># Funcao 'var' que criamos, que nao calcula variancia de dados</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='st'>"Nada"</span><span class='op'>)</span>

<span class='co'># Funcao que depende de 'var' do pacote stats, e calcula a variancia </span>
<span class='va'>aux2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>vari</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>vari</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># O resultado mostra, que a funcao aux como esta no ambiente global, ela não </span>
<span class='co'># tem um namespace porque nao esta em pacote algum. No caminho de busca, </span>
<span class='co'># o ambiente do pacote 'stats' estara na posicao 3, isso significa </span>
<span class='co'># que a funcao aux ao buscar por 'var', encontrarar primeiro no </span>
<span class='co'># ambiente global, que nao seria o objeto desejado.</span>
<span class='fu'>aux2</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Nada&quot;</code></pre>
</div>
<p>Antes de detalharmos a ideia do ambiente de <em>namespace</em>, precisamos entender uma estrutura do pacote que é um arquivo chamado <em>NAMESPACE</em>. Esse arquivo é responsável para definir quais os objetos de outros pacotes iremos importar, quais os objetos do pacote em desenvolvimento desejamos disponibilizar. Alguns outros objetos, principalmente funções, estão disponíveis apenas internamente, por decisão do desenvolvedor, muitas vezes por questão de futuras atualizações, ou outras finalidades. Desse modo, é o ambiente <em>namespace</em> que armazena todas as ligações dos objetos exportados, objetos importados ou objetos interno ao referido pacote. Assim, mostraremos que é por causa desse ambiente, que alguns outros objetos que não pertencem ao pacote e que podem estar no ambiente global, com o mesmo nome, e não entram em conflito. No código anterior, temos um exemplo típico para justificar essa situação. A função <code>var()</code> calcula a variância de um conjunto de dados, do qual a função <code>sd()</code>, que calcula o desvio padrão, depende da função <code>var()</code>. Ao passo que, também criamos uma função <code>var()</code> no ambiente global, que em nada tem a ver com o cálculo da variância. Assim, veremos que a função <code>sd()</code> acessará corretamente a função <code>var()</code> do pacote <code>stats</code>, o que não ocorrerá com a função <code>aux()</code>, uma vez que esta função tem como ambiente envolvente o ambiente global. A explicação para isso se deve ao fato que as funções desenvolvidos e importadas para um pacote, segue uma hierarquia de ambientes iniciada pelo ambiente <em>namespace</em>, que segue:</p>
<ol type="1">
<li>Ambiente <em>namespace</em> do referido pacote;</li>
<li>Ambiente de importações do referido pacote;</li>
<li>Ambiente <em>namespace</em> do pacote <code>base</code>;</li>
<li>Hierarquia de ambientes do caminho de busca.</li>
</ol>
<p>Desse modo, conseguimos entender o porquê a função <code>sd()</code> encontrar <code>var()</code> de forma correta, pela Figura <a href="#fig:amb-namespace">16</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span id="fig:amb-namespace"></span>
<img src="images/ambiente-namespace.png" alt="Mecanismo do ambiente *namespace* de um determinado pacote." width="60%" />
<p class="caption">
Figure 16: Mecanismo do ambiente <em>namespace</em> de um determinado pacote.
</p>
</div>
</div>
<p>Observemos que quando a função <code>sd()</code> é chamada, esta função não foi criada no ambiente global, mas no ambiente <code>namespace:stats</code>, cujas ligações também estão no ambiente <code>package:stats</code>. Assim, após o ambiente de execução dessa função ser criada temporariamente, todos os seus objetos se não encontrados nesse ambiente, partirão à procura no ambiente <em>namespace</em> do pacote. Desse modo, até chegar a busca pelo objeto no ambiente global, a função ainda procurará pelo ambiente <code>imports:stats</code>, se não encontrar segue para o ambiente <code>namespace:base</code>, e por fim entra no caminho de busca. Portanto, a função <code>var()</code> criada no ambiente global, para ter sido usada, em todos os ambientes anteriores não poderia ter existido esse objeto. Porém, como o desenvolvedor do pacote planeja todas as suas funções, certamente, isso nunca ocorrerá. Desse modo, o ambiente <a href="http://r-project.org/" target="_blank">R</a> evita que as funções desenvolvidas em um pacote tenham conflito com funções de outros pacotes.</p>
<h2 id="prog_funcional"><i class="fab fa-connectdevelop"></i> Programação funcional</h2>
<p>Enfim, chegamos propriamente dito ao segundo princípio do <a href="http://r-project.org/" target="_blank">R</a>, tudo nesse ambiente é uma chamada de função. Mas lembrando que uma função é também um objeto, com suas características (atribuições) assim como os vetores também apresentam.</p>
<p>Parece não ser evidente, mas já pensaram quantas chamadas de função ocorrem na linha de comando a seguir?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Apesar de intuitivo, mas o símbolo de atribuição (<code>&lt;-</code>) é uma função, <code>mean</code> é outra função, <code>:</code> também, bem como <code>(</code>. Por fim, quando digitamos o nome <code>x</code> para verificar o resultado no console, por trás existe a função <code>print</code> trabalhando para isso. Por isso, dizemos que tudo no <a href="http://r-project.org/" target="_blank">R</a> é uma chamada de função.</p>
<p>Tanto no <a href="nbasico.html">módulo básico</a> quanto nesse módulo, já discutimos algumas propriedades importantes das funções, como o seu escopo léxico e dinâmico, a característica do ambiente <a href="http://r-project.org/" target="_blank">R</a> ter funções de primeira classe, os ambientes envolvidos em uma função, função anônima, dentre outros assuntos.</p>
<p>Discutimos também que uma função do tipo <code>closure</code>, apresenta três estruturas: os argumentos (<code>formals()</code>), o corpo (<code>body()</code>) e o ambiente (<code>environment()</code>). Porém, as funções primitivas, do tipo <code>special</code> ou <code>buitin</code>, fogem a essa regra porque foram implementadas em linguagem de baixo nível, isto é, em linguagem <code>C</code>. Já mostramos também como identificar essas funções nas seções anteriores, e todas elas se encontram no pacote <code>base</code>.</p>
<p>Compreendemos também que uma função é chamada quando ditamos o seu nome e entre parênteses inserimos os seus argumentos. Podemos também por meio, da função <code>do.call()</code>, repassar os argumentos por meio de uma lista, que segue:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>argumentos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, main <span class='op'>=</span> <span class='st'>"Gráfico"</span>, 
                   xlab <span class='op'>=</span> <span class='st'>"Eixo X"</span>, ylab <span class='op'>=</span> <span class='st'>"Eixo Y"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='va'>plot</span>, <span class='va'>argumentos</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="nintermediario_files/figure-html5/unnamed-chunk-109-1.png" width="624" /></p>
</div>
<h2 id="comp_funcoes">Composição de funções</h2>
<p>No <a href="nbasico.html">módulo básico</a>, também vimos a composição de funções, construídas em blocos, aninhadas, resultados intermediários como objetos. Mas, surge uma quarta via, implementada pelo pacote <a href="https://magrittr.tidyverse.org/">magrittr</a>, que é o operador <em>pipe</em>. Essa ideia, segundo <span class="citation" data-cites="hadley2019"><a href="#ref-hadley2019" role="doc-biblioref">Wickham</a> (<a href="#ref-hadley2019" role="doc-biblioref">2019</a>)</span>, foi inspirada nas linguagens <code>Haskell</code>, <code>F#</code>, <code>Julia</code>, <code>JavScript</code>, um estilo baseado em pilhas como <em>forth</em> e <em>Fator</em>. Esse estilo apresenta uma estrutura mais fácil de sequências de operações da esquerda para direitra, evita funções aninhadas ou definição de funções. Para a análise de dados esse operador no ambiente <a href="http://r-project.org/" target="_blank">R</a> ganhou tanto respaldo, que foi implementado uma forma nativa na versão R 4.1. O operador <em>pipe</em> é binário, em que o primeiro operando (<code>lhs</code>) representa o valor do primeiro argumento do segundo operando (<code>rhs</code>), que representa uma função, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>lhs <span class="sc">%&gt;%</span> rhs <span class="co"># Pipe do pacote &#39;magrittr&#39;</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>lhs <span class="sc">|</span><span class="er">&gt;</span> rhs  <span class="co"># Pipe nativo do pacote &#39;base&#39;</span></span></code></pre></div>
</div>
<p>Uma tabulação básica para compreensão pode ser apresentada na Tabela</p>
<table>
<caption><span id="tab:pipe">Table 4: </span> Tabulação básica para o operador <em>pipe</em>.</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Sintaxe</th>
<th style="text-align: center;">Equivalência</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>x %&gt;% f</code> ou <code>x |&gt; f</code></td>
<td style="text-align: center;"><code>f(x)</code></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>x %&gt;% f(y)</code> ou <code>x |&gt; f(y)</code></td>
<td style="text-align: center;"><code>f(x, y)</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>x %&gt;% f %&gt;% g %&gt;% h</code> ou <code>x |&gt; f |&gt; g |&gt; h</code></td>
<td style="text-align: center;"><code>h(g(f(x)))</code></td>
</tr>
</tbody>
</table>
<p>Desse modo, podemos pensar em uma sequencia de comandos mais simples, até algo mais complexo. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='op'>)</span>  
</code></pre>
</div>
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>4</span><span class='op'>)</span> |&gt; <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 11</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>4</span><span class='op'>)</span> |&gt; <span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>~</span> <span class='va'>disp</span>, data <span class='op'>=</span> <span class='va'>d</span><span class='op'>)</span><span class='op'>)</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
lm(formula = mpg ~ disp, data = d)

Coefficients:
(Intercept)         disp  
    40.8720      -0.1351  </code></pre>
</div>
<!-- ## Funções primitivas -->
<!-- Usar a referencia "Software for data analysis - programming with R", 2008 - @chambers2008 -->
<!-- Algumas funções no `R` (objetos `R`) não apresentam a estrutura básica convencional de uma função no ambiente, como argumento, corpo da função e ambiente. Isto porque, essas funções foram implementadas principalemente em linguagem `C`, não em linguagem `R`, que chamamos de funções primitivas. Essas funções são encontradas apenas no pacote `base`, e sua grande vantagem é o seu desempenho, devido a sua implementação ter sido desenvolvida em linguagem de baixo nível. -->
<!-- Caso imprima uma dessas funções para visualizar a estrutura interna do código, será recebido no console, apenas a chamada de função `.Primitive`. Vejamos um exemplo, -->
<!-- ```{r echo=TRUE, include=TRUE} -->
<!-- # Operador unário "soma" (Funcao primitiva: tipo "builtin") -->
<!-- `+` -->
<!-- ``` -->
<!-- Desse modo, por meio da implementação realizada por Chambers(p.463-465; p.477-479(PDF)), vamos criar uma rotina para ser possível verificar quais as funções primitivas do pacote `base`, -->
<!-- As diferenças entre as funções `buitin` e `special` são ... p.465 (PDF, p.479) -->
<!-- Funções -->
<!-- Os objetos de modo `function`, isto é, uma função, são objetos de primeira classe porque se comportam como qualquer outra estrutura de dados na linguagem [R](http://r-project.org/){target='_blank'}, como atribuir nomes associados a esses objetos, passá-los como argumentos para outras funções, inserir dentro de funções, e até mesmo retorná-lo como resultado de funções. Vejamos, -->
<!-- apresentar formas de se criar operadores binários especiais -->
<!-- - Olhar escopo de variaveis seção 3.5: -->
<!-- https://cran.r-project.org/doc/manuals/R-lang.html#Global-environment -->
<!-- https://cran.r-project.org/doc/manuals/R-lang.html#Function-objects -->
<!-- Falar sobre controle de fluxos usando paralelização -->
<!-- - iterators -->
<!-- - foreach -->
<!-- - MonteCarlo -->
<!-- Ref: R in a nutshel, -->
<!-- ### Evitando loops -->
<!-- ### Funções recursivas -->
<h2 id="op_un-binarios">Operadores binários ou unários</h2>
<p>Na seção <a href="nbasico.html#manipulando-vetores">Manipulando vetores</a> (Módulo básico), falamos sobre alguns operadores: matemáticos, lógicos, booleanos. Todos estes são operadores binários ou unários, que na mais são do que funções. Dizemos que um operador é unário quando há apenas a exigência de um operando na operação. Quando há a existência de dois operandos, dizemos que o operador é binário. Por exemplo, o operador soma <code>+</code> pode ser unário ou binário, pois sintaticamente, podemos escrever a operação soma com um operando ou com dois operandos. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Como operador unario</span>
<span class='op'>+</span><span class='fl'>2</span> <span class='co'># operador operando1</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Como operador binario</span>
<span class='fl'>2</span> <span class='op'>+</span> <span class='fl'>5</span> <span class='co'># operando1 operador operando2</span>
</code></pre>
</div>
<pre><code>[1] 7</code></pre>
</div>
<p>Isso significa dizer que o operador <em>pipe</em> é binário, em que o primeiro operando é um valor e o segundo operando é uma função. Alguns exemplos de operadores que também podem ser encontrados por <code>?Sintax</code>, <code>::</code>, <code>:::</code>, <code>$</code>, <code>@</code>, <code>[</code>, <code>[[</code>, <code>^</code>, <code>+</code>, <code>-</code>, <code>:</code>, <code>|&gt;</code>, <code>%%</code>, <code>%/%</code>, <code>%*%</code>, <code>%x%</code>, <code>%o%</code>, <code>%in%</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>=&gt;</code>, <code>==</code>, <code>!=</code>, <code>!</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>|</code>, <code>||</code>, <code>~</code>, <code>-&gt;</code>, <code>&lt;-</code>, <code>&lt;&lt;-</code>, <code>=</code>, <code>?</code>, detre outros. Algumas dessas operações tem prevalência sobre outras, como por exemplo, no caso dos operadores matemáticos.</p>
<p>Para sabermos o código interno de um operador, além do nome, escrevemos aspas invertidas envolta desse nome, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>[1] TRUE</code></pre>
<pre><code>function (x, table) 
match(x, table, nomatch = 0L) &gt; 0L
&lt;bytecode: 0x0000000006aff268&gt;
&lt;environment: namespace:base&gt;</code></pre>
</div>
<p>Uma outra forma de identificarmos se um operador é binário ou unário, é verificando os seus argumentos. Por exemplo, o operador <code>%in%</code> apresenta os argumentos <code>x</code> e <code>table</code>, então no mínimo esse operador é binário. Isso ocorre porque quando verificamos os argumentos do operador soma,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>`+`</span>
</code></pre>
</div>
<pre><code>function (e1, e2)  .Primitive(&quot;+&quot;)</code></pre>
</div>
<p>percebemos que há dois argumentos, <code>e1</code> e <code>e2</code>, mas este operador pode se comportar como operador unário, é como se <code>e1</code> fosse <code>NULL</code> por padrão. Uma outra forma sintática de chamarmos um operador pode ser apresentado a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>`+`</span><span class='op'>(</span>e1 <span class='op'>=</span> <span class='fl'>2</span>, e2 <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 7</code></pre>
</div>
<p>Isso é o mesmo de termos realizado a operação <code>2 + 5</code>. Operadores criados pelos usuários sempre terão o símbolo de porcentagem (<code>%</code>) envolta dos nomes. Os demais operadores que não apresentam essa forma sintática são criados apenas pelo <em>R Core Team</em>.</p>
<p>Para ilustrar a criação de um operador, vamos fazer o nosso próprio operador <em>pipe</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Nosso operador pipe '%&gt;&gt;%'</span>
<span class='va'>`%&gt;&gt;%`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>a</span>, <span class='va'>b</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>aux</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>substitute</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>exec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/call.html'>call</a></span><span class='op'>(</span><span class='va'>aux</span>, <span class='va'>a</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/eval.html'>eval</a></span><span class='op'>(</span><span class='va'>exec</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span> <span class='op'>%&gt;&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 5.5</code></pre>
</div>
<h2 id="promessas">Avaliação preguiçosa dos argumentos de uma função</h2>
<!-- https://www.r-bloggers.com/2018/07/about-lazy-evaluation/ -->
<!-- https://colinfay.me/tidyeval-1/ -->
<!-- http://colinfay.me/r-language-definition/objects.html#promise-objects -->
<p>Os argumentos em uma função são um tipo de objeto chamado <code>pairlist</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao f</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fl'>1</span>
<span class='co'># Tipo de objeto do argumento x</span>
<span class='fu'><a href='https://rdrr.io/r/base/typeof.html'>typeof</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/formals.html'>formals</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;pairlist&quot;</code></pre>
</div>
<p>esse tipo de objeto é avaliado de forma “preguiçosa,” isto é, lentamente. Isso significa dizer computacionalmente, que enquanto esse argumento não for utilizado internamente na função, ele é tipo como uma promessa e não é avaliado. Vejamos um exemplo para entendermos melhor essa afirmação.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span> <span class='op'>=</span> <span class='fu'>aux</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='fl'>10</span>; <span class='fu'>f2</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 10</code></pre>
</div>
<p>A chamada <code>f2()</code> retorna o valor <code>10</code> sem erros, porque mesmo no argumento <code>x</code> recebendo uma função <code>aux()</code> que não existe, como internamente esse argumento não foi usado, <code>x</code> é apenas uma promessa. No ambiente <a href="http://r-project.org/" target="_blank">R</a>, não podemos manipular esse tipo de objeto, pois se assim fosse possível, o objeto deixaria de ser uma promessa.</p>
<p>Por causa desse tipo de estrutura, que podemos ter outros argumentos padrão como função de outros argumentos ou até como função de outros objetos criados internamente a função. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>f3</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>a</span> <span class='op'>=</span> <span class='fl'>4</span>, <span class='va'>b</span> <span class='op'>=</span> <span class='va'>a</span> <span class='op'>+</span> <span class='fl'>2</span>, <span class='va'>c</span> <span class='op'>=</span> <span class='va'>x</span> <span class='op'>*</span> <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
  <span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>a <span class='op'>=</span> <span class='va'>a</span>, <span class='co'># 4</span>
       b <span class='op'>=</span> <span class='va'>b</span>, <span class='co'># a + 2</span>
       c <span class='op'>=</span> <span class='va'>c</span><span class='op'>)</span> <span class='co'># x * y</span>
<span class='op'>}</span>
<span class='fu'>f3</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$a
[1] 4

$b
[1] 6

$c
[1] 1000</code></pre>
</div>
<p>Nesse momento cabe enfatizarmos a diferença entre <code>&lt;-</code> e <code>=</code>. Primeiro, devemos entender que qualquer um dos dois associam nomes a objetos, porém a primeira diferença existente entre os dois, é que o primeiro tem precedência superior. Vejamos o seguinte código:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>x</span> <span class='op'>=</span> <span class='fl'>4</span>
</code></pre>
</div>
<pre><code>Error in y &lt;- x = 4: não foi possível encontrar a função &quot;&lt;-&lt;-&quot;</code></pre>
</div>
<p>Por que esse exemplo gera um erro? Porque primeiro é executado <code>y &lt;- x</code> (precedência superior de <code>&lt;-</code> sobre <code>=</code>), em que <code>x</code> não é encontrado, e retorna um erro.</p>
<p>Um outro ponto é que sintaticamente usamos o operador <code>=</code> para atribuir valores a argumentos de uma função, e <code>&lt;-</code> para atribuir nomes a objetos, e este último deve ser a sintaxe recomendada para a atribuição de nomes a objetos.</p>
<p>Parece que semanticamente a atribuição de argumentos a valores são iguais, mas podemos ver que a seguir, apesar de sintaticamente as linhas de comando aparentemente idêntica, apresentam comportamentos e resultados diferentes</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao teste</span>
<span class='va'>teste</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>obj_ae</span> <span class='op'>&lt;-</span> <span class='st'>"Objeto_interno"</span>
  <span class='va'>x</span>
<span class='op'>}</span>
<span class='co'># ls() avaliado dentro de teste():</span>
<span class='fu'>teste</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;obj_ae&quot; &quot;x&quot;     </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># ls() avaliado no ambiente de chamada:</span>
<span class='fu'>teste</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;cran&quot;    &quot;github&quot;  &quot;rlink&quot;   &quot;rstudio&quot; &quot;teste&quot;  </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>teste2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>obj_teste2_1</span> <span class='op'>&lt;-</span> <span class='st'>"primeiro"</span>
  <span class='va'>obj_teste2_2</span> <span class='op'>&lt;-</span> <span class='st'>"segundo"</span>
  <span class='va'>obj_teste2_3</span> <span class='op'>&lt;-</span> <span class='st'>"terceiro"</span>
  <span class='fu'>teste</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>teste2</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;obj_teste2_1&quot; &quot;obj_teste2_2&quot; &quot;obj_teste2_3&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto x avaliado no ambiente global</span>
<span class='fu'>teste</span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;cran&quot;    &quot;github&quot;  &quot;rlink&quot;   &quot;rstudio&quot; &quot;teste&quot;   &quot;teste2&quot; </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>teste</span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;cran&quot;    &quot;github&quot;  &quot;rlink&quot;   &quot;rstudio&quot; &quot;teste&quot;   &quot;teste2&quot; 
[7] &quot;x&quot;      </code></pre>
</div>
<p>Na primeira situação temos a criação da função <code>teste</code> com um argumento padrão <code>x = ls()</code>. Nesse caso, <code>ls()</code> será avaliado no ambiente de execução da função, do qual pode ser confirmado com a chamada <code>teste()</code>. O segundo caso, a chamada <code>teste(ls())</code> apresenta um resultado diferente, porque <code>ls()</code>, nesse caso, foi avaliado no ambiente de chamada, que pode também ser verificado na chamada <code>teste2()</code>. Por fim, a chamada <code>teste((x &lt;- ls()))</code> apresenta um resultado diferente com relação ao caso anterior, pois <code>x &lt;- ls()</code> é avaliado no ambiente global, nesse caso, e não como um promessa tal como <code>x = ls()</code> foi, sendo avaliado apenas internamente no ato de sua chamada.</p>
<p>Por fim, podemos verificar se um argumento teve como entrada padrão, ou inserida pelo usuário, usando <code>missing()</code>. Vejamos o código, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>teste</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>arg</span> <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"argumento padrão?"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/missing.html'>missing</a></span><span class='op'>(</span><span class='va'>arg</span><span class='op'>)</span>, valor <span class='op'>=</span> <span class='va'>arg</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Teste 1</span>
<span class='fu'>teste</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$`argumento padrão?`
[1] TRUE

$valor
[1] 5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Teste 2</span>
<span class='fu'>teste</span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$`argumento padrão?`
[1] FALSE

$valor
[1] 4</code></pre>
</div>
<h2 id="saida_funcoes">Saídas implícitas, explícitas, invisíveis de funções</h2>
<p>No <a href="nbasico.html#criar-funcoes">módulo Básico</a>, mostramos a estrutura básica de como criar uma função, cujo corpo é delimitado por chaves, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nova_funcao</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># Corpo da funcao</span>
  <span class='va'>x</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Nesse caso, como a última linha de comando no corpo da função <code>nova_funcao()</code> a ser avaliada é <code>x</code>, então será esta o resultado da saída da função. Observamos que nesse caso, a última linha de comando imprime o valor de <code>x</code>. Dizemos nesse caso, que a função teve uma <strong>saída implícita</strong>. Se ao invés, a última linha de comando fosse a associação de um nome ao objeto, nada seria retornado após a chamada de função. Vejamos o próximo exemplo para o entendimento.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao com saida implicita</span>
<span class='va'>nova_funcao</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># Corpo da funcao</span>
  <span class='va'>x</span>
<span class='op'>}</span>
<span class='fu'>nova_funcao</span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao com saida implicita sem resultado</span>
<span class='va'>nova_funcao2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># Corpo da funcao</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>x</span>
<span class='op'>}</span>
<span class='fu'>nova_funcao2</span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Essa última chamada, acaba não aparecendo nada porque a avaliação <code>x &lt;- x</code>, associa o nome <code>x</code> ao valor do argumento <code>x</code>, e isto não implica em imprimir esse valor. Contudo, podemos não necessariamente, apresentar como resultado de uma função, a sua última linha de comando. Nesse caso, usamos a função <code>return()</code>, para identificar qual objeto desejamos como saída para uma determinada função. Nesse caso, temos uma saída explícita.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>num_par_ou_impar</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>is.numeric</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"o argumento x deve ser numerico"</span>, call. <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
  <span class='va'>num</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>num</span> <span class='op'>%%</span> <span class='fl'>2</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='st'>"Número par!"</span><span class='op'>)</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='st'>"Número ímpar!"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Numero real eh coagido a inteiro sem arredondamento</span>
<span class='fu'>num_par_ou_impar</span><span class='op'>(</span><span class='fl'>1.6</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Número ímpar!&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Programacao defensiva (x deve ser numerico)</span>
<span class='fu'>num_par_ou_impar</span><span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Error: o argumento x deve ser numerico</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verificando se um numero eh par ou impar</span>
<span class='fu'>num_par_ou_impar</span><span class='op'>(</span><span class='fl'>6</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Número par!&quot;</code></pre>
</div>
<p>Percebemos que todas essas saídas implícita e explícita são <strong>saídas visíveis</strong> após a chamada da função. Porém, podemos ter saídas invisíveis, usando a função <code>invisible()</code>. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao com saida invisivel</span>
<span class='va'>estdes</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='va'>resumo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span><span class='op'>(</span><span class='va'>resumo</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'># Conjunto de dados</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span><span class='op'>(</span><span class='fl'>30</span><span class='op'>)</span>
<span class='co'># Chamando estdes</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>estdes</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>
<span class='co'># Imprimindo o resultado invisivel</span>
<span class='va'>res</span>
</code></pre>
</div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0224  0.2011  0.4991  0.9908  0.9524  7.8891 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Formas alternativas</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>estdes</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="nintermediario_files/figure-html5/unnamed-chunk-127-1.png" width="624" /></p>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0224  0.2011  0.4991  0.9908  0.9524  7.8891 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='fu'>estdes</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0224  0.2011  0.4991  0.9908  0.9524  7.8891 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Sinalizador de visibilidade</span>
<span class='fu'><a href='https://rdrr.io/r/base/withVisible.html'>withVisible</a></span><span class='op'>(</span><span class='fu'>estdes</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$value
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0224  0.2011  0.4991  0.9908  0.9524  7.8891 

$visible
[1] FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/withVisible.html'>withVisible</a></span><span class='op'>(</span><span class='fu'>estdes</span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>List of 2
 $ value  : &#39;summaryDefault&#39; Named num [1:6] 0.0224 0.2011 0.4991 0.9908 0.9524 ...
  ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;Min.&quot; &quot;1st Qu.&quot; &quot;Median&quot; &quot;Mean&quot; ...
 $ visible: logi FALSE</code></pre>
</div>
<p>Um caso específico de função com resultado invisível é a atribuição (<code>&lt;-</code>). Quando associamos um nome a um objeto, a saída dessa função é invisível, a menos que redigite o nome no console ou use entre parênteses essa linha de comando, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao `&lt;-`() com saida invisivel</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>
<span class='co'># Acessando o valor do obj associado com o nome 'x'</span>
<span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1] 10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Outra forma de acesso</span>
<span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 10</code></pre>
</div>
<h2 id="funcoes_substituicao">Funções de substituição</h2>
<!-- https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Subset-assignment -->
<p>Muito provavelmente, ao importar um banco de dados, armazenados em um objeto de classe <em>data.frame</em>, tivemos algum problema de erro em algum valor em nossas variáveis em estudo. Por exemplo, consideremos um banco de dados com informações de um grupo de pessoas, tais como o nome, altura (cm), peso (kg), idade (anos), que segue:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dados</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
  nome <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Paulo"</span>, <span class='st'>"Maria"</span>, <span class='st'>"Caio"</span><span class='op'>)</span>,
  altura <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>175</span>, <span class='fl'>167</span>, <span class='fl'>172</span><span class='op'>)</span>,
  peso <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>70</span>, <span class='fl'>65</span>, <span class='fl'>7500</span><span class='op'>)</span>,
  idade <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>32</span>, <span class='fl'>26</span>, <span class='fl'>19</span><span class='op'>)</span>
<span class='op'>)</span>; <span class='va'>dados</span>
</code></pre>
</div>
<pre><code>   nome altura peso idade
1 Paulo    175   70    32
2 Maria    167   65    26
3  Caio    172 7500    19</code></pre>
</div>
<p>Se esse banco foi importado, podemos alterar no próprio banco. Caso contrário, pode ser realizado uma substituição do valor no próprio ambiente <a href="http://r-project.org/" target="_blank">R</a> para o objeto específico, usando <code>[</code>, ou similares, dependendo do tipo de objeto. Para esse caso, percebemos que o peso de Caio (7500kg), muito provavelmente foi um erro de digitação, e e que na realidade seria 75kg como correção. Para fazermos essa alteração em <code>dados</code>, uma das possibilidades seria usar a função de substituição <code>dados[3, 3] &lt;- 75</code>, em que a mudança ocorre na terceira linha e 3 coluna do <em>data.frame</em>. Como poderíamos criar uma função de substituição? Usando as mesmas ideias usadas nesse caso. A função de substituição para um caso geral, é dado da seguinte forma sintática:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>`[&lt;-`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span>, <span class='va'>value</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'># Corpo da funcao</span>
<span class='op'>}</span>
<span class='co'># Chamada de funcao</span>
<span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>value</span>
<span class='co'># Chamada de forma equivalente</span>
<span class='fu'>`[&lt;-`</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span>, <span class='va'>value</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Claro que isso não é um padrão, mas uma ideia geral para a chamada <code>[&lt;-</code>, que basicamente deve ter dois argumentos, <code>x</code> e <code>value</code>. O primeiro é o objeto em que há a necessidade de substituição de um de seus valores, e o segundo representa o valor para a substituição. Argumentos adicionais a estes, devem ser colocados entre esses argumentos, e à esquerda do argumento <code>value</code>, que foi o caso do argumento <code>i</code>, que representa a posição do elemento a ser substituído no objeto <code>x</code>. Por outro lado, devemos evitar a substituição de funções internas, como no caso da função <code>(&lt;-</code>, por exemplo, uma vez que funções como essas usadas a todo momento em um código, pode trazer conflitos entre essas funções.</p>
<p>Vamos aprofundar um pouco mais essa questão, usando um exemplo mais simples para a compreensão, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vamos criar um vetor de comprimento 10</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Usando a funcao de substituicao, para alterar</span>
<span class='co'># dois valores na posicao 6 e 10</span>
<span class='va'>x</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>200</span><span class='op'>)</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code> [1]   1   2   3   4   5 100   7   8   9 200</code></pre>
</div>
<p>O que ocorre por trás, cuja referência pode ser confirmada no manual <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Subset-assignment">R Language Definition, seção 3.4.4</a>, é que surge a criação de um nome temporário <code>`*tmp*`</code> que também se associa ao mesmo objeto associado ao nome <code>x</code>, cujas alterações são realizadas em <code>`*tmp*`</code>, e um novo objeto é criado e um novo nome se associa a ele, e para deixar a impressão de que a alteração é ocorrida no próprio objeto, esse novo nome é exatamente <code>x</code>, igual ao nome antigo.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Objeto x criado</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>
<span class='co'># `*tmp*` temporariamente criado</span>
<span class='va'>`*tmp*`</span> <span class='op'>&lt;-</span> <span class='va'>x</span>
<span class='co'># Alteracoes realizadas</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>`[&lt;-`</span><span class='op'>(</span><span class='va'>`*tmp*`</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>10</span><span class='op'>)</span>, valor <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code> [1]   1   2   3   4   5 100   7   8   9 200</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Ao final se remove `*tmp*`</span>
<span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span><span class='va'>`*tmp*`</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Por fim, <code>`*tmp*`</code> é removido, e nesse caso, ocorre a cópia do objeto, como pode ser verificado por meio chamada <code>tracemen()</code>, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vamos criar um vetor de comprimento 10</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>; <span class='va'>x</span>
<span class='co'>## [1]  1  2  3  4  5  6  7  8  9 10</span>

<span class='co'># Inspecionando o objeto</span>
<span class='fu'><a href='https://rdrr.io/r/base/tracemem.html'>tracemem</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
<span class='co'>## [1] "&lt;000000965C8A97D8"</span>

<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000965c8a97d8 13 INTSXP g0c0 [REF(65535),TR]  1 : 10 (compact)</span>

<span class='co'># Usando a funcao de substituicao, para alterar</span>
<span class='co'># dois valores na posicao 6 e 10</span>
<span class='va'>x</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>200</span><span class='op'>)</span>; <span class='va'>x</span>
<span class='co'>## tracemem[0x000000965c8a97d8 - 0x000000965bdf6bc0]: </span>
<span class='co'>## tracemem[0x000000965bdf6bc0 - 0x000000965f177418]: </span>
<span class='co'>## [1]   1   2   3   4   5 100   7   8   9 200</span>

<span class='co'># Inspecionando novamente o objeto</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>inspect</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## @0x000000965f177418 14 REALSXP g0c5 [REF(5),TR] (len=10, tl=0) 1,2,3,4,5,...</span>
</code></pre>
</div>
</div>
<p>Observamos inicialmente <code>x</code> (id <code>0x000000965c8a97d8</code>), cujo nome <code>`*tmp*`</code> inicialmente se liga ao mesmo objeto, e após as substituições <code>`*tmp*`</code> passa a está alocado a um novo espaço de memória (id <code>0x000000965f177418</code>), isto é ocorre uma cópia. A cópia intermediária (id <code>0x000000965bdf6bc0</code>) que ocorre no processo é devido a chamada <code>`<code>:</code>`()</code>. Mas a pergunta que fica, como fica o entendimento da otimização de desempenho especial a <strong>modificação no local</strong>? Bem, o nosso entendimento para o caso de vetores, como já mostrado anteriormente, a ideia estará sempre na contagem de referência. Já vimos, que para a chamada <code>`:`()</code>, a primeira modificação realizada no objeto será modificação em cópia, pois <code>REF(# &gt; 1)</code>. Nesse caso, que foi o exemplo mostrado anteriormente, existe a presença de <code>`*tmp*`</code> por trás dos bastidores. Entretanto, quando o vetor é desenvolvido pela chamada <code>c()</code>, sabemos que a alteração do objeto ocorre em modificação no local, quando não alteraramos a dimensão do vetor, mas apenas os valores. Bem, o que indagamos é a existência ou não do nome temporário <code>`*tmp*`</code> no processo. Como falamos na seção em sobre <a href="nintermediario.html#copia_modif_tam_objetos">cópia de objetos</a>, afirmamos que um dos pré-requisitos para a modificação no local, é que o objeto só pode ter uma ligação, isto é, um nome associado ao objeto. E quando mostramos a forma sintática da função de substituição <code>`[&lt;- `()</code>, percebemos que <code>x</code> e <code>`*tmp*`</code> se ligam ao mesmo objeto inicialmente, e assim, teoricamente deveria sempre haver cópia com a alteração de algum dos valores desse objeto. Desse modo, pressupomos que para esses casos de modificação no local, o processo seja um pouco diferente desse processo. Contudo, isso só ocorrerá para o caso da função de substituição primitiva (<code>[&lt;-</code>), implementada em linguagem <code>C</code>. Quando desenvolvemos nossas próprias funções de substituição, aí sempre ocorrerá cópia na modificação.</p>
<!-- Duvida: -->
<!-- o resultado: -->
<!--   - x <- 1:10 -->
<!--   - x <- c(1, 2, 3, ..., 10) -->
<!-- com relação a variavel temporaria `*tmp*` ainda me gerou duvidas. Enviado essa duvida ao R-help recebi a seguinte resposta de murdoch.duncan@gmail.com: -->
<!-- On 07/10/2021 6:46 p.m., Ben Deivide de Oliveira Batista wrote: -->
<!-- > Dear R users, -->
<!-- >  -->
<!-- > When modify-in-place of objects occurs, is there a local variable called -->
<!-- > `*tmp*`, behind the scenes R? Let's look at two examples to understand the -->
<!-- > question. -->
<!-- >  -->
<!-- > Example 1 (R Language Definition) -->
<!-- > -------------------------------------------------- -->
<!-- >  -->
<!-- >> x <- 1:10 -->
<!-- >> tracemem(x) -->
<!-- > [1] "<000000000798F758>" -->
<!-- >> x[3:5] <- 13:15 -->
<!-- > tracemem[0x000000000798f758 -> 0x0000000008207030]: -->
<!-- >  -->
<!-- > The result of this command is as if the following had been executed -->
<!-- > `*tmp*` <- x -->
<!-- > x <- "[<-"(`*tmp*`, 3:5, value=13:15) -->
<!-- > rm(`*tmp*`) -->
<!-- >  -->
<!-- > Conclusion: Here copy-on-modify occurs! -->
<!-- >  -->
<!-- >  -->
<!-- > Example 2 : Modify-in-place -->
<!-- > ----------------------- -->
<!-- >  -->
<!-- >> x <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) -->
<!-- >> tracemem(x) -->
<!-- > [1] "<0000000008BFB818>" -->
<!-- >> x[3:5] <- 13:15Conclusion: Here modify-in-place occurs! -->
<!-- > For example 2, is there a local variable `*tmp*` for this case? If so, -->
<!-- > what would the syntactic representation look like, similar to example 1? -->
<!-- I think there is, and it would be the same as in 1.  The memory -->
<!-- operations are different because x is different:  in 1, it is stored in -->
<!-- a compact representation of 1:10, which needs to be expanded to a full -->
<!-- array of doubles before the entries can be changed.  In 2, it is already -->
<!-- stored as an array of doubles so this isn't needed. -->
<!-- Essa resposta ainda nao ficou claro para mim! -->
<p>Para desenvolvermos as nossas próprias funções de substituição apresentamos um exemplo, criando a função <code>`substextr&lt;-`()</code>, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao de substituicao de alterar os extremos</span>
<span class='va'>`substextr&lt;-`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>value</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>
  <span class='va'>x</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>value</span>
  <span class='va'>x</span>
<span class='op'>}</span>
<span class='co'># Criando o vetor</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;pointer: 0x0000000044efd390&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Alterando o vetor</span>
<span class='fu'>substextr</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;pointer: 0x0000000044efc890&gt;</code></pre>
</div>
<p>Nesse caso, obrigatoriamente os dois argumentos básicos e com esses nomes são <code>x</code> e <code>value</code>, sendo que <code>value</code> deve ser sempre o último argumento. Caso, seja necessário adicionar mais argumentos, estes devem ser inseridos entre esses dois argumentos, como apresentado no código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>`subst&lt;-`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>i</span>, <span class='va'>value</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>value</span>
  <span class='va'>x</span>
<span class='op'>}</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1 2 3</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;pointer: 0x000000002d21aeb0&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># subst(x, i) &lt;- value</span>
<span class='fu'>subst</span><span class='op'>(</span><span class='va'>x</span>, <span class='fl'>2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>; <span class='va'>x</span>
</code></pre>
</div>
<pre><code>[1]   1 100   3</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Inspecao</span>
<span class='fu'><a href='https://rdrr.io/r/base/Internal.html'>.Internal</a></span><span class='op'>(</span><span class='fu'>address</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&lt;pointer: 0x000000002d221570&gt;</code></pre>
</div>
<h2 id="vetorização-de-funções">Vetorização de funções</h2>
<p>A vetorização de funções surge quando inserimos argumentos vetorizados, cuja saída dessas funções também são vetorizadas, de modo que não precisamos de <em>loop</em> para que a função retorne um valor de cada elemento do vetor de algum dos argumentos. Pensemos no operador soma (<code>+</code>), no seguinte código:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetorização da soma de vetores</span>
<span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span> <span class='op'>+</span> <span class='fl'>10</span><span class='op'>:</span><span class='fl'>13</span>
</code></pre>
</div>
<pre><code>[1] 11 13 15 17</code></pre>
</div>
<p>Essa função é vetorizada porque ela realizou, porque ela realizou a soma entre dois elementos de mesma posição nos vetores, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="dv">4</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span>  <span class="sc">+</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">13</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="sc">------------</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> <span class="dv">13</span> <span class="dv">15</span> <span class="dv">17</span></span></code></pre></div>
</div>
<p>Isso é como se tivéssemos realizado um <em>loop</em> para essa operação, da seguinte forma:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fl'>10</span><span class='op'>:</span><span class='fl'>13</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>y</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
<pre><code>[1] 11
[1] 13
[1] 15
[1] 17</code></pre>
</div>
<p>Grande maioria das funções nativas do <a href="http://r-project.org/" target="_blank">R</a>, isto é, das funções desenvolvidas nos pacotes nativos são vetorizados. Vejamos alguns exemplos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Funcao logaritmica</span>
<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.0000000 0.6931472 1.0986123 1.3862944</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Multiplicacao</span>
<span class='fl'>10</span><span class='op'>:</span><span class='fl'>20</span> <span class='op'>*</span> <span class='fl'>5</span>
</code></pre>
</div>
<pre><code> [1]  50  55  60  65  70  75  80  85  90  95 100</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Operadores logicos</span>
<span class='fl'>1</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>
</code></pre>
</div>
<pre><code>[1]  TRUE FALSE FALSE FALSE</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Gerador de numeros aleatorios [0, 1]</span>
<span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 0.50747820 0.30676851 0.42690767 0.69310208 0.08513597 0.22543662
 [7] 0.27453052 0.27230507 0.61582931 0.42967153</code></pre>
</div>
<p>Existem diversos caminhos para se desenvolver uma função vetorizada. Caso as funções internas da função desenvolvida seja vetorizada, esta também será. Vejamos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>`%soma%`</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>e1</span>, <span class='va'>e2</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>e1</span> <span class='op'>+</span> <span class='va'>e2</span>
<span class='op'>}</span>
<span class='co'># Exemplo 1</span>
<span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span> <span class='op'>%soma%</span> <span class='fl'>10</span><span class='op'>:</span><span class='fl'>13</span>
</code></pre>
</div>
<pre><code>[1] 11 13 15 17</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Exemplo 2</span>
<span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span> <span class='op'>%soma%</span> <span class='fl'>5</span>
</code></pre>
</div>
<pre><code>[1] 6 7 8 9</code></pre>
</div>
<p>Quando temos funções escalares, podemos em uma das possibilidades, utilizar a função <code>Vectorize()</code> para vetorizar a função desejada. Essa função tem três argumentos importantes, <code>FUN</code> que representa a função a ser vetorizada <code>vectorize.args</code> que representa os argumentos da função vetorizado, que devem entrar como vetores caracteres nesse argumento, e <code>SIMPLIFY</code> que é um argumento lógico, cujo valor <code>TRUE</code> representa uma saída em forma de matriz, dependendo da situação, e <code>FALSE</code> representa a saída em forma de lista. Argumentos padrão não são vetorizados.</p>
<p>Vamos usar como exemplo, a função que gera números aleatórios de uma distribuição normal, <code>rnorm(n, mean, sd, log)</code>. Vamos trabalhar apenas com os três primeiros argumentos, em que <code>n</code> representa o tamanho da amostra, <code>mean</code> o parâmetro média e <code>sd</code> o parâmetro desvio padrão. Vamos fixar <code>n = 10</code> e <code>sd = 1</code>, e variar <code>mean = 1:3</code>. Isto significa que iremos ter valores baseados em uma distribuição normal, tal que os valores <span class="math inline">\(X_i\)</span>, para <span class="math inline">\(i = 1, 2, \ldots, 10\)</span>, serão gerados de distribuições, tal que <span class="math inline">\(X_i \sim N(\mu_j)\)</span>, sequencialmente para <span class="math inline">\(\mu_1 = 1\)</span>, <span class="math inline">\(\mu_2 = 2\)</span> e <span class="math inline">\(\mu_3\)</span>, respectivamente. Assim, teremos uma amostra de tamanho 10, da seguinte forma: <span class="math inline">\(X_1\sim N(1,1)\)</span>, <span class="math inline">\(X_2\sim N(2,1)\)</span>, <span class="math inline">\(X_3\sim N(3,1)\)</span>, <span class="math inline">\(X_4\sim N(1,1)\)</span>, <span class="math inline">\(X_5\sim N(2,1)\)</span>, <span class="math inline">\(X_6\sim N(3,1)\)</span>, <span class="math inline">\(X_7\sim N(1,1)\)</span>, <span class="math inline">\(X_8\sim N(2,1)\)</span>, <span class="math inline">\(X_9\sim N(3,1)\)</span>, <span class="math inline">\(X_{10}\sim N(1,1)\)</span>. Vejamos o código a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Semente</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='co'># Gerando a amostra</span>
<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  1.0187462  1.8157475  1.6286695  0.4008323  2.2945451  3.3897943
 [7] -0.2080762  1.6363240  1.3733273  0.7435216</code></pre>
</div>
<p>Vamos supor agora, que a ideia de vetorização para essa função, seja que quando assumimos <code>mean = 1:3</code>, ao invés de termos uma amostra como a anterior, teremos três amostras baseadas no comprimento do vetor em <code>mean</code>. Fixado os demais argumentos, teremos uma amostra de uma normal para <span class="math inline">\(\mu_1 = 1\)</span>, <span class="math inline">\(\mu_2 = 2\)</span> e <span class="math inline">\(\mu_3 = 3\)</span>, isto é,</p>
<p><span class="math display">\[
\left\{\begin{array}{ll}
X_1, X_2, \ldots, X_{10}, &amp; X_i \sim N(1,1), \\
Y_1, Y_2, \ldots, Y_{10}, &amp; Y_i \sim N(2,1), \\
Z_1, Z_2, \ldots, Z_{10}, &amp; Z_i \sim N(3,1).
\end{array}\right.
\]</span> Para isso, iremos usar <code>Vectorize()</code> para <code>rnorm()</code>, vetorizando o argumento <code>mean</code>. Vejamos o código a seguir, para essa implementação.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Apos a vetorizacao, observe a diferenca entre</span>
<span class='co'># 'rnorm_vet1' e 'rnorm_vet2', devido ao argumento </span>
<span class='co'># 'SIMPLIFY'</span>
<span class='va'>rnorm_vet1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Vectorize.html'>Vectorize</a></span><span class='op'>(</span><span class='va'>rnorm</span>, <span class='st'>"mean"</span>, SIMPLIFY <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>rnorm_vet2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Vectorize.html'>Vectorize</a></span><span class='op'>(</span><span class='va'>rnorm</span>, <span class='st'>"mean"</span>, SIMPLIFY <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># Vetorizando</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span> <span class='co'># semente para fixar os mesmos valores</span>
<span class='fu'>rnorm_vet1</span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, mean <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
 [1]  1.0187462  0.8157475 -0.3713305  0.4008323  1.2945451  1.3897943
 [7] -0.2080762  0.6363240 -0.6266727  0.7435216

[[2]]
 [1] 3.101780 2.755782 1.761766 2.987445 2.741390 2.089347 1.045056
 [8] 1.804850 2.925521 2.482979

[[3]]
 [1] 2.4036894 0.8147132 2.3251341 0.8809388 1.7348020 2.6263384
 [7] 2.3124446 2.1278412 2.8982390 2.7462195</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span> <span class='co'># semente para fixar os mesmos valores</span>
<span class='fu'>rnorm_vet2</span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, mean <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>            [,1]     [,2]      [,3]
 [1,]  1.0187462 3.101780 2.4036894
 [2,]  0.8157475 2.755782 0.8147132
 [3,] -0.3713305 1.761766 2.3251341
 [4,]  0.4008323 2.987445 0.8809388
 [5,]  1.2945451 2.741390 1.7348020
 [6,]  1.3897943 2.089347 2.6263384
 [7,] -0.2080762 1.045056 2.3124446
 [8,]  0.6363240 1.804850 2.1278412
 [9,] -0.6266727 2.925521 2.8982390
[10,]  0.7435216 2.482979 2.7462195</code></pre>
</div>
<p>As únicas funções que não podem ser vetorizadas por <code>Vectorize()</code> são as funções primitivas que não tem um valor para <code>formals()</code>.</p>
<p>Uma outra forma de vetorizar funções, por exemplo, bem como evitar <em>loops</em> no desenvolvimento de algoritmos, é utilizar um conjunto de funções da família <em>apply</em> implentadas no pacote <code>base</code>, que será vista a seguir.</p>
<h2 id="funções-da-família-apply">Funções da família <em>apply</em></h2>
<p>Apesar de uma das construções mais interessantes na programação, seja o <em>loop</em>, é bom observar que essas construções implementadas em diversas linguagens apresenta grandes diferenças, em termos de desempenho. Já vimos que as funções para <em>loops</em> no <a href="http://r-project.org/" target="_blank">R</a> pode demandar um gasto computacional dependendo de sua implementação, cópias na modificação, por ser uma linguagem interpretada, dentre outras características. Alternativamente, podemos usar uma série de funções implementadas no ambiente <a href="http://r-project.org/" target="_blank">R</a>, funções estas vetorizadas. Vamos nos concentrar nas funções disponíveis na Base <a href="http://r-project.org/" target="_blank">R</a>.</p>
<p>Iniciamos com a família de funções <em>apply</em>, pertencente ao pacote <code>base</code>, de modo que permite manipularmos estruturas de dados como vetores, matrizes, <em>arrays</em>, listas e quadro de dados (<em>data frames</em>) de maneira repetitiva sem a utilização de <em>loop</em>. Estas funções são: <code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, <code>tapply()</code>, <code>mapply()</code>, <code>rapply()</code> e <code>eapply()</code></p>
<p>A primeira função a ser discutida é <code>apply()</code>, que retorna um <em>array</em> ou uma lista obtida pela aplicação de uma função nas linhas ou colunas da entrada de um objeto seja matriz ou <em>array</em>. Vejamos a sintaxe dessa função:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(X, MARGIN, FUN, ..., <span class="at">simplify =</span> <span class="cn">TRUE</span>),</span></code></pre></div>
</div>
<p>em que: - <code>X</code> argumento que recebe o objeto matriz ou <em>array</em>, - <code>MARGIN</code> argumento que recebe <code>1</code>, se a função em <code>FUN</code> deve ser aplicado na linha, ou recebe <code>2</code> se <code>FUN</code> deve ser aplicado nas colunas, - <code>FUN</code> argumento que recebe a função desejada, - <code>...</code> argumento que recebe argumentos adicionais para <code>FUN</code>, e - <code>simplify</code> argumento lógico para retorno de resultados simplificados (<code>TRUE</code>) ou não (<code>FALSE</code>).</p>
<p>Por exemplo, supomos que temos 5 amostras de tamanho 10, com reposição, em um conjunto de valores de 1 a 1000, e desejamos computar a média aritmética dessas amostras, que serão inseridas em colunas num objeto matriz, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 5 amostras</span>
<span class='op'>(</span><span class='va'>am1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>1000</span>, size <span class='op'>=</span> <span class='fl'>10</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  42 334  13 417 361 729 712 656 373  26</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>am2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>1000</span>, size <span class='op'>=</span> <span class='fl'>10</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 857 209  48 663 527 958 878 536 482 317</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>am3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>1000</span>, size <span class='op'>=</span> <span class='fl'>10</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 132 739 270 929  35 266  74 570 679 912</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>am4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>1000</span>, size <span class='op'>=</span> <span class='fl'>10</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1] 271 543 906 101 435 437 959 613 621 943</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>am5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>1000</span>, size <span class='op'>=</span> <span class='fl'>10</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># Amostras em colunas</span>
<span class='va'>amost_col</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>am1</span>, <span class='va'>am2</span>, <span class='va'>am3</span>, <span class='va'>am4</span>, <span class='va'>am5</span><span class='op'>)</span>, <span class='fl'>10</span>, <span class='fl'>5</span><span class='op'>)</span>; <span class='va'>amost_col</span>
</code></pre>
</div>
<pre><code>      [,1] [,2] [,3] [,4] [,5]
 [1,]   42  857  132  271   39
 [2,]  334  209  739  543  947
 [3,]   13   48  270  906  630
 [4,]  417  663  929  101   89
 [5,]  361  527   35  435  530
 [6,]  729  958  266  437  899
 [7,]  712  878   74  959  982
 [8,]  656  536  570  613  554
 [9,]  373  482  679  621  394
[10,]   26  317  912  943  254</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Calculando a media por coluna</span>
<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>amost_col</span>, MARGIN <span class='op'>=</span> <span class='fl'>2</span>, FUN <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 366.3 547.5 460.6 582.9 531.8</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Amostras em linhas</span>
<span class='va'>amost_lin</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>am1</span>, <span class='va'>am2</span>, <span class='va'>am3</span>, <span class='va'>am4</span>, <span class='va'>am5</span><span class='op'>)</span>, <span class='fl'>5</span>, <span class='fl'>10</span>, byrow <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>; <span class='va'>amost_lin</span>
</code></pre>
</div>
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
[1,]   42  334   13  417  361  729  712  656  373    26
[2,]  857  209   48  663  527  958  878  536  482   317
[3,]  132  739  270  929   35  266   74  570  679   912
[4,]  271  543  906  101  435  437  959  613  621   943
[5,]   39  947  630   89  530  899  982  554  394   254</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Calculando a media por linhas</span>
<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>amost_lin</span>, MARGIN <span class='op'>=</span> <span class='fl'>1</span>, FUN <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 366.3 547.5 460.6 582.9 531.8</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Podemos tambem adicionar argumentos adicionais</span>
<span class='co'># em FUN (Media truncada em 10%)</span>
<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>amost_lin</span>, MARGIN <span class='op'>=</span> <span class='fl'>1</span>, FUN <span class='op'>=</span> <span class='va'>mean</span>, trim <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 365.125 558.625 455.250 596.125 537.125</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Usando o argumento simplify, o default: simplify = TRUE</span>
<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>amost_lin</span>, MARGIN <span class='op'>=</span> <span class='fl'>1</span>, FUN <span class='op'>=</span> <span class='va'>mean</span>, simplify <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 366.3

[[2]]
[1] 547.5

[[3]]
[1] 460.6

[[4]]
[1] 582.9

[[5]]
[1] 531.8</code></pre>
</div>
<p>A próxima função é <code>lapply()</code>, com sintaxe:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(X, FUN, ...),</span></code></pre></div>
</div>
<p>em que: - <code>X</code> argumento que recebe uma lista; - <code>FUN</code> argumento que recebe a função desejada, e - <code>...</code> argumento que recebe argumentos adicionais para <code>FUN</code>.</p>
<p>Vejamos que a sintaxe desta função é muito parecido com <code>apply()</code>. Vejamos alguns exemplos, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Vetor (nao faz muito sentido)</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
[1] 3

[[4]]
[1] 4

[[5]]
[1] 5

[[6]]
[1] 6

[[7]]
[1] 7

[[8]]
[1] 8

[[9]]
[1] 9

[[10]]
[1] 10</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Lista</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, y <span class='op'>=</span> <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$x
[1] 5.5

$y
[1] 15.5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, y <span class='op'>=</span> <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, <span class='st'>"[["</span>, <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$x
[1] 2

$y
[1] 12</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>mat1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span>, <span class='fl'>4</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"["</span>, , <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>$mat1
[1] 5 6 7 8</code></pre>
</div>
<p>A função seguinte é <code>sapply()</code>, que é um invólucro (<em>wrapper</em>) da função <code>lapply()</code>, e o acréscimo sintátivo do argumento padrão <code>simplify = TRUE</code>. Assim, a forma sintática dessa função, segue:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(X, FUN, ..., <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>),</span></code></pre></div>
</div>
<p>em que: - <code>X</code> argumento que recebe uma lista; - <code>FUN</code> argumento que recebe a função desejada; - <code>...</code> argumento que recebe argumentos adicionais para <code>FUN</code>; e - <code>simplify</code>, argumento lógico, se <code>TRUE</code> retorna o resultado de forma simplificada, sendo um vetor atoômico, matriz ou <em>array</em>; se <code>FALSE</code> o retorno é uma lista; - <code>USE.NAMES</code>, argumento lógico; se <code>TRUE</code> é retornado o nome inserido nos objetos da lista; se <code>FALSE</code>, caso contrário.</p>
<p>Na realidade, o que essa função faz é melhorar a saída de <code>lapply()</code>, retornando um vetor, matriz ou <em>array</em>. Vejamos,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 5.5

[[2]]
[1] 15.5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, <span class='va'>mean</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1]  5.5 15.5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 'simplify = FALSE' em 'sapply()' eh equivalente a 'lapply()'</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, <span class='va'>mean</span>, simplify <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 5.5

[[2]]
[1] 15.5</code></pre>
</div>
<p>Uma forma multivariada da função <code>apply</code>, é a função <code>mapply()</code>, com sintaxe:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='va'>FUN</span>, <span class='va'>...</span>, MoreArgs <span class='op'>=</span> <span class='cn'>NULL</span>, SIMPLIFY <span class='op'>=</span> <span class='cn'>TRUE</span>,
       USE.NAMES <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>em que: - <code>FUN</code> argumentos que recebe a função desejada; - <code>...</code> argumentos para vetorização; - <code>MoreArgs</code> uma lista com argumentos adicionais a <code>FUN</code>; - <code>SIMPLIFY</code>, argumento lógico, se <code>TRUE</code> retorna o resultado de forma simplificada, sendo um vetor atoômico, matriz ou <em>array</em>; se <code>FALSE</code> o retorno é uma lista; - <code>USE.NAMES</code>, argumento lógico; se <code>TRUE</code> é retornado o nome inserido nos objetos da lista; se <code>FALSE</code>, caso contrário.</p>
<p>Vejamos alguns exemplos de aplicação, a seguir.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span>FUN <span class='op'>=</span> <span class='va'>mean</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, y <span class='op'>=</span> <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, USE.NAMES <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   x    y 
 5.5 15.5 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span>FUN <span class='op'>=</span> <span class='va'>mean</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>, y <span class='op'>=</span> <span class='fl'>11</span><span class='op'>:</span><span class='fl'>20</span><span class='op'>)</span>, USE.NAMES <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1]  5.5 15.5</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span>FUN <span class='op'>=</span> <span class='va'>rep</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>,  times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 1

[[2]]
[1] 2 2

[[3]]
[1] 3 3 3

[[4]]
[1] 4 4 4 4</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span>FUN <span class='op'>=</span> <span class='va'>rep</span>, x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>,  times <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     [,1] [,2] [,3] [,4]
[1,]    1    2    3    4
[2,]    1    2    3    4
[3,]    1    2    3    4
[4,]    1    2    3    4</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='va'>rep</span>, times <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>, MoreArgs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[[1]]
[1] 4

[[2]]
[1] 4 4

[[3]]
[1] 4 4 4

[[4]]
[1] 4 4 4 4</code></pre>
</div>
<p>Um outro exemplo interessante usando <code>mapplay()</code>, suponha que temos um conjunto de dados <code>1:38</code> e desejamos reamostrar com reposição 10 amostras de mesmo comprimento desses dados. Nesse caso, temos:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='va'>sample</span>, size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>38</span>, <span class='fl'>10</span><span class='op'>)</span>, MoreArgs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>38</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]   15   13   14   31   23   29   18    1   32    25
 [2,]   13    6   30   17    1   24   31   37   36    35
 [3,]   26   37   27   37   37    5   37   21    7     7
 [4,]   14   12   10   24   19   25   33   22   25    10
 [5,]   28   32    8    7   25   32   20   26    3    23
 [6,]    4   31    6   27    6   14   35    4   31    15
 [7,]   31    4    5   14   33   13   19   35   37    28
 [8,]   20   24    9   10   14   11   27   18    9    14
 [9,]   29   21   18    6   30   22   25   12   11    24
[10,]    3   18   15   34   15    1   17   24   18     6
[11,]   23   38   16    4    7   28   21   36   15    37
[12,]   17   23   17    1   10   19   10   30   16    18
[13,]   16   17   23   20   31    7   13   27   21     5
[14,]   32   11   38   13    2    4   34   38   29    32
[15,]   22    1   32   21   17   20    5    2   35    11
[16,]   30   34   33    8    4   33    6    6   38    12
[17,]    9   14   13   35   22    2    4   20   30    21
[18,]   36   15   21   32   35   16   23   33   20     4
[19,]   21   28    3    2   28   15    9    8   23    19
[20,]   24   36   25   38   11   21   29   17   28    29
[21,]   38    7   12   30   34   23   36   29    2    33
[22,]   27    2   34   18   29   27   28    7   17    36
[23,]    6   20   29   15    5   31   14   28   13    27
[24,]   10   33   36   22   24   35   22   13    5    26
[25,]    7   35   26   12    9   17    8   32   34    13
[26,]   19   22   22   28   36   10    2   15   26    17
[27,]    8   30   37   16   38    9   24    9   24    38
[28,]   37   25    2   36   26   12   12   16   10    30
[29,]   33   29   24    9   12    8    3   31    8     3
[30,]   34    8   31   11   18   38    7   34   14    31
[31,]   11   27   35    3   16   30    1    3    1     9
[32,]   25   19   19   23   27   36   26   14   19     1
[33,]   12   10    7   25   13    3   11   25   12    34
[34,]   35    3   28   29   21   37   32   10   27    20
[35,]   18   16   20   33    3   34   30   23    6     8
[36,]    2    5    4   26   32    6   38    5    4     2
[37,]    5    9   11   19   20   18   15   11   22    22
[38,]    1   26    1    5    8   26   16   19   33    16</code></pre>
</div>
<p>Poderíamos estar interessados também em gerar 10 amostras de tamanho <span class="math inline">\(n = 30\)</span>, de uma distribuição normal padrão, isto é,</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/mapply.html'>mapply</a></span><span class='op'>(</span><span class='va'>rnorm</span>, n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>30</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>             [,1]        [,2]         [,3]       [,4]        [,5]
 [1,]  0.97693997  1.02159557  0.128783463 -1.8656023 -1.70899030
 [2,]  0.79023781  0.35895923  1.972929865 -0.3264478  0.58183916
 [3,]  0.98468618  1.25387555 -0.071548470  0.4604034  0.36406946
 [4,]  1.72802155  0.70613372  0.662564612 -0.3511606  1.51223372
 [5,] -0.12590361 -1.94721263 -0.021996069  0.7167607  0.19003523
 [6,]  2.53435299 -0.11707933 -0.316477912 -0.2088030  0.57913457
 [7,] -0.43306272  0.17854140  0.002216812  1.2765002  0.05312193
 [8,]  0.05448099 -0.88326729  0.518168763 -1.1883914  0.92380619
 [9,]  0.21240835 -0.80757517  1.052712115 -1.7137380  0.14522949
[10,] -0.89938361  0.10100343  1.860744440 -1.9561878 -0.88649435
[11,] -1.37565361  1.46412309 -0.572562971 -1.3176539  0.37985772
[12,] -0.72000035 -0.10547712 -1.116260285  0.4809290 -0.94199625
[13,]  0.57103300 -1.79153520 -0.943473638  0.1418312 -0.48406717
[14,] -2.22797642  0.54351301 -2.224035530 -0.2452919 -0.23334446
[15,] -0.46067194  0.31409270  1.451927428 -1.0040025  0.51127182
[16,]  0.28035150  0.50664013 -1.956099422  0.1515346  0.68847089
[17,]  1.21989163 -0.86584165 -1.014548722 -0.5758454 -0.05936718
[18,]  0.49560734  2.70818206  0.039335338 -0.9516940 -0.69619877
[19,] -0.74053951 -0.88611149  0.806803554  0.6059419  1.95999846
[20,]  0.10386793  0.52069801 -0.524917117 -0.5905524  0.15963178
[21,]  0.77818514 -1.23173443  0.034003567  0.3728825 -0.65101808
[22,] -0.35034355  0.80405233  0.529471098 -1.6821377 -0.16582689
[23,] -1.18489995  1.17219691  1.580699421 -0.3354433  0.78029604
[24,] -0.54906948  0.80655250 -0.097312740 -0.7440138  0.68289313
[25,] -0.35041622 -1.72356712 -0.883009480  0.5024655 -0.93243155
[26,] -0.03310228 -0.14579650  0.920582123 -0.3672830 -1.44286488
[27,] -0.38794160 -1.80357911  0.023514388 -1.0183745 -0.15500192
[28,] -0.48037026 -0.23600588 -0.909644168  0.7085347 -0.51796180
[29,] -0.31829568 -1.18294347  0.423339689  1.4669889 -0.18665527
[30,] -0.89372404 -0.07234726 -0.504172213  1.2324449  1.14898546
             [,6]        [,7]        [,8]        [,9]       [,10]
 [1,] -0.76589869 -1.24022859  0.10728058 -0.39812103 -0.57176892
 [2,]  0.68909301 -0.43904601 -0.27361986  0.71432097 -2.16851673
 [3,] -0.47754641  0.92465389 -1.15852151 -0.80001178  0.17681026
 [4,]  1.74790082  0.48999988 -2.30646600  0.20796708  1.79055424
 [5,]  1.61613864 -0.12520464  2.05624855  1.30804130  0.59392193
 [6,] -0.67747280  1.90371182 -0.04554368 -0.46294655 -0.76027132
 [7,] -1.06211418  0.55390832  0.48959405 -0.56138541 -0.55642984
 [8,]  0.88842467  0.02452472  2.08249472 -0.74300563 -0.64327472
 [9,] -1.19553994 -0.43558701  2.15266415  0.56601182 -0.72255975
[10,]  1.42369200 -0.84270375 -0.88377944  0.05779672  0.01210588
[11,] -0.20078225  0.78824154 -0.29569873  0.26355651  0.96129385
[12,]  1.32816470  0.30441382 -1.48067015 -0.42854656 -0.95542144
[13,]  2.23539357 -0.73057805  0.71599300 -1.35961592  0.90466367
[14,]  0.34765519  0.07554207 -0.32544876 -0.06506061  0.34902954
[15,]  2.00349064  0.18755286 -0.48025235 -0.32217859  1.99607943
[16,] -1.20741971  1.54888307 -0.40743851  0.65078507  0.22416550
[17,] -0.11984656  0.73348814 -0.33567896  0.97817838 -0.05739319
[18,]  1.23060416 -0.98774829  1.02588074  2.56431606  0.04200018
[19,] -0.44432912 -1.34502211 -0.62750548 -0.69717728  0.59820545
[20,]  0.06629581  1.12057047  0.14214881  0.84131378 -1.21963884
[21,] -1.82850943  2.08816534  1.29126052  0.65903314  0.54559975
[22,]  0.34204225 -0.76044637  0.31021144  0.64665078 -0.73589761
[23,]  1.03675412 -0.21056316  0.33648561 -0.93036920 -2.43940646
[24,]  0.24952543 -0.95743964 -0.86197071 -0.84909779 -1.04992151
[25,]  0.19481959 -1.39402542 -0.36652510 -0.12281368  0.79303164
[26,]  0.06435280  0.26600553 -0.40975408 -0.30369010 -0.72705396
[27,] -0.59126036  0.58662393 -1.71986196 -0.91213787 -0.90122029
[28,]  1.23259700  0.07286590  0.92255632 -0.44223852  0.25348310
[29,]  0.50179363 -0.04643838  0.98709908 -1.78985673 -0.83447270
[30,] -0.68551424 -0.14572402 -1.07541152  1.60283488 -0.74985132</code></pre>
</div>
<ul>
<li>Outras funções: <code>by()</code>, <code>aggregate()</code>, <code>simplify2array()</code>, <code>ave()</code>, <code>replicate()</code>, <code>outer()</code></li>
</ul>
<h2 id="funções-recursivas">Funções recursivas</h2>
<ul>
<li><code>Recall()</code></li>
<li><code>local()</code></li>
</ul>
<!-- # https://stackoverflow.com/questions/21698641/how-can-i-write-a-recursive-function-in-r -->
<!-- https://adv-r.hadley.nz/function-operators.html#existing-fos -->
<!-- Usar o cache de memória para otimizar a funcao: -->
<!-- nCr <- function(n, r) { -->
<!--   if (r == 0 | r == n) return (1) -->
<!--   else return (nCr(n-1, r-1) + nCr(n-1, r))  -->
<!-- } -->
<!-- system.time(for(i in 1:10) nCr(20, 6)) -->
<!-- ##    user  system elapsed  -->
<!-- ##    8.74    0.00    8.90  -->
<!-- system.time(for(i in 1:10) choose(20, 6)) -->
<!-- ##    user  system elapsed  -->
<!-- ##       0       0       0  -->
<h2 id="programação-defensiva">Programação defensiva</h2>
<!-- Iniciar por aqui -->
<!-- https://www.r-bloggers.com/2018/07/the-ten-rules-of-defensive-programming-in-r/ -->
<!-- - `stop()` -->
<!-- - `stopofnot()` -->
<!-- - `if()`, `else()`, `ifelse()` -->
<!-- - `gettext()`, `gettextf()` -->
<!-- - `tryCatch()`, `withCallingHandlers()` -->
<!-- - `geterrmessage()` -->
<!-- - `traceback()` -->
<!-- - `options(error=)` -->
<!-- - `warning()` -->
<!-- - `options("warn")` -->
<!-- - `warnings()` -->
<!-- - `getOption("warn")` -->
<!-- - `suppressWarnings()` -->
<!-- - `options(nwarnings = 10000)` -->
<!-- - `last.warning()` -->
<!-- - `errorCondition(message, ..., class = NULL, call = NULL)` -->
<!-- - `warningCondition(message, ..., class = NULL, call = NULL)` -->
<!-- - `?conditions` -->
<h2 id="exemplo">Exemplo</h2>
<!-- new_cpf <- function(x, p_valor_zero = FALSE) { -->
<!--   # Programacao defensiva -->
<!--   n <- nchar(x) -->
<!--   if (!is.numeric(x)) stop("Deve ser numérico!") -->
<!--   if (n == 11) { -->
<!--     cpf <- structure(x %/% 10^seq(n - 1,0) %% 10, -->
<!--                      class = "cpf") -->
<!--   } -->
<!--   if (n != 11) { -->
<!--     if (n == 10 & p_valor_zero == TRUE) { -->
<!--       cpf <- structure(x %/% 10^seq(n,0) %% 10, -->
<!--                        class = "cpf") -->
<!--     } else { -->
<!--       stop("Seu CPF nao tem 11 digitos") -->
<!--     }  -->
<!--   }  -->
<!--   return(cpf) -->
<!-- } -->
<!-- print.cpf <- function(x, ...) { -->
<!--   cpf <- paste(x, collapse = "") -->
<!--   substr(cpf, 3, 9) <- "*******" -->
<!--   print(cpf) -->
<!-- } -->
<!-- x <- new_cpf(05098523435, TRUE) -->
<!-- https://adv-r.hadley.nz/conditions.html -->
<!-- http://homepage.stat.uiowa.edu/~luke/R/exceptions/simpcond.html -->
<!-- http://www.gigamonkeys.com/book/beyond-exception-handling-conditions-and-restarts.html -->
<!-- http://adv-r.had.co.nz/beyond-exception-handling.html -->
<!-- https://gist.github.com/hadley/4278d0a6d3a10e42533d59905fbed0ac -->
<h3 id="função-stop">Função <code>stop()</code></h3>
<h3 id="função-warning">Função <code>Warning()</code></h3>
<!-- new_cpf <- function(x, p_valor_zero = FALSE) { -->
<!--   # Programacao defensiva -->
<!--   n <- nchar(x) -->
<!--   if (!is.numeric(x)) stop("Deve ser numérico!") -->
<!--   if (n == 11) { -->
<!--     cpf <- structure(x %/% 10^seq(n - 1,0) %% 10, -->
<!--                      class = "cpf") -->
<!--   } -->
<!--   if (n != 11) { -->
<!--     if (n == 10 & p_valor_zero == TRUE) { -->
<!--       cpf <- structure(x %/% 10^seq(n,0) %% 10, -->
<!--                        class = "cpf") -->
<!--     } else { -->
<!--       stop("Seu CPF nao tem 11 digitos") -->
<!--     }  -->
<!--   }  -->
<!--   return(cpf) -->
<!-- } -->
<!-- print.cpf <- function(x, ...) { -->
<!--   cpf <- paste(x, collapse = "") -->
<!--   substr(cpf, 3, 9) <- "*******" -->
<!--   print(cpf) -->
<!-- } -->
<!-- x <- new_cpf(05098523435, TRUE) -->
<!-- ### Função `on.exit()` -->
<!-- https://adv-r.hadley.nz/functions.html#on-exit -->
<!-- ## Configurações padrões do ambiente R -->
<!-- oldOp<-options() # armazena as configurações originais -->
<!-- oldOp # Algumas configurações presentes no sistema -->
<!-- ls(oldOp) # Lista todas as configurações -->
<!-- options(digits=4) -->
<!-- # [1] 3.142 valor pi com 4 dígitos -->
<!-- options(oldOp) # Configuração original -->
<!-- - como acessar alterações de idiomas -->
<!-- - casas decimais -->
<!-- - etcs -->
<!-- ## Controle de fluxos usando paralelização -->
<!-- - iterators -->
<!-- - foreach -->
<!-- ## Sintaxe da família de Pacotes Tidyverse -->
<!-- Após isso, seguir as ideias do livro de Hadley -->
<div class="sourceCode" id="cb314"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!-- ## Metaprogramação -->
<!-- ## Depurando o Código R -->
<!-- https://rstats.wtf/debugging-r-code.html -->
<!-- https://adv-r.hadley.nz/debugging.html -->
<!-- ## Gráficos -->
<!--  - Dispositivo gráfico: -->
<!--         - ggplot -->
<!--         - tmap -->
<!--         - graficos interativos (animate):  -->
<!--            sites: https://mode.com/blog/r-data-visualization-packages/ -->
<!--            sites: https://towardsdatascience.com/animating-your-data-visualizations-like-a-boss-using-r-f94ae20843e3 -->
<!-- ## Traduzindo o Código R para outras linguagens -->
<!-- https://adv-r.hadley.nz/translation.html#translation -->
<h1 id="projetos-no-rstudio">Projetos no RStudio</h1>
<h1 id="projetos-r-no-github">Projetos R no Github</h1>
<h1 id="introdução-a-desenvolvimento-de-pacotes">Introdução a desenvolvimento de pacotes</h1>
<h1 id="banco-de-dados-e-apis-sql">Banco de dados e APIs, SQL</h1>
<h1 id="criação-de-documentações-no-r">Criação de documentações no R</h1>
<h2 id="documentos-web-estatística-e-dinâmica">Documentos Web (estatística e dinâmica)</h2>
<h3 id="páginas-de-pacote-pkgdown">Páginas de pacote (pkgdown)</h3>
<h3 id="livros-bookdown">Livros (bookdown)</h3>
<h3 id="blogs-e-websites-distill-blogdown">Blogs e websites (distill, blogdown)</h3>
<h2 id="documentos-pdf-word-epub">Documentos (PDF, WORD, EPUB)</h2>
<h3 id="documentos-estatísticos">Documentos estatísticos</h3>
<h3 id="documentos-animados">Documentos animados</h3>
<h3 id="relatórios-dinâmicos">Relatórios dinâmicos</h3>
<!-- Curso R <http://bendeivide.github.io/cursor> -->
<!-- Módulo: Programação em R (Nível Intermediário) -->
<!-- Ementa: -->
<!-- 1. Caracterizando melhor a linguagem R -->
<!--   1.1. Linguagem interpretada -->
<!--   1.2. Escopo léxico -->
<!--   1.3. Programação Funcional -->
<!--   1.4. Programação Meta-paradigma -->
<!--   1.5. Programação dinâmica -->
<!-- 2. Projetos no RStudio -->
<!-- 3. Projetos R no GitHub -->
<!-- 4. Entendendo um pouco mais sobre objetos -->
<!--   4.1. Manipulando strings -->
<!--   4.2. Objeto 'tibble' -->
<!--   4.3. manipulações com objetos -->
<!--   4.4. Cópias de objetos -->
<!-- 5. Programação orientada a objetos -->
<!--   5.1. Classes e métodos -->
<!--   5.2. ... -->
<!-- 6. Programação Funcional -->
<!--   6.1. Operadores binários -->
<!--   6.2. Sintaxe da família de Pacotes Tidyverse -->
<!--   6.3 Evitando loops -->
<!--   6.4. Funções recursivas -->
<!--   6.5. Programação defensiva -->
<!--   6.6. Controle de fluxos usando paralelização -->
<!-- 7. Gráficos -->
<!-- 8. Introdução a desenvolvimento de pacotes -->
<!-- 9. Aprofundamento sobre ambientes -->
<!-- 10. Banco de dados -->
<!-- 11. Criação de documentações no R -->
<!--   11.1. Documentos Web -->
<!--     11.1.1 Páginas estatísticas -->
<!--     11.1.2. Páginas dinâmicas -->
<!--   11.2. Documentações de pacotes -->
<!--      11.2.1. Documentações de ajuda .Rd -->
<!--      11.2.2.  Página Web de pacotes    -->
<!--   11.3. Livros -->
<!--   11.4. Blogs e websites -->
<!--   11.5. Relatórios -->
<!--     11.5.1. Relatórios animados -->
<!--     11.5.2. Relatórios dinâmicos -->
<!--   11.6. Demais documentos (PDF, WORD, EPUB) -->
<div class="sourceCode" id="cb315"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-chambers2008" class="csl-entry" role="doc-biblioentry">
Chambers, John M. 2008. <em>Software for Data Analysis: Programming with <span>R</span></em>. Statistics and <span>C</span>omputing. New York: Springer.
</div>
<div id="ref-chambers2016" class="csl-entry" role="doc-biblioentry">
———. 2016. <em>Extending <span>R</span></em>. The <span>R</span> <span>S</span>eries. Boca Raton, Florida: Chapman; Hall/CRC.
</div>
<div id="ref-chambers1991" class="csl-entry" role="doc-biblioentry">
Chambers, John M., and Trevor J. Hastie. 1991. <em>Statistical Methods in <span>S</span></em>. London: Chapman &amp; Hall.
</div>
<div id="ref-chambers1993" class="csl-entry" role="doc-biblioentry">
———. 1993. <em>Statistical Models in <span>S</span></em>. London: Chapman &amp; Hall.
</div>
<div id="ref-hadley2019" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2019. <em>Advanced <span>R</span></em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://adv-r.hadley.nz/">https://adv-r.hadley.nz/</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Funções primitivas chamam as funções em linguagem <code>C</code>, <code>DispatchGroup()</code> ou <code>DispatchOrEval()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Função similar <code>sprintf()</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Licença Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />Este trabalho está licenciado com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons - Atribuição-NãoComercial 4.0 Internacional</a>.</p>
<!-- hitwebcounter Code START -->
<p><a href="https://www.hitwebcounter.com" target="_blank"> <img src="https://hitwebcounter.com/counter/counter.php?page=7835102&style=0010&nbdigits=9&type=page&initCount=1000" title="Free Counter" Alt="web counter"   border="0" /></a></p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>

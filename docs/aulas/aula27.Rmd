---
title: "Curso R: Programação em R (Nível Intermediário)"
subtitle: "Aula 27 - Caracterizando melhor o ambiente R"
author: "Ben Dêivide"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  ioslides_presentation:
    smaller: true
    transition: slower
    logo: logo2.png
    css: style-cursor-ni.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

<!--
YAML:
date: "`r format(Sys.time(), '%d %B, %Y')`"
=====
APRESENTACAO:

Inserir nas secoes:
{data-background=boards.jpg data-background-size=cover}
-->


## Selo DC

<center>
[![](SeloDC-preto.png){height=300 width=300}](https://bendeivide.github.io/dc/){target="_blank"}
</center>

## Linguagem, Programa ou ambiente R?

- Linguagem interpretada (`S`, `C`, `FORTRAN`) `R`;
- Software `R`;
- Ambiente `R` (Melhor escolha!);

## Ambiente R

Assim, esse ambiente inclui:

- manipulação de dados;
- operações com matrizes;
- coleção de ferramentas para análise de dados;
- criação e apresentações gráficas, para apresentação dos dados;
- linguagem que inclui condicionais, fluxos de controle, funções recursivas definidas pelo usuário e recursos de entrada e saída;
- Documentação e relatórios de análises.

## Contexto amplo como linguagem e ambiente `R`

- um ambiente de software livre e código aberto, com licença GNU;
- uma linguagem de programação interpretada;
- uma linguagem de programação dinâmica;
- uma linguagem de tipagem forte e dinâmica;
- uma linguagem de programação funcional; 
  - de escopo lêxico;
  - execução preguiçosa;
- uma linguagem de programação orientada a objetos; e
- uma linguagem de programação metaparadigma.

## Linguagem de programação dinâmica

- O código é automaticamente interpretado, conforme se executa;
- Avaliação dinâmica (`expression()`, `eval()`, `quote()`, `substitute()`, `bquote()`, `desparse()`);
- Manipulação de ambientes explicitamente;

## Linguagem de programação fortemente e dinamicamente tipada

```{r echo=TRUE, include=TRUE}
vetor <- TRUE; typeof(vetor)
vetor[2] <- 1; typeof(vetor)
vetor[3] <- "1"; typeof(vetor); vetor
```

## Linguagem de programação funcional

- O `R` não é uma linguagem estritamente funcional, pois dentre outras situações, se entende que o estilo estritamente funcional apresenta:

  - Composição de funções ✔️;
  - Funções puras ✖️:
  - Imutabilidade ✖️;
  - Sem efeito colateral ✖️;
  - Funções de primeira classe ✔️;

## Composição de funções

```{r echo=TRUE, include=TRUE}
x <- 1:10
media <- function(x) mean(x)
media(x)
```

## Funções puras

- Função pura

```{r echo=TRUE, include=TRUE}
fpura <- function(x) {
  if (!is.numeric(x)) stop("x deve ser numérico")
  x + 1
}
fpura(x = 2)
```

- Função que não é pura

```{r echo=TRUE, include=TRUE}
rnorm(n = 3)
rnorm(n = 3)
```

## Imutabilidade

O `R` pode apresentar condições mutáveis:

```{r echo=TRUE, include=TRUE, eval=FALSE}
# Criamos um vetor e associamos ao nome 'x'
x <- c(1, 2, 3)
# Vejamos o identificador de memória
lobstr::obj_addr(x)
# > "0xcf09be4708"
# Modificando no local
x[2] <- 4; x
# [1] 1 4 3
# Mesmo modificando o objeto, o identificador eh o mesmo
lobstr::obj_addr(x)
# > "0xcf09be4708"
```

## Estilo funcional com Escopo léxico

- Exemplo 1: As funções têm acesso ao escopo em que foram criadas

```{r ex1, echo=TRUE, , prompt=TRUE}
# Criando um nome "n" associado a um objeto 10 no escopo da funcao
n <- 10

# Criando um nome "funcao" associado a um objeto que eh uma funcao
funcao <- function() {
  print(n)
}

# Imprimindo 'funcao'
funcao()
```

## Estilo funcional com Escopo léxico

- Exemplo 2: As variáveis criadas ou alteradas dentro de uma função, permanecem na função

```{r ex2, echo=TRUE, , prompt=TRUE, collapse=TRUE}
# Criando n
n <- 10
lobstr::obj_addr(n) # Ident do objeto
#Funcao
funcao <- function() {
  print(n) # Imprimindo n
  n <- 15 # Criando n
  print(n) # Imprimindo n
}
# Imprimindo 'funcao'
funcao()
# Imprimindo 'n'
n; lobstr::obj_addr(n) # Identificador do objeto
``` 

## Estilo funcional com Escopo léxico

- Exemplo 3: As variáveis dentro de uma função permanecem nelas, exceto no caso em que a atribuição ao escopo seja explicitamente solicitada.
  
```{r ex3, echo=TRUE, , collapse=TRUE, prompt=TRUE}
# Criando n
n <- 10
lobstr::obj_addr(n) # Identificador do objeto
# Criando funcao
funcao <- function() {
  # Imprimindo n
  print(n)
  # Superatribuicao
  n <<- 15
  # Imprimindo n
  print(n)
}
# Imprimindo 'funcao'
funcao()
# Imprimindo n
n; lobstr::obj_addr(n) # Ident do objeto
``` 

## Estilo funcional com avaliação preguiçosa


```{r echo=TRUE, include=TRUE}
preguicoso <- function(a, b = faux())  a * 100
preguicoso(4)
```

## Funções de primeira classe

```{r echo=TRUE, , collapse=TRUE, prompt=TRUE}
# Funcao anonima
function(x) x + 1 # 1ª forma
\(x) x + 1        # 2ª forma (>= R 4.1) 
# Funcao associado a um nome
fx <- function(x) x + 1
# Funcao como argumento de outra funcao
x <- cbind(1:10)
apply(x, 1, \(x) x + 1)
# Operador binario (Pipe nativo)
1:10 |> mean()
``` 

## Programação orientada a objetos

```{r echo=TRUE, include=TRUE}
# Objeto "data.frame"
objPOO <- data.frame(a = 1, b = "1", c = TRUE)
# Objeto "data.frame" eh um objeto POO?
is.object(objPOO)

# Vetor de comprimento 10
objBASE <- 1:10
# O vetor eh um objeto POO?
is.object(objBASE)
```

## Polimorfismo

```{r echo=TRUE, include=TRUE}
diamonds <- ggplot2::diamonds

summary(diamonds$carat)

summary(diamonds$cut)

```


## Bons estudos!

<center>
[![](logo2.png){height=500 width=500}](https://bendeivide.github.io/courses/cursor/){target="_blank"}
</center>
